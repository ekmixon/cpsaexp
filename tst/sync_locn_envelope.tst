(herald "Envelope Protocol, location-based version" (reverse-nodes)
  (try-old-strands) (bound 30) (limit 300))

(comment "CPSA 4.2.3")
(comment "All input read from tst/sync_locn_envelope.scm")
(comment "Step count limited to 300")
(comment "Strand count bounded at 30")
(comment "Old strands tried first")
(comment "Younger nodes tried first")

(defprotocol envelope basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm "power on") (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 "0")))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat "token" nonce))
      (recv tpm (cat "extend" pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send "ext ok"))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "quote" pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc "quote" pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat "create-req" pcr-id pcrval))
      (send (enc "created" k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "decrypt" (enc m k)))
      (recv (enc "created" k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey) (tpm chan))
    (trace (recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 2)
          (p "tpm-extend-enc" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (cat v1 v2)))
        (false)))))

(defskeleton envelope
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 0)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment "Not a skeleton"))

(defskeleton envelope
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 1)
  (parent 0)
  (unrealized (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpm-0 chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik) (1 3))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))))
  (label 2)
  (parent 1)
  (unrealized (0 0) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-1) (pcr pcr))
  (precedes ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm-0)
  (operation nonce-test (added-strand tpm-decrypt 4) v (0 0) (enc v k))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 3)
  (parent 2)
  (unrealized (2 0) (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 4 1 alice 3)
    (ch-msg tpm-1
      (cat "create-req" pcr-id (hash (hash "0" n) "obtain"))) (2 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 4)
  (parent 3)
  (unrealized (1 0) (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce v n k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat "token" nonce)) (1 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v))
    ((send tpm (cat "token" nonce))))
  (label 5)
  (parent 4)
  (unrealized (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id nonce text) (v n data) (pt pval) (k aik akey)
    (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n k)
  (genStV (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 5 2 tpm-create-key 2)
    (enc "created" k pcr-id-0 current-value aik-0) (3 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce))))
  (label 6)
  (parent 5)
  (unrealized (3 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)) ((4 3) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-0)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 4 5 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "obtain"))) (3 2))
  (traces ((recv v) (send v))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain")))))
  (label 7)
  (parent 6)
  (unrealized (4 1) (4 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id nonce pcr-id-0 nonce-0 text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)) ((5 3) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "obtain"))) (3 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain")))))
  (label 8)
  (parent 6)
  (unrealized (5 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((4 3) (3 2)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-0)
  (auth tpm-0)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces ((recv v) (send v))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 9)
  (parent 7)
  (unrealized (4 1) (5 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 4 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-1 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 10)
  (parent 8)
  (unrealized (5 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 11)
  (parent 8)
  (unrealized (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
    (5 1))
  (traces ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-1 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 12)
  (parent 10)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((v v) (n n) (pcr-id pcr-id) (nonce nonce-0) (k k) (aik aik)
        (tpm tpm-1))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (2 1)) (v (1 4))))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (displaced 4 7 tpm-extend-enc 4)
    (hash pcr-id-1 n nonce-0) (6 1))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0)))))
  (label 13)
  (parent 11)
  (unrealized (5 1) (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 0) (7 1))
    ((6 3) (5 2)) ((7 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-1 n nonce-1) (6 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))))
  (label 14)
  (parent 11)
  (seen 16)
  (unrealized (6 1) (7 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (deflistener (cat pcr-id-1 n nonce-1))
  (precedes ((1 1) (7 0)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 0) (7 0))
    ((6 3) (5 2)) ((7 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-1))
    (hash pcr-id-1 n nonce-1) (6 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1))))
  (label 15)
  (parent 11)
  (unrealized (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-1 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-0)))))
  (label 16)
  (parent 13)
  (unrealized (5 1) (6 1) (7 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-1)) (pcr-id pcr-id-3)
    (pt pt-3) (aik aik-0) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (7 1)) ((7 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-1)
    (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv tpm-3 (cat "quote" pcr-id-3 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
      (send
        (enc "quote" pcr-id-3 (hash pcr-id-1 n nonce-1) nonce aik-0))))
  (label 17)
  (parent 13)
  (unrealized (5 1) (6 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 0)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 0)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-0))
    (hash pcr-id-1 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0))))
  (label 18)
  (parent 13)
  (unrealized (6 1) (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id nonce-0 pcr-id-0 nonce-1 pcr-id-1 nonce-2 pcr-id-2 nonce-3
      pcr-id-3 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-2)) (pcr-id pcr-id-3)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 0) (7 1))
    ((6 3) (5 2)) ((7 3) (8 1)) ((8 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-2) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-2)
          (hash pcr-id-2 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-3 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2)))
      (send
        (enc "quote" pcr-id-3 (hash pcr-id-1 n nonce-2) nonce aik-0))))
  (label 19)
  (parent 14)
  (unrealized (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (precedes ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (7 1)) ((6 0) (8 0)) ((6 3) (5 2)) ((7 3) (6 1))
    ((8 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-1))
    (hash pcr-id-1 n nonce-1) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1))))
  (label 20)
  (parent 14)
  (unrealized (7 1) (8 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-1)) (pcr-id pcr-id-4)
    (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (8 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-1)
    (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-1 n nonce-1) nonce aik-0))))
  (label 21)
  (parent 16)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-1)) (pcr-id pcr-id-4)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (8 1))
    ((7 3) (5 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-1)
    (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-1 n nonce-1) nonce aik-0))))
  (label 22)
  (parent 16)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-1 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (6 1)) ((5 0) (7 1)) ((5 0) (8 0)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)) ((7 3) (5 1)) ((8 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-0))
    (hash pcr-id-1 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-0))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0))))
  (label 23)
  (parent 16)
  (unrealized (6 1) (7 1) (8 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (displaced 4 9 tpm-extend-enc 4)
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (7 1))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1)))))
  (label 24)
  (parent 20)
  (unrealized (6 1) (7 0) (8 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      pcr-id-3 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (5 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (7 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))))
  (label 25)
  (parent 20)
  (seen 27)
  (unrealized (7 1) (8 0) (9 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (deflistener (cat pcr-id-2 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 0)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (8 0)) ((6 0) (9 0)) ((6 3) (5 2)) ((7 0) (9 0))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-1) nonce-2))
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (7 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((recv (cat pcr-id-2 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-2 (cat n nonce-1) nonce-2))))
  (label 26)
  (parent 20)
  (unrealized (8 0) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-0) nonce-1)))))
  (label 27)
  (parent 24)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-4) (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (9 1)) ((9 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 28)
  (parent 24)
  (unrealized (6 1) (7 0) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-2 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 0)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 0)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 0)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-0) nonce-1))
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-2 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-2 (cat n nonce-0) nonce-1))))
  (label 29)
  (parent 24)
  (unrealized (7 0) (8 1) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id nonce-0 pcr-id-0 nonce-1 pcr-id-1 nonce-2 pcr-id-2 nonce-3
      pcr-id-3 nonce-4 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-4) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-4) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (5 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (10 1)) ((10 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 v n pt pt-0 pt-3
    pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-2) nonce-3) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-2) nonce-3))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-2)
          (hash pcr-id-2 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2))))
    ((recv (cat pcr-id-1 n nonce-2)) (send (cat pcr-id-1 n nonce-2)))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-3 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-3 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-2) nonce-3))))
    ((recv tpm-5 (cat "quote" pcr-id-4 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 30)
  (parent 25)
  (unrealized (7 1) (8 0) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      pcr-id-3 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (deflistener (cat pcr-id-2 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 1) (10 0)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0))
    ((5 3) (3 2)) ((6 0) (8 0)) ((6 0) (9 1)) ((6 0) (10 0))
    ((6 3) (5 2)) ((7 0) (9 1)) ((7 0) (10 0)) ((7 3) (6 1))
    ((8 1) (6 1)) ((9 3) (7 1)) ((10 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-1) nonce-2))
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-2 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-2 (cat n nonce-1) nonce-2))))
  (label 31)
  (parent 25)
  (unrealized (8 0) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-5) (pt pt-7) (aik aik-0) (tpm tpm-5) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (10 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 v n pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 32)
  (parent 27)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-5) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (10 1)) ((9 3) (6 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 v n pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 33)
  (parent 27)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (deflistener (cat pcr-id-2 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 1) (10 0))
    ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 3) (3 2)) ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1))
    ((5 0) (10 0)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 0) (9 1))
    ((6 0) (10 0)) ((6 3) (5 1)) ((7 1) (5 1)) ((8 0) (1 0))
    ((8 3) (6 1)) ((9 3) (6 1)) ((10 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-0) nonce-1))
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-2 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-2 (cat n nonce-0) nonce-1))))
  (label 34)
  (parent 27)
  (unrealized (7 0) (8 1) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol envelope basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm "power on") (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 "0")))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat "token" nonce))
      (recv tpm (cat "extend" pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send "ext ok"))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "quote" pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc "quote" pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat "create-req" pcr-id pcrval))
      (send (enc "created" k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "decrypt" (enc m k)))
      (recv (enc "created" k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey) (tpm chan))
    (trace (recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 2)
          (p "tpm-extend-enc" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (cat v1 v2)))
        (false)))))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 35)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment "Not a skeleton"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 36)
  (parent 35)
  (unrealized (0 0) (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 4) (2 0)) ((2 2) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))))
  (label 37)
  (parent 36)
  (unrealized (1 3) (2 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (precedes ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik) (1 3))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))))
  (label 38)
  (parent 37)
  (unrealized (2 1) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (precedes ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "refuse"))) (2 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 39)
  (parent 38)
  (unrealized (3 0) (4 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 3) (2 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 5 1 alice 3)
    (ch-msg tpm-2
      (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain"))) (3 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 40)
  (parent 39)
  (unrealized (1 0) (4 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data) (pt pt-0 pval)
    (k aik akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 0) (1 0)) ((4 3) (2 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-0)
  (auth tpm-0)
  (operation channel-test (displaced 5 4 tpm-extend-enc 1)
    (ch-msg tpm-1 (cat "token" nonce-0)) (1 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 41)
  (parent 40)
  (unrealized (4 1) (4 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 3) (2 1)) ((5 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat "token" nonce)) (1 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce))))
  (label 42)
  (parent 40)
  (unrealized (4 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 0) (1 0)) ((4 3) (2 1)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-0)
  (auth tpm-0)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 43)
  (parent 41)
  (unrealized (4 1) (5 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 5 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 44)
  (parent 42)
  (unrealized (5 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 45)
  (parent 42)
  (unrealized (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
    (5 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 46)
  (parent 44)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-0) (tpm tpm-1))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (3 1)) (v (1 4))))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (displaced 5 7 tpm-extend-enc 4)
    (hash pcr-id-2 n nonce-0) (6 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0)))))
  (label 47)
  (parent 45)
  (unrealized (5 1) (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 0) (7 1))
    ((6 3) (4 2)) ((7 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 n nonce-1) (6 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))))
  (label 48)
  (parent 45)
  (seen 50)
  (unrealized (6 1) (7 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (deflistener (cat pcr-id-2 n nonce-1))
  (precedes ((1 1) (7 0)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 0) (7 0))
    ((6 3) (4 2)) ((7 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-1))
    (hash pcr-id-2 n nonce-1) (6 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1))))
  (label 49)
  (parent 45)
  (unrealized (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-0)
          (hash pcr-id-4 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-0)))))
  (label 50)
  (parent 47)
  (unrealized (5 1) (6 1) (7 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-1)) (pcr-id pcr-id-4)
    (pt pt-3) (aik aik-0) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (7 1)) ((7 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-1)
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv tpm-3 (cat "quote" pcr-id-4 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 n nonce-1) nonce aik-0))))
  (label 51)
  (parent 47)
  (unrealized (5 1) (6 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 0)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 0)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-0))
    (hash pcr-id-2 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0))))
  (label 52)
  (parent 47)
  (unrealized (6 1) (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-2)) (pcr-id pcr-id-4)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 0) (7 1))
    ((6 3) (4 2)) ((7 3) (8 1)) ((8 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-2) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-2)
          (hash pcr-id-3 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 n nonce-2) nonce aik-0))))
  (label 53)
  (parent 48)
  (unrealized (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (precedes ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (7 1)) ((6 0) (8 0)) ((6 3) (4 2)) ((7 3) (6 1))
    ((8 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-1))
    (hash pcr-id-2 n nonce-1) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1))))
  (label 54)
  (parent 48)
  (unrealized (7 1) (8 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-1)) (pcr-id pcr-id-5)
    (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (8 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-1)
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 n nonce-1) nonce aik-0))))
  (label 55)
  (parent 50)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-1)) (pcr-id pcr-id-5)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (8 1))
    ((7 3) (5 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-1)
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 n nonce-1) nonce aik-0))))
  (label 56)
  (parent 50)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-2 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (6 1)) ((5 0) (7 1)) ((5 0) (8 0)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)) ((7 3) (5 1)) ((8 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-0))
    (hash pcr-id-2 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-0))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-0)
          (hash pcr-id-4 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0))))
  (label 57)
  (parent 50)
  (unrealized (6 1) (7 1) (8 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (displaced 5 9 tpm-extend-enc 4)
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (7 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1)))))
  (label 58)
  (parent 54)
  (unrealized (6 1) (7 0) (8 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (4 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (7 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))))
  (label 59)
  (parent 54)
  (seen 61)
  (unrealized (7 1) (8 0) (9 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (deflistener (cat pcr-id-3 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 0)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (8 0)) ((6 0) (9 0)) ((6 3) (4 2)) ((7 0) (9 0))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-1) nonce-2))
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (7 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((recv (cat pcr-id-3 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-3 (cat n nonce-1) nonce-2))))
  (label 60)
  (parent 54)
  (unrealized (8 0) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-5 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-0) nonce-1)))))
  (label 61)
  (parent 58)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-5) (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (9 1)) ((9 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 62)
  (parent 58)
  (unrealized (6 1) (7 0) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-3 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 0)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 0)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 0)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-0) nonce-1))
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-3 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-3 (cat n nonce-0) nonce-1))))
  (label 63)
  (parent 58)
  (unrealized (7 0) (8 1) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-5) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (4 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (10 1)) ((10 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-3
    pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-2) nonce-3) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-2)
          (hash pcr-id-3 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2))))
    ((recv (cat pcr-id-2 n nonce-2)) (send (cat pcr-id-2 n nonce-2)))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-4 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-2) nonce-3))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 64)
  (parent 59)
  (unrealized (7 1) (8 0) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (deflistener (cat pcr-id-3 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 1) (10 0)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (1 0)) ((6 0) (8 0)) ((6 0) (9 1)) ((6 0) (10 0))
    ((6 3) (4 2)) ((7 0) (9 1)) ((7 0) (10 0)) ((7 3) (6 1))
    ((8 1) (6 1)) ((9 3) (7 1)) ((10 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-1) nonce-2))
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-3 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-3 (cat n nonce-1) nonce-2))))
  (label 65)
  (parent 59)
  (unrealized (8 0) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-6) (pt pt-7) (aik aik-0) (tpm tpm-5) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (10 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-6 nonce))
      (load pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 66)
  (parent 61)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-6) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (10 1)) ((9 3) (6 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 67)
  (parent 61)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (deflistener (cat pcr-id-3 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 1) (10 0))
    ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 3) (2 1)) ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1))
    ((5 0) (10 0)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 0) (9 1))
    ((6 0) (10 0)) ((6 3) (5 1)) ((7 1) (5 1)) ((8 0) (1 0))
    ((8 3) (6 1)) ((9 3) (6 1)) ((10 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-0) nonce-1))
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-5 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-3 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-3 (cat n nonce-0) nonce-1))))
  (label 68)
  (parent 61)
  (unrealized (7 0) (8 1) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol envelope basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm "power on") (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 "0")))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat "token" nonce))
      (recv tpm (cat "extend" pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send "ext ok"))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "quote" pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc "quote" pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat "create-req" pcr-id pcrval))
      (send (enc "created" k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "decrypt" (enc m k)))
      (recv (enc "created" k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey) (tpm chan))
    (trace (recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 2)
          (p "tpm-extend-enc" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (cat v1 v2)))
        (false)))))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 69)
  (unrealized (0 0) (1 0) (2 3))
  (preskeleton)
  (origs (v (2 4)) (n (2 1)))
  (comment "Not a skeleton"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (precedes ((2 4) (0 0)) ((2 4) (1 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 70)
  (parent 69)
  (unrealized (0 0) (2 3))
  (origs (v (2 4)) (n (2 1)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((2 4) (1 0)) ((2 4) (3 0)) ((3 2) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))))
  (label 71)
  (parent 70)
  (unrealized (2 3) (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (precedes ((2 4) (1 0)) ((2 4) (3 0)) ((3 2) (0 0)) ((4 1) (2 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik) (2 3))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))))
  (label 72)
  (parent 71)
  (unrealized (1 0) (3 1) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (current-value mesg) (pcr-id pcr-id-0 nonce pcr-id-1 text)
    (n v data) (pt pt-0 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-2)
    (pcr pcr-0))
  (precedes ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (operation nonce-test (added-strand tpm-decrypt 4) v (1 0) (enc v k))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-2 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v)))
  (label 73)
  (parent 72)
  (unrealized (3 1) (4 0) (5 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (current-value mesg)
    (pcr-id pcr-id-0 nonce pcr-id-1 pcr-id-2 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-2)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-3) (pcr pcr))
  (precedes ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "refuse"))) (3 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-2 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-3 (cat "token" nonce-0))
      (recv tpm-3
        (cat "extend" pcr-id-2 "refuse"
          (hash pcr-id-2 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 74)
  (parent 73)
  (unrealized (4 0) (5 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (current-value mesg)
    (pcr-id pcr-id-0 nonce pcr-id-1 pcr-id-2 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-1)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 7 2 alice 3)
    (ch-msg tpm-3
      (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain"))) (4 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "refuse"
          (hash pcr-id-2 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 75)
  (parent 74)
  (unrealized (2 0) (5 1) (6 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (current-value mesg)
    (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 nonce text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-0)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0)) ((6 3) (3 1)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 7 6 tpm-extend-enc 1)
    (ch-msg tpm-2 (cat "token" nonce-0)) (2 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-2 "refuse" (hash pcr-id-2 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 76)
  (parent 75)
  (unrealized (5 1) (6 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (current-value mesg)
    (pcr-id pcr-id-0 nonce pcr-id-1 pcr-id-2 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-1)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat "token" nonce)) (2 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "refuse"
          (hash pcr-id-2 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce))))
  (label 77)
  (parent 75)
  (unrealized (5 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0)) ((6 3) (3 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 7 4 tpm-create-key 2)
    (enc "created" k pcr-id-2 current-value aik-0) (5 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 78)
  (parent 76)
  (unrealized (5 2) (6 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 8 4 tpm-create-key 2)
    (enc "created" k pcr-id-2 current-value aik-0) (5 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce))))
  (label 79)
  (parent 77)
  (unrealized (5 2) (6 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0)) ((6 3) (3 1))
    ((7 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (5 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain")))))
  (label 80)
  (parent 78)
  (unrealized (6 1) (6 2) (7 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((7 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (displaced 7 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (5 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain")))))
  (label 81)
  (parent 79)
  (unrealized (6 2) (7 1) (7 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (5 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain")))))
  (label 82)
  (parent 79)
  (unrealized (6 2) (8 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 83)
  (parent 80)
  (unrealized (6 1) (7 2) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((7 3) (5 2)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 84)
  (parent 81)
  (unrealized (7 1) (7 2) (8 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 7 9 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 85)
  (parent 82)
  (unrealized (7 2) (8 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 86)
  (parent 82)
  (unrealized (8 2) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((7 3) (5 2)) ((8 3) (6 2)) ((8 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (displaced 9 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 87)
  (parent 84)
  (unrealized (7 1) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((7 3) (5 2)) ((8 3) (6 2))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 88)
  (parent 84)
  (unrealized (7 1) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2)) ((8 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 9 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 89)
  (parent 85)
  (unrealized (8 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 90)
  (parent 85)
  (unrealized (8 1) (9 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 3) (6 2)) ((9 0) (2 0))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation channel-test (displaced 7 10 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (8 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 91)
  (parent 86)
  (unrealized (8 1) (9 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 3) (6 2)) ((9 3) (8 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 10 9 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (8 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 92)
  (parent 86)
  (unrealized (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 3) (6 2))
    ((10 3) (8 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (8 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 93)
  (parent 86)
  (unrealized (9 1) (10 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2)) ((8 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 9 2 alice 2)
    (ch-msg tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
    (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 94)
  (parent 89)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-1) (tpm tpm-3))))
  (origs (n (2 1)) (nonce-1 (8 0)) (pt-1 (8 3)) (nonce-0 (7 0))
    (pt-0 (7 3)) (k (4 1)) (nonce (6 0)) (pt (6 3)) (v (2 4))))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 10 2 alice 2)
    (ch-msg tpm-3 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-1)))
    (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 95)
  (parent 90)
  (unrealized (9 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))))
  (label 96)
  (parent 91)
  (unrealized (8 1) (9 1) (10 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 97)
  (parent 91)
  (unrealized (9 1) (10 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (9 1)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (2 0)) ((9 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (displaced 7 10 tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1)))))
  (label 98)
  (parent 92)
  (unrealized (8 1) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (precedes ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 1)) ((9 3) (6 2))
    ((9 3) (8 2)) ((10 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))))
  (label 99)
  (parent 92)
  (seen 109)
  (unrealized (9 1) (10 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 0)) ((9 3) (6 2))
    ((9 3) (8 2)) ((10 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 100)
  (parent 92)
  (unrealized (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (displaced 7 11 tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))))
  (label 101)
  (parent 93)
  (unrealized (8 1) (9 1) (10 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 1))
    ((9 3) (6 2)) ((10 3) (8 2)) ((11 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))))
  (label 102)
  (parent 93)
  (seen 114)
  (unrealized (9 1) (10 1) (11 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 3) (8 2)) ((11 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 103)
  (parent 93)
  (unrealized (10 1) (11 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (8 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 0) (10 1)) ((9 3) (7 2)) ((10 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))))
  (label 104)
  (parent 95)
  (unrealized (9 1) (10 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (8 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 0) (10 0)) ((9 3) (7 2)) ((10 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 105)
  (parent 95)
  (unrealized (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 3) (11 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 106)
  (parent 96)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 107)
  (parent 96)
  (unrealized (9 1) (10 1) (11 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation channel-test (displaced 11 2 alice 2)
    (ch-msg tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
    (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 108)
  (parent 97)
  (unrealized (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (9 1)) ((8 0) (10 1))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))))
  (label 109)
  (parent 98)
  (unrealized (8 1) (9 1) (10 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-5)
    (pt pt-4) (aik aik-0) (tpm tpm-5) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (9 1)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (2 0)) ((9 3) (10 1)) ((10 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 110)
  (parent 98)
  (unrealized (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (9 1)) ((8 0) (10 0))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 111)
  (parent 98)
  (unrealized (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-3)) (pcr-id pcr-id-5)
    (pt pt-4) (aik aik-0) (tpm tpm-6) (pcr pcr-0))
  (precedes ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 1)) ((9 3) (6 2))
    ((9 3) (8 2)) ((10 3) (11 1)) ((11 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-3) (9 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-3) nonce aik-0))))
  (label 112)
  (parent 99)
  (unrealized (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 1))
    ((9 0) (11 0)) ((9 3) (6 2)) ((9 3) (8 2)) ((10 3) (9 1))
    ((11 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 113)
  (parent 99)
  (unrealized (10 1) (11 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (8 1)) ((11 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1)))))
  (label 114)
  (parent 101)
  (unrealized (8 1) (9 1) (10 1) (11 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (11 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 115)
  (parent 101)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 116)
  (parent 101)
  (unrealized (9 1) (10 1) (11 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-3)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 1))
    ((9 3) (6 2)) ((10 3) (8 2)) ((11 3) (12 1)) ((12 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-3) nonce aik-0))))
  (label 117)
  (parent 102)
  (unrealized (9 1) (10 1) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 3) (8 2))
    ((11 3) (9 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 118)
  (parent 102)
  (unrealized (10 1) (11 1) (12 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (11 1)) ((9 3) (7 2)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (displaced 7 12 tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2)))))
  (label 119)
  (parent 103)
  (unrealized (9 1) (10 0) (11 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 0) (12 1)) ((10 3) (8 2)) ((11 1) (9 1))
    ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))))
  (label 120)
  (parent 103)
  (seen 139)
  (unrealized (10 1) (11 0) (12 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 0) (12 0)) ((10 3) (8 2)) ((11 1) (9 1))
    ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 121)
  (parent 103)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-3)) (pcr-id pcr-id-5)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (8 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 0) (10 1)) ((9 3) (7 2)) ((10 3) (11 1)) ((11 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-3) nonce aik-0))))
  (label 122)
  (parent 104)
  (unrealized (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (8 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (10 1)) ((9 0) (11 0)) ((9 3) (7 2))
    ((10 3) (9 1)) ((11 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 123)
  (parent 104)
  (unrealized (10 1) (11 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation channel-test (displaced 12 2 alice 2)
    (ch-msg tpm-4 (cat "extend" pcr-id-5 n (hash pcr-id-5 n nonce-2)))
    (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 124)
  (parent 107)
  (unrealized (10 1) (11 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (9 1)) ((8 0) (10 1))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 3) (11 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 125)
  (parent 109)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-4) (aik aik-0) (tpm tpm-6) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (9 1)) ((8 0) (10 1))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (11 1))
    ((10 3) (8 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 126)
  (parent 109)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (9 1))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (2 0)) ((9 3) (8 1)) ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 127)
  (parent 109)
  (unrealized (9 1) (10 1) (11 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 0) (11 1))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (11 1)) ((9 3) (8 1))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (displaced 7 12 tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2)))))
  (label 128)
  (parent 113)
  (unrealized (9 1) (10 0) (11 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 0) (12 1)) ((9 3) (6 2)) ((9 3) (8 2)) ((10 0) (12 1))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))))
  (label 129)
  (parent 113)
  (seen 148)
  (unrealized (10 1) (11 0) (12 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 0) (12 0)) ((9 3) (6 2)) ((9 3) (8 2)) ((10 0) (12 0))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 130)
  (parent 113)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (8 1)) ((11 3) (12 1)) ((12 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 131)
  (parent 114)
  (unrealized (8 1) (9 1) (10 1) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-7)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (12 1)) ((11 3) (8 1)) ((12 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 132)
  (parent 114)
  (unrealized (8 1) (9 1) (10 1) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1)) ((11 3) (8 1))
    ((12 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 133)
  (parent 114)
  (unrealized (9 1) (10 1) (11 1) (12 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))))
  (label 134)
  (parent 116)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 135)
  (parent 116)
  (unrealized (10 1) (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (displaced 7 13 tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))))
  (label 136)
  (parent 118)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 0) (13 1))
    ((10 3) (8 2)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))))
  (label 137)
  (parent 118)
  (seen 157)
  (unrealized (10 1) (11 1) (12 0) (13 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 138)
  (parent 118)
  (unrealized (11 1) (12 0) (13 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))))
  (label 139)
  (parent 119)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (11 1)) ((9 3) (7 2)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (12 1)) ((12 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 140)
  (parent 119)
  (unrealized (9 1) (10 0) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 141)
  (parent 119)
  (unrealized (10 0) (11 1) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-4)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 0) (12 1)) ((10 3) (8 2)) ((11 1) (9 1))
    ((12 3) (13 1)) ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-4) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-4)
          (hash pcr-id-5 (cat n nonce-4) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 n nonce-4) nonce aik-0))))
  (label 142)
  (parent 120)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 0)) ((9 3) (6 2)) ((10 0) (12 1)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 1) (9 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 143)
  (parent 120)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3)))))
  (label 144)
  (parent 123)
  (unrealized (10 1) (11 0) (12 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (12 0)) ((10 3) (9 1)) ((11 1) (9 1)) ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 145)
  (parent 123)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (12 1)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-3)))))
  (label 146)
  (parent 124)
  (unrealized (10 1) (11 0) (12 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (12 0)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 0) (12 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-3))
    (hash pcr-id-4 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-3))))
  (label 147)
  (parent 124)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2)))))
  (label 148)
  (parent 128)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-6) (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 0) (11 1))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (11 1)) ((9 3) (8 1))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (12 1)) ((12 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 149)
  (parent 128)
  (unrealized (9 1) (10 0) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-2))
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-2))))
  (label 150)
  (parent 128)
  (unrealized (10 0) (11 1) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-3) nonce-4))
    (pcr-id pcr-id-6) (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 0) (12 1)) ((9 3) (6 2)) ((9 3) (8 2)) ((10 0) (12 1))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (13 1)) ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-3) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-3) nonce-4) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-3) nonce-4)
          (hash pcr-id-5 (cat (cat n nonce-3) nonce-4) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)
          nonce aik-0))))
  (label 151)
  (parent 129)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 0)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (6 2))
    ((9 3) (8 2)) ((10 0) (12 1)) ((10 0) (13 0)) ((10 3) (9 1))
    ((11 1) (9 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 152)
  (parent 129)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 3) (8 1)) ((12 1) (8 1)) ((13 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2)))))
  (label 153)
  (parent 133)
  (unrealized (9 1) (10 1) (11 1) (12 0) (13 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 3) (8 1)) ((12 1) (8 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 154)
  (parent 133)
  (unrealized (10 1) (11 1) (12 0) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (13 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 155)
  (parent 134)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 156)
  (parent 134)
  (unrealized (10 1) (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2)))))
  (label 157)
  (parent 136)
  (unrealized (9 1) (10 1) (11 0) (12 1) (13 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (13 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 158)
  (parent 136)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 159)
  (parent 136)
  (unrealized (10 1) (11 0) (12 1) (13 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 nonce-6
      pcr-id-7 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-6) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-4)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 0) (13 1))
    ((10 3) (8 2)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (14 1))
    ((14 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-4)
          (hash pcr-id-6 (cat n nonce-4) nonce-6)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-4) nonce aik-0))))
  (label 160)
  (parent 137)
  (unrealized (10 1) (11 1) (12 0) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 3) (9 1))
    ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 161)
  (parent 137)
  (unrealized (11 1) (12 0) (13 1) (14 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (13 1)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (13 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1))
    ((13 0) (2 0)) ((13 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (displaced 7 14 tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 162)
  (parent 138)
  (unrealized (10 1) (11 0) (12 0) (13 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (12 0)) ((9 0) (14 1)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 0) (14 1)) ((11 3) (9 1)) ((12 1) (9 1))
    ((13 1) (10 1)) ((14 3) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))))
  (label 163)
  (parent 138)
  (seen 185)
  (unrealized (11 1) (12 0) (13 0) (14 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (12 0)) ((9 0) (14 0)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 0) (14 0)) ((11 3) (9 1)) ((12 1) (9 1))
    ((13 1) (10 1)) ((14 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 164)
  (parent 138)
  (unrealized (12 0) (13 0) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (13 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 165)
  (parent 139)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (13 1)) ((12 3) (9 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 166)
  (parent 139)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 0)) ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (9 1)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 167)
  (parent 139)
  (unrealized (10 0) (11 1) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-3) nonce-4))
    (pcr-id pcr-id-6) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (13 1))
    ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-3) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-3) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-3) nonce-4)
          (hash pcr-id-5 (cat (cat n nonce-3) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)
          nonce aik-0))))
  (label 168)
  (parent 144)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (2 0)) ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (12 1)) ((10 0) (13 0))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 169)
  (parent 144)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-6) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (12 1)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (13 1))
    ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 170)
  (parent 146)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (12 1)) ((8 0) (13 0)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 0) (12 1)) ((10 0) (13 0))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-3))
    (hash pcr-id-4 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-3))))
  (label 171)
  (parent 146)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-7) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (13 1)) ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 172)
  (parent 148)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-7) (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (13 1)) ((12 3) (9 1)) ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 173)
  (parent 148)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 1)) ((8 0) (13 0))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (11 1)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (8 1)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (9 1)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-2))
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-2))))
  (label 174)
  (parent 148)
  (unrealized (10 0) (11 1) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-8)
    (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 3) (8 1)) ((12 1) (8 1)) ((13 3) (14 1)) ((14 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 175)
  (parent 153)
  (unrealized (9 1) (10 1) (11 1) (12 0) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1))
    ((2 1) (14 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0))
    ((8 3) (6 2)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 3) (8 1)) ((12 1) (8 1))
    ((13 3) (9 1)) ((14 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 176)
  (parent 153)
  (unrealized (10 1) (11 1) (12 0) (13 1) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-8)
    (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 3) (14 1)) ((14 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 177)
  (parent 157)
  (unrealized (9 1) (10 1) (11 0) (12 1) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-8)
    (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (14 1)) ((13 3) (9 1)) ((14 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 178)
  (parent 157)
  (unrealized (9 1) (10 1) (11 0) (12 1) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 1) (14 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1))
    ((13 3) (9 1)) ((14 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 179)
  (parent 157)
  (unrealized (10 1) (11 0) (12 1) (13 1) (14 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1))
    ((14 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 180)
  (parent 159)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 0)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1))
    ((14 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 181)
  (parent 159)
  (unrealized (11 0) (12 1) (13 0) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0))
    ((14 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test (displaced 7 15 tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 182)
  (parent 161)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5
      pcr-id-7 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 1)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 0) (15 1))
    ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1))
    ((15 3) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))))
  (label 183)
  (parent 161)
  (seen 194)
  (unrealized (11 1) (12 0) (13 1) (14 0) (15 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 0)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 0) (15 0))
    ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1))
    ((15 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 184)
  (parent 161)
  (unrealized (12 0) (13 1) (14 0) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 1))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (10 1)) ((14 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 185)
  (parent 162)
  (unrealized (10 1) (11 0) (12 0) (13 1) (14 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-7) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (13 1)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (13 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1))
    ((13 0) (2 0)) ((13 3) (14 1)) ((14 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 186)
  (parent 162)
  (unrealized (10 1) (11 0) (12 0) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 0)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 0))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (10 1)) ((14 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 187)
  (parent 162)
  (unrealized (11 0) (12 0) (13 1) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 nonce-6
      pcr-id-7 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (deflistener (cat pcr-id-4 n nonce-4))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-5))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-6) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-3) nonce-5))
    (pcr-id pcr-id-7) (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (12 0)) ((9 0) (14 1)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 0) (14 1)) ((11 3) (9 1)) ((12 1) (9 1))
    ((13 1) (10 1)) ((14 3) (15 1)) ((15 2) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-3) nonce-5)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-3) nonce-5) (11 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((recv (cat pcr-id-4 n nonce-4)) (send (cat pcr-id-4 n nonce-4)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat (cat n nonce-3) nonce-5)
          (hash pcr-id-6 (cat (cat n nonce-3) nonce-5) nonce-6)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
    ((recv tpm-8 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-5 (cat n nonce-3) nonce-5)
          nonce aik-0))))
  (label 188)
  (parent 163)
  (unrealized (11 1) (12 0) (13 0) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 1)) ((2 1) (15 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (14 1)) ((9 0) (15 0))
    ((9 3) (6 2)) ((10 0) (13 0)) ((10 3) (8 2)) ((11 0) (14 1))
    ((11 0) (15 0)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 1) (10 1))
    ((14 3) (11 1)) ((15 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 189)
  (parent 163)
  (unrealized (12 0) (13 0) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 1)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0))
    ((12 3) (9 1)) ((13 3) (9 1)) ((14 1) (9 1)) ((15 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 190)
  (parent 179)
  (unrealized (10 1) (11 0) (12 1) (13 1) (14 0) (15 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 0)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (15 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0))
    ((12 3) (9 1)) ((13 3) (9 1)) ((14 1) (9 1)) ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 191)
  (parent 179)
  (unrealized (11 0) (12 1) (13 1) (14 0) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1))
    ((14 3) (15 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 192)
  (parent 180)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 0))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 0)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1)) ((14 3) (10 1))
    ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 193)
  (parent 180)
  (unrealized (11 0) (12 1) (13 0) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 1))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1))
    ((15 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 194)
  (parent 182)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1) (15 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-6) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0))
    ((14 3) (15 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-6))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-6)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 195)
  (parent 182)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 0))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 0)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1))
    ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 196)
  (parent 182)
  (unrealized (11 0) (12 1) (13 0) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 nonce-6
      pcr-id-7 nonce-7 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-6) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-4))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-5))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-7) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-8) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-3) nonce-5))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-9) (pcr pcr-3))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 1)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 0) (15 1))
    ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1))
    ((15 3) (16 1)) ((16 2) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-3) nonce-5)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-3) nonce-5) (11 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-4)
          (hash pcr-id-6 (cat n nonce-4) nonce-6)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4))))
    ((recv (cat pcr-id-4 n nonce-4)) (send (cat pcr-id-4 n nonce-4)))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-7 (cat (cat n nonce-3) nonce-5)
          (hash pcr-id-7 (cat (cat n nonce-3) nonce-5) nonce-7)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
    ((recv tpm-9 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-3) nonce-5)
          nonce aik-0))))
  (label 197)
  (parent 183)
  (unrealized (11 1) (12 0) (13 1) (14 0) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5
      pcr-id-7 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-8) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 1))
    ((2 1) (16 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 1))
    ((9 0) (16 0)) ((9 3) (6 2)) ((10 0) (13 1)) ((10 0) (14 0))
    ((10 3) (8 2)) ((11 0) (15 1)) ((11 0) (16 0)) ((11 3) (9 1))
    ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1)) ((15 3) (11 1))
    ((16 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 198)
  (parent 183)
  (unrealized (12 0) (13 1) (14 0) (15 1) (16 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 1))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (10 1)) ((14 3) (15 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 199)
  (parent 185)
  (unrealized (10 1) (11 0) (12 0) (13 1) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 1))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (15 1)) ((14 3) (10 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 200)
  (parent 185)
  (unrealized (10 1) (11 0) (12 0) (13 1) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1))
    ((8 0) (15 0)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (13 1)) ((10 0) (14 1)) ((10 0) (15 0)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0)) ((13 3) (10 1))
    ((14 3) (10 1)) ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 201)
  (parent 185)
  (unrealized (11 0) (12 0) (13 1) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 nonce-7 pcr-id-9 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-7)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-9) (pt pt-12) (aik aik-0) (tpm tpm-9) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 1)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0))
    ((12 3) (9 1)) ((13 3) (9 1)) ((14 1) (9 1)) ((15 3) (16 1))
    ((16 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-8 (cat (cat n nonce-2) nonce-4) nonce-7)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-9 (cat "quote" pcr-id-9 nonce))
      (load pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-9 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 202)
  (parent 190)
  (unrealized (10 1) (11 0) (12 1) (13 1) (14 0) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 1)) ((2 1) (16 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 1))
    ((8 0) (16 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 1))
    ((9 0) (14 0)) ((9 3) (7 2)) ((10 0) (15 1)) ((10 0) (16 0))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1))
    ((13 3) (9 1)) ((14 1) (9 1)) ((15 3) (10 1)) ((16 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 203)
  (parent 190)
  (unrealized (11 0) (12 1) (13 1) (14 0) (15 1) (16 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 nonce-7 pcr-id-9 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-6) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-7)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-9) (pt pt-12) (aik aik-0) (tpm tpm-9) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 1))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1))
    ((15 3) (16 1)) ((16 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-6))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-6)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-8 (cat (cat n nonce-2) nonce-4) nonce-7)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-9 (cat "quote" pcr-id-9 nonce))
      (load pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-9 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 204)
  (parent 194)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 nonce-7 pcr-id-9 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-6) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-7)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-9) (pt pt-10) (aik aik-0) (tpm tpm-9) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 1))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (16 1))
    ((15 3) (10 1)) ((16 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-6))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-6)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-8 (cat (cat n nonce-2) nonce-4) nonce-7)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-9 (cat "quote" pcr-id-9 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-9 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 205)
  (parent 194)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 1) (16 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1))
    ((8 0) (15 1)) ((8 0) (16 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 0) (15 1))
    ((10 0) (16 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (9 1))
    ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1)) ((15 3) (10 1))
    ((16 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 206)
  (parent 194)
  (unrealized (11 0) (12 1) (13 0) (14 1) (15 1) (16 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol envelope-plus basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm "power on") (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 "0")))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat "token" nonce))
      (recv tpm (cat "extend" pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send "ext ok"))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "quote" pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc "quote" pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat "create-req" pcr-id pcrval))
      (send (enc "created" k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "decrypt" (enc m k)))
      (recv (enc "created" k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey) (tpm chan))
    (trace (recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 2)
          (p "tpm-extend-enc" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (cat v1 v2)))
        (false))))
  (defrule ordered-extends
    (forall ((y z strd) (pcr locn))
      (implies
        (and (p "tpm-extend-enc" y 4) (p "tpm-extend-enc" z 4)
          (p "tpm-extend-enc" "pcr" y pcr)
          (p "tpm-extend-enc" "pcr" z pcr))
        (or (= y z) (prec y 3 z 2) (prec z 3 y 2))))))

(defskeleton envelope-plus
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 207)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment "Not a skeleton"))

(defskeleton envelope-plus
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 208)
  (parent 207)
  (unrealized (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpm-0 chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik) (1 3))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))))
  (label 209)
  (parent 208)
  (unrealized (0 0) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-1) (pcr pcr))
  (precedes ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm-0)
  (operation nonce-test (added-strand tpm-decrypt 4) v (0 0) (enc v k))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 210)
  (parent 209)
  (unrealized (2 0) (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 4 1 alice 3)
    (ch-msg tpm-1
      (cat "create-req" pcr-id (hash (hash "0" n) "obtain"))) (2 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 211)
  (parent 210)
  (unrealized (1 0) (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce v n k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat "token" nonce)) (1 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v))
    ((send tpm (cat "token" nonce))))
  (label 212)
  (parent 211)
  (unrealized (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id nonce text) (v n data) (pt pval) (k aik akey)
    (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n k)
  (genStV (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 5 2 tpm-create-key 2)
    (enc "created" k pcr-id-0 current-value aik-0) (3 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce))))
  (label 213)
  (parent 212)
  (unrealized (3 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)) ((4 3) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-0)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 4 5 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "obtain"))) (3 2))
  (traces ((recv v) (send v))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain")))))
  (label 214)
  (parent 213)
  (unrealized (4 1) (4 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id nonce pcr-id-0 nonce-0 text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)) ((5 3) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "obtain"))) (3 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain")))))
  (label 215)
  (parent 213)
  (unrealized (5 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((4 3) (3 2)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-0)
  (auth tpm-0)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces ((recv v) (send v))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 216)
  (parent 214)
  (unrealized (4 1) (5 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 4 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-1 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 217)
  (parent 215)
  (unrealized (5 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 218)
  (parent 215)
  (unrealized (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
    (5 1))
  (traces ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-1 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 219)
  (parent 217)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((v v) (n n) (pcr-id pcr-id) (nonce nonce-0) (k k) (aik aik)
        (tpm tpm-1))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (2 1)) (v (1 4))))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (displaced 4 7 tpm-extend-enc 4)
    (hash pcr-id-1 n nonce-0) (6 1))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0)))))
  (label 220)
  (parent 218)
  (unrealized (5 1) (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 0) (7 1))
    ((6 3) (5 2)) ((7 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-1 n nonce-1) (6 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))))
  (label 221)
  (parent 218)
  (seen 223)
  (unrealized (6 1) (7 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (deflistener (cat pcr-id-1 n nonce-1))
  (precedes ((1 1) (7 0)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 0) (7 0))
    ((6 3) (5 2)) ((7 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-1))
    (hash pcr-id-1 n nonce-1) (6 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1))))
  (label 222)
  (parent 218)
  (unrealized (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-1 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-0)))))
  (label 223)
  (parent 220)
  (unrealized (5 1) (6 1) (7 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-1)) (pcr-id pcr-id-3)
    (pt pt-3) (aik aik-0) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (7 1)) ((7 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-1)
    (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv tpm-3 (cat "quote" pcr-id-3 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
      (send
        (enc "quote" pcr-id-3 (hash pcr-id-1 n nonce-1) nonce aik-0))))
  (label 224)
  (parent 220)
  (unrealized (5 1) (6 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 0)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 0)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-0))
    (hash pcr-id-1 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0))))
  (label 225)
  (parent 220)
  (unrealized (6 1) (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id nonce-0 pcr-id-0 nonce-1 pcr-id-1 nonce-2 pcr-id-2 nonce-3
      pcr-id-3 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-2)) (pcr-id pcr-id-3)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 0) (7 1))
    ((6 3) (5 2)) ((7 3) (8 1)) ((8 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-2) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-2)
          (hash pcr-id-2 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-3 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2)))
      (send
        (enc "quote" pcr-id-3 (hash pcr-id-1 n nonce-2) nonce aik-0))))
  (label 226)
  (parent 221)
  (unrealized (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (precedes ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (7 1)) ((6 0) (8 0)) ((6 3) (5 2)) ((7 3) (6 1))
    ((8 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-1))
    (hash pcr-id-1 n nonce-1) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1))))
  (label 227)
  (parent 221)
  (unrealized (7 1) (8 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-1)) (pcr-id pcr-id-4)
    (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (8 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-1)
    (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-1 n nonce-1) nonce aik-0))))
  (label 228)
  (parent 223)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-1)) (pcr-id pcr-id-4)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (8 1))
    ((7 3) (5 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-1)
    (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-1 n nonce-1) nonce aik-0))))
  (label 229)
  (parent 223)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-1 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (6 1)) ((5 0) (7 1)) ((5 0) (8 0)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)) ((7 3) (5 1)) ((8 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-0))
    (hash pcr-id-1 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-0))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0))))
  (label 230)
  (parent 223)
  (unrealized (6 1) (7 1) (8 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (displaced 4 9 tpm-extend-enc 4)
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (7 1))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1)))))
  (label 231)
  (parent 227)
  (unrealized (6 1) (7 0) (8 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      pcr-id-3 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (5 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (7 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))))
  (label 232)
  (parent 227)
  (seen 234)
  (unrealized (7 1) (8 0) (9 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (deflistener (cat pcr-id-2 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 0)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (8 0)) ((6 0) (9 0)) ((6 3) (5 2)) ((7 0) (9 0))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-1) nonce-2))
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (7 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((recv (cat pcr-id-2 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-2 (cat n nonce-1) nonce-2))))
  (label 233)
  (parent 227)
  (unrealized (8 0) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-0) nonce-1)))))
  (label 234)
  (parent 231)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-4) (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (9 1)) ((9 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 235)
  (parent 231)
  (unrealized (6 1) (7 0) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-2 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 0)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 0)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 0)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-0) nonce-1))
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-2 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-2 (cat n nonce-0) nonce-1))))
  (label 236)
  (parent 231)
  (unrealized (7 0) (8 1) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id nonce-0 pcr-id-0 nonce-1 pcr-id-1 nonce-2 pcr-id-2 nonce-3
      pcr-id-3 nonce-4 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-4) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-4) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (5 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (10 1)) ((10 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 v n pt pt-0 pt-3
    pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-2) nonce-3) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-2) nonce-3))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-2)
          (hash pcr-id-2 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2))))
    ((recv (cat pcr-id-1 n nonce-2)) (send (cat pcr-id-1 n nonce-2)))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-3 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-3 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-2) nonce-3))))
    ((recv tpm-5 (cat "quote" pcr-id-4 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 237)
  (parent 232)
  (unrealized (7 1) (8 0) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      pcr-id-3 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (deflistener (cat pcr-id-2 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 1) (10 0)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0))
    ((5 3) (3 2)) ((6 0) (8 0)) ((6 0) (9 1)) ((6 0) (10 0))
    ((6 3) (5 2)) ((7 0) (9 1)) ((7 0) (10 0)) ((7 3) (6 1))
    ((8 1) (6 1)) ((9 3) (7 1)) ((10 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-1) nonce-2))
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-2 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-2 (cat n nonce-1) nonce-2))))
  (label 238)
  (parent 232)
  (unrealized (8 0) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-5) (pt pt-7) (aik aik-0) (tpm tpm-5) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (10 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 v n pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 239)
  (parent 234)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-5) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (10 1)) ((9 3) (6 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 v n pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 240)
  (parent 234)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (deflistener (cat pcr-id-2 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 1) (10 0))
    ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 3) (3 2)) ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1))
    ((5 0) (10 0)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 0) (9 1))
    ((6 0) (10 0)) ((6 3) (5 1)) ((7 1) (5 1)) ((8 0) (1 0))
    ((8 3) (6 1)) ((9 3) (6 1)) ((10 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-0) nonce-1))
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-2 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-2 (cat n nonce-0) nonce-1))))
  (label 241)
  (parent 234)
  (unrealized (7 0) (8 1) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol envelope-plus basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm "power on") (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 "0")))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat "token" nonce))
      (recv tpm (cat "extend" pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send "ext ok"))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "quote" pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc "quote" pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat "create-req" pcr-id pcrval))
      (send (enc "created" k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "decrypt" (enc m k)))
      (recv (enc "created" k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey) (tpm chan))
    (trace (recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 2)
          (p "tpm-extend-enc" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (cat v1 v2)))
        (false))))
  (defrule ordered-extends
    (forall ((y z strd) (pcr locn))
      (implies
        (and (p "tpm-extend-enc" y 4) (p "tpm-extend-enc" z 4)
          (p "tpm-extend-enc" "pcr" y pcr)
          (p "tpm-extend-enc" "pcr" z pcr))
        (or (= y z) (prec y 3 z 2) (prec z 3 y 2))))))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 242)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment "Not a skeleton"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 243)
  (parent 242)
  (unrealized (0 0) (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 4) (2 0)) ((2 2) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))))
  (label 244)
  (parent 243)
  (unrealized (1 3) (2 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (precedes ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik) (1 3))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))))
  (label 245)
  (parent 244)
  (unrealized (2 1) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (precedes ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "refuse"))) (2 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 246)
  (parent 245)
  (unrealized (3 0) (4 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 3) (2 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 5 1 alice 3)
    (ch-msg tpm-2
      (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain"))) (3 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 247)
  (parent 246)
  (unrealized (1 0) (4 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data) (pt pt-0 pval)
    (k aik akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 0) (1 0)) ((4 3) (2 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-0)
  (auth tpm-0)
  (operation channel-test (displaced 5 4 tpm-extend-enc 1)
    (ch-msg tpm-1 (cat "token" nonce-0)) (1 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 248)
  (parent 247)
  (unrealized (4 1) (4 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 3) (2 1)) ((5 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat "token" nonce)) (1 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce))))
  (label 249)
  (parent 247)
  (unrealized (4 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 0) (1 0)) ((4 3) (2 1)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-0)
  (auth tpm-0)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 250)
  (parent 248)
  (unrealized (4 1) (5 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 5 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 251)
  (parent 249)
  (unrealized (5 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 252)
  (parent 249)
  (unrealized (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
    (5 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 253)
  (parent 251)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-0) (tpm tpm-1))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (3 1)) (v (1 4))))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (displaced 5 7 tpm-extend-enc 4)
    (hash pcr-id-2 n nonce-0) (6 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0)))))
  (label 254)
  (parent 252)
  (unrealized (5 1) (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 0) (7 1))
    ((6 3) (4 2)) ((7 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 n nonce-1) (6 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))))
  (label 255)
  (parent 252)
  (seen 257)
  (unrealized (6 1) (7 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (deflistener (cat pcr-id-2 n nonce-1))
  (precedes ((1 1) (7 0)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 0) (7 0))
    ((6 3) (4 2)) ((7 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-1))
    (hash pcr-id-2 n nonce-1) (6 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1))))
  (label 256)
  (parent 252)
  (unrealized (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-0)
          (hash pcr-id-4 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-0)))))
  (label 257)
  (parent 254)
  (unrealized (5 1) (6 1) (7 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-1)) (pcr-id pcr-id-4)
    (pt pt-3) (aik aik-0) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (7 1)) ((7 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-1)
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv tpm-3 (cat "quote" pcr-id-4 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 n nonce-1) nonce aik-0))))
  (label 258)
  (parent 254)
  (unrealized (5 1) (6 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 0)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 0)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-0))
    (hash pcr-id-2 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0))))
  (label 259)
  (parent 254)
  (unrealized (6 1) (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-2)) (pcr-id pcr-id-4)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 0) (7 1))
    ((6 3) (4 2)) ((7 3) (8 1)) ((8 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-2) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-2)
          (hash pcr-id-3 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 n nonce-2) nonce aik-0))))
  (label 260)
  (parent 255)
  (unrealized (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (precedes ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (7 1)) ((6 0) (8 0)) ((6 3) (4 2)) ((7 3) (6 1))
    ((8 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-1))
    (hash pcr-id-2 n nonce-1) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1))))
  (label 261)
  (parent 255)
  (unrealized (7 1) (8 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-1)) (pcr-id pcr-id-5)
    (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (8 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-1)
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 n nonce-1) nonce aik-0))))
  (label 262)
  (parent 257)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-1)) (pcr-id pcr-id-5)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (8 1))
    ((7 3) (5 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-1)
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 n nonce-1) nonce aik-0))))
  (label 263)
  (parent 257)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-2 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (6 1)) ((5 0) (7 1)) ((5 0) (8 0)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)) ((7 3) (5 1)) ((8 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-0))
    (hash pcr-id-2 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-0))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-0)
          (hash pcr-id-4 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0))))
  (label 264)
  (parent 257)
  (unrealized (6 1) (7 1) (8 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (displaced 5 9 tpm-extend-enc 4)
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (7 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1)))))
  (label 265)
  (parent 261)
  (unrealized (6 1) (7 0) (8 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (4 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (7 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))))
  (label 266)
  (parent 261)
  (seen 268)
  (unrealized (7 1) (8 0) (9 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (deflistener (cat pcr-id-3 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 0)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (8 0)) ((6 0) (9 0)) ((6 3) (4 2)) ((7 0) (9 0))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-1) nonce-2))
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (7 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((recv (cat pcr-id-3 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-3 (cat n nonce-1) nonce-2))))
  (label 267)
  (parent 261)
  (unrealized (8 0) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-5 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-0) nonce-1)))))
  (label 268)
  (parent 265)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-5) (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (9 1)) ((9 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 269)
  (parent 265)
  (unrealized (6 1) (7 0) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-3 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 0)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 0)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 0)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-0) nonce-1))
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-3 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-3 (cat n nonce-0) nonce-1))))
  (label 270)
  (parent 265)
  (unrealized (7 0) (8 1) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-5) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (4 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (10 1)) ((10 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-3
    pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-2) nonce-3) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-2)
          (hash pcr-id-3 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2))))
    ((recv (cat pcr-id-2 n nonce-2)) (send (cat pcr-id-2 n nonce-2)))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-4 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-2) nonce-3))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 271)
  (parent 266)
  (unrealized (7 1) (8 0) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (deflistener (cat pcr-id-3 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 1) (10 0)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (1 0)) ((6 0) (8 0)) ((6 0) (9 1)) ((6 0) (10 0))
    ((6 3) (4 2)) ((7 0) (9 1)) ((7 0) (10 0)) ((7 3) (6 1))
    ((8 1) (6 1)) ((9 3) (7 1)) ((10 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-1) nonce-2))
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-3 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-3 (cat n nonce-1) nonce-2))))
  (label 272)
  (parent 266)
  (unrealized (8 0) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-6) (pt pt-7) (aik aik-0) (tpm tpm-5) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (10 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-6 nonce))
      (load pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 273)
  (parent 268)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-6) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (10 1)) ((9 3) (6 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 274)
  (parent 268)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (deflistener (cat pcr-id-3 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 1) (10 0))
    ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 3) (2 1)) ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1))
    ((5 0) (10 0)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 0) (9 1))
    ((6 0) (10 0)) ((6 3) (5 1)) ((7 1) (5 1)) ((8 0) (1 0))
    ((8 3) (6 1)) ((9 3) (6 1)) ((10 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-0) nonce-1))
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-5 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-3 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-3 (cat n nonce-0) nonce-1))))
  (label 275)
  (parent 268)
  (unrealized (7 0) (8 1) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol envelope-plus basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm "power on") (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 "0")))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat "token" nonce))
      (recv tpm (cat "extend" pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send "ext ok"))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "quote" pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc "quote" pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat "create-req" pcr-id pcrval))
      (send (enc "created" k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "decrypt" (enc m k)))
      (recv (enc "created" k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey) (tpm chan))
    (trace (recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 2)
          (p "tpm-extend-enc" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (cat v1 v2)))
        (false))))
  (defrule ordered-extends
    (forall ((y z strd) (pcr locn))
      (implies
        (and (p "tpm-extend-enc" y 4) (p "tpm-extend-enc" z 4)
          (p "tpm-extend-enc" "pcr" y pcr)
          (p "tpm-extend-enc" "pcr" z pcr))
        (or (= y z) (prec y 3 z 2) (prec z 3 y 2))))))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 276)
  (unrealized (0 0) (1 0) (2 3))
  (preskeleton)
  (origs (v (2 4)) (n (2 1)))
  (comment "Not a skeleton"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (precedes ((2 4) (0 0)) ((2 4) (1 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 277)
  (parent 276)
  (unrealized (0 0) (2 3))
  (origs (v (2 4)) (n (2 1)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((2 4) (1 0)) ((2 4) (3 0)) ((3 2) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))))
  (label 278)
  (parent 277)
  (unrealized (2 3) (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (precedes ((2 4) (1 0)) ((2 4) (3 0)) ((3 2) (0 0)) ((4 1) (2 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik) (2 3))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))))
  (label 279)
  (parent 278)
  (unrealized (1 0) (3 1) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (current-value mesg) (pcr-id pcr-id-0 nonce pcr-id-1 text)
    (n v data) (pt pt-0 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-2)
    (pcr pcr-0))
  (precedes ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (operation nonce-test (added-strand tpm-decrypt 4) v (1 0) (enc v k))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-2 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v)))
  (label 280)
  (parent 279)
  (unrealized (3 1) (4 0) (5 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (current-value mesg)
    (pcr-id pcr-id-0 nonce pcr-id-1 pcr-id-2 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-2)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-3) (pcr pcr))
  (precedes ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "refuse"))) (3 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-2 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-3 (cat "token" nonce-0))
      (recv tpm-3
        (cat "extend" pcr-id-2 "refuse"
          (hash pcr-id-2 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 281)
  (parent 280)
  (unrealized (4 0) (5 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (current-value mesg)
    (pcr-id pcr-id-0 nonce pcr-id-1 pcr-id-2 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-1)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 7 2 alice 3)
    (ch-msg tpm-3
      (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain"))) (4 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "refuse"
          (hash pcr-id-2 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 282)
  (parent 281)
  (unrealized (2 0) (5 1) (6 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (current-value mesg)
    (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 nonce text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-0)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0)) ((6 3) (3 1)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 7 6 tpm-extend-enc 1)
    (ch-msg tpm-2 (cat "token" nonce-0)) (2 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-2 "refuse" (hash pcr-id-2 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 283)
  (parent 282)
  (unrealized (5 1) (6 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (current-value mesg)
    (pcr-id pcr-id-0 nonce pcr-id-1 pcr-id-2 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-1)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat "token" nonce)) (2 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "refuse"
          (hash pcr-id-2 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce))))
  (label 284)
  (parent 282)
  (unrealized (5 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0)) ((6 3) (3 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 7 4 tpm-create-key 2)
    (enc "created" k pcr-id-2 current-value aik-0) (5 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 285)
  (parent 283)
  (unrealized (5 2) (6 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 8 4 tpm-create-key 2)
    (enc "created" k pcr-id-2 current-value aik-0) (5 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce))))
  (label 286)
  (parent 284)
  (unrealized (5 2) (6 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0)) ((6 3) (3 1))
    ((7 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (5 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain")))))
  (label 287)
  (parent 285)
  (unrealized (6 1) (6 2) (7 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((7 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (displaced 7 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (5 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain")))))
  (label 288)
  (parent 286)
  (unrealized (6 2) (7 1) (7 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (5 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain")))))
  (label 289)
  (parent 286)
  (unrealized (6 2) (8 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 290)
  (parent 287)
  (unrealized (6 1) (7 2) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((7 3) (5 2)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 291)
  (parent 288)
  (seen 294 295)
  (unrealized (7 1) (7 2) (8 1))
  (comment "5 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 7 9 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 292)
  (parent 289)
  (seen 297 298)
  (unrealized (7 2) (8 1))
  (comment "5 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 293)
  (parent 289)
  (seen 301 302)
  (unrealized (8 2) (9 1))
  (comment "6 in cohort - 4 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((6 3) (7 2)) ((7 0) (2 0)) ((7 3) (5 2)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule ordered-extends)
  (operation channel-test (displaced 9 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 294)
  (parent 291)
  (unrealized (7 1) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((7 3) (5 2)) ((7 3) (6 2)) ((8 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule ordered-extends)
  (operation channel-test (displaced 9 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 295)
  (parent 291)
  (unrealized (7 1) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((7 3) (5 2)) ((8 3) (6 2))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 296)
  (parent 291)
  (unrealized (7 1) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((6 3) (7 2)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule ordered-extends)
  (operation channel-test (displaced 9 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 297)
  (parent 292)
  (unrealized (8 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((7 3) (6 2)) ((8 0) (2 0)) ((8 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule ordered-extends)
  (operation channel-test (displaced 9 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 298)
  (parent 292)
  (unrealized (8 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 299)
  (parent 292)
  (unrealized (8 1) (9 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 3) (6 2)) ((9 0) (2 0))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation channel-test (displaced 7 10 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (8 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 300)
  (parent 293)
  (unrealized (8 1) (9 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((6 3) (8 2)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule ordered-extends)
  (operation channel-test (displaced 10 9 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (8 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 301)
  (parent 293)
  (unrealized (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((8 3) (6 2)) ((9 3) (8 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule ordered-extends)
  (operation channel-test (displaced 10 9 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (8 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 302)
  (parent 293)
  (unrealized (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 3) (6 2))
    ((10 3) (8 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (8 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 303)
  (parent 293)
  (unrealized (9 1) (10 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((6 3) (7 2)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 9 2 alice 2)
    (ch-msg tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
    (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 304)
  (parent 297)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-1) (tpm tpm-3))))
  (origs (n (2 1)) (nonce-1 (8 0)) (pt-1 (8 3)) (nonce-0 (7 0))
    (pt-0 (7 3)) (k (4 1)) (nonce (6 0)) (pt (6 3)) (v (2 4))))

(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((7 3) (6 2)) ((8 0) (2 0)) ((8 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 9 2 alice 2)
    (ch-msg tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
    (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 305)
  (parent 298)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-1) (tpm tpm-3))))
  (origs (n (2 1)) (nonce-1 (8 0)) (pt-1 (8 3)) (nonce-0 (7 0))
    (pt-0 (7 3)) (k (4 1)) (nonce (6 0)) (pt (6 3)) (v (2 4))))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 10 2 alice 2)
    (ch-msg tpm-3 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-1)))
    (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 306)
  (parent 299)
  (unrealized (9 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))))
  (label 307)
  (parent 300)
  (unrealized (8 1) (9 1) (10 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 308)
  (parent 300)
  (unrealized (9 1) (10 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((6 3) (7 2)) ((7 3) (5 2)) ((8 0) (9 1)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (displaced 7 10 tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1)))))
  (label 309)
  (parent 301)
  (unrealized (8 1) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (precedes ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((6 3) (8 2)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 1))
    ((9 3) (6 2)) ((10 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))))
  (label 310)
  (parent 301)
  (seen 323)
  (unrealized (9 1) (10 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((6 3) (8 2)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 0))
    ((9 3) (6 2)) ((10 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 311)
  (parent 301)
  (unrealized (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((7 3) (6 2)) ((8 0) (9 1)) ((8 3) (7 2))
    ((9 0) (2 0)) ((9 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (displaced 7 10 tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1)))))
  (label 312)
  (parent 302)
  (unrealized (8 1) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (precedes ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((8 3) (6 2)) ((9 0) (10 1))
    ((9 3) (8 2)) ((10 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))))
  (label 313)
  (parent 302)
  (seen 328)
  (unrealized (9 1) (10 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((8 3) (6 2)) ((9 0) (10 0))
    ((9 3) (8 2)) ((10 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 314)
  (parent 302)
  (unrealized (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (displaced 7 11 tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))))
  (label 315)
  (parent 303)
  (unrealized (8 1) (9 1) (10 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 1))
    ((9 3) (6 2)) ((10 3) (8 2)) ((11 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))))
  (label 316)
  (parent 303)
  (seen 333)
  (unrealized (9 1) (10 1) (11 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 3) (8 2)) ((11 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 317)
  (parent 303)
  (unrealized (10 1) (11 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (8 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 0) (10 1)) ((9 3) (7 2)) ((10 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))))
  (label 318)
  (parent 306)
  (unrealized (9 1) (10 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (8 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 0) (10 0)) ((9 3) (7 2)) ((10 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 319)
  (parent 306)
  (unrealized (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 3) (11 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 320)
  (parent 307)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 321)
  (parent 307)
  (unrealized (9 1) (10 1) (11 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation channel-test (displaced 11 2 alice 2)
    (ch-msg tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
    (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 322)
  (parent 308)
  (unrealized (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2)) ((8 0) (9 1))
    ((8 0) (10 1)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))))
  (label 323)
  (parent 309)
  (unrealized (8 1) (9 1) (10 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-5)
    (pt pt-4) (aik aik-0) (tpm tpm-5) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((6 3) (7 2)) ((7 3) (5 2)) ((8 0) (9 1)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (10 1)) ((10 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 324)
  (parent 309)
  (unrealized (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2)) ((8 0) (9 1))
    ((8 0) (10 0)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 325)
  (parent 309)
  (unrealized (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-3)) (pcr-id pcr-id-5)
    (pt pt-4) (aik aik-0) (tpm tpm-6) (pcr pcr-0))
  (precedes ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((6 3) (8 2)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 1))
    ((9 3) (6 2)) ((10 3) (11 1)) ((11 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-3) (9 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-3) nonce aik-0))))
  (label 326)
  (parent 310)
  (unrealized (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((6 3) (8 2)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (10 1)) ((9 0) (11 0)) ((9 3) (6 2)) ((10 3) (9 1))
    ((11 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 327)
  (parent 310)
  (unrealized (10 1) (11 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2)) ((8 0) (9 1))
    ((8 0) (10 1)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))))
  (label 328)
  (parent 312)
  (unrealized (8 1) (9 1) (10 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-5)
    (pt pt-4) (aik aik-0) (tpm tpm-5) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((7 3) (6 2)) ((8 0) (9 1)) ((8 3) (7 2))
    ((9 0) (2 0)) ((9 3) (10 1)) ((10 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 329)
  (parent 312)
  (unrealized (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2)) ((8 0) (9 1))
    ((8 0) (10 0)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 330)
  (parent 312)
  (unrealized (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-3)) (pcr-id pcr-id-5)
    (pt pt-4) (aik aik-0) (tpm tpm-6) (pcr pcr-0))
  (precedes ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((8 3) (6 2)) ((9 0) (10 1))
    ((9 3) (8 2)) ((10 3) (11 1)) ((11 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-3) (9 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-3) nonce aik-0))))
  (label 331)
  (parent 313)
  (unrealized (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((8 3) (6 2))
    ((9 0) (10 1)) ((9 0) (11 0)) ((9 3) (8 2)) ((10 3) (9 1))
    ((11 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 332)
  (parent 313)
  (unrealized (10 1) (11 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (8 1)) ((11 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1)))))
  (label 333)
  (parent 315)
  (unrealized (8 1) (9 1) (10 1) (11 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (11 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 334)
  (parent 315)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 335)
  (parent 315)
  (unrealized (9 1) (10 1) (11 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-3)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 1))
    ((9 3) (6 2)) ((10 3) (8 2)) ((11 3) (12 1)) ((12 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-3) nonce aik-0))))
  (label 336)
  (parent 316)
  (unrealized (9 1) (10 1) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 3) (8 2))
    ((11 3) (9 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 337)
  (parent 316)
  (unrealized (10 1) (11 1) (12 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (11 1)) ((9 3) (7 2)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (displaced 7 12 tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2)))))
  (label 338)
  (parent 317)
  (unrealized (9 1) (10 0) (11 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 0) (12 1)) ((10 3) (8 2)) ((11 1) (9 1))
    ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))))
  (label 339)
  (parent 317)
  (seen 364)
  (unrealized (10 1) (11 0) (12 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 0) (12 0)) ((10 3) (8 2)) ((11 1) (9 1))
    ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 340)
  (parent 317)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-3)) (pcr-id pcr-id-5)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (8 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 0) (10 1)) ((9 3) (7 2)) ((10 3) (11 1)) ((11 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-3) nonce aik-0))))
  (label 341)
  (parent 318)
  (unrealized (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (8 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (10 1)) ((9 0) (11 0)) ((9 3) (7 2))
    ((10 3) (9 1)) ((11 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 342)
  (parent 318)
  (unrealized (10 1) (11 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation channel-test (displaced 12 2 alice 2)
    (ch-msg tpm-4 (cat "extend" pcr-id-5 n (hash pcr-id-5 n nonce-2)))
    (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 343)
  (parent 321)
  (unrealized (10 1) (11 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2)) ((8 0) (9 1))
    ((8 0) (10 1)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 3) (11 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 344)
  (parent 323)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-4) (aik aik-0) (tpm tpm-6) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2)) ((8 0) (9 1))
    ((8 0) (10 1)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (11 1))
    ((10 3) (8 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 345)
  (parent 323)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2))
    ((8 0) (9 1)) ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (8 1)) ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 346)
  (parent 323)
  (unrealized (9 1) (10 1) (11 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 0) (11 1)) ((9 3) (8 1))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (displaced 7 12 tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2)))))
  (label 347)
  (parent 327)
  (unrealized (9 1) (10 0) (11 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((6 3) (8 2)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 0)) ((9 0) (12 1)) ((9 3) (6 2)) ((10 0) (12 1))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))))
  (label 348)
  (parent 327)
  (seen 373)
  (unrealized (10 1) (11 0) (12 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((6 3) (8 2)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 0)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 0) (12 0))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 349)
  (parent 327)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2)) ((8 0) (9 1))
    ((8 0) (10 1)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 3) (11 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 350)
  (parent 328)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-4) (aik aik-0) (tpm tpm-6) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2)) ((8 0) (9 1))
    ((8 0) (10 1)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (11 1))
    ((10 3) (8 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 351)
  (parent 328)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2))
    ((8 0) (9 1)) ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (7 2))
    ((9 0) (2 0)) ((9 3) (8 1)) ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 352)
  (parent 328)
  (unrealized (9 1) (10 1) (11 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 3) (7 2)) ((9 0) (11 1)) ((9 3) (8 1))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (displaced 7 12 tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2)))))
  (label 353)
  (parent 332)
  (unrealized (9 1) (10 0) (11 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((8 3) (6 2))
    ((9 0) (11 0)) ((9 0) (12 1)) ((9 3) (8 2)) ((10 0) (12 1))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))))
  (label 354)
  (parent 332)
  (seen 378)
  (unrealized (10 1) (11 0) (12 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((8 3) (6 2))
    ((9 0) (11 0)) ((9 0) (12 0)) ((9 3) (8 2)) ((10 0) (12 0))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 355)
  (parent 332)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (8 1)) ((11 3) (12 1)) ((12 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 356)
  (parent 333)
  (unrealized (8 1) (9 1) (10 1) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-7)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (12 1)) ((11 3) (8 1)) ((12 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 357)
  (parent 333)
  (unrealized (8 1) (9 1) (10 1) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1)) ((11 3) (8 1))
    ((12 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 358)
  (parent 333)
  (unrealized (9 1) (10 1) (11 1) (12 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))))
  (label 359)
  (parent 335)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 360)
  (parent 335)
  (unrealized (10 1) (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (displaced 7 13 tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))))
  (label 361)
  (parent 337)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 0) (13 1))
    ((10 3) (8 2)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))))
  (label 362)
  (parent 337)
  (seen 387)
  (unrealized (10 1) (11 1) (12 0) (13 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 363)
  (parent 337)
  (unrealized (11 1) (12 0) (13 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))))
  (label 364)
  (parent 338)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (11 1)) ((9 3) (7 2)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (12 1)) ((12 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 365)
  (parent 338)
  (unrealized (9 1) (10 0) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 366)
  (parent 338)
  (unrealized (10 0) (11 1) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-4)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 0) (12 1)) ((10 3) (8 2)) ((11 1) (9 1))
    ((12 3) (13 1)) ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-4) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-4)
          (hash pcr-id-5 (cat n nonce-4) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 n nonce-4) nonce aik-0))))
  (label 367)
  (parent 339)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 0)) ((9 3) (6 2)) ((10 0) (12 1)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 1) (9 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 368)
  (parent 339)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3)))))
  (label 369)
  (parent 342)
  (unrealized (10 1) (11 0) (12 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (12 0)) ((10 3) (9 1)) ((11 1) (9 1)) ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 370)
  (parent 342)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (12 1)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-3)))))
  (label 371)
  (parent 343)
  (unrealized (10 1) (11 0) (12 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (12 0)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 0) (12 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-3))
    (hash pcr-id-4 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-3))))
  (label 372)
  (parent 343)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2))
    ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (6 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2)))))
  (label 373)
  (parent 347)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-6) (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 0) (11 1)) ((9 3) (8 1))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (12 1)) ((12 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 374)
  (parent 347)
  (unrealized (9 1) (10 0) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2))
    ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-2))
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-2))))
  (label 375)
  (parent 347)
  (unrealized (10 0) (11 1) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-3) nonce-4))
    (pcr-id pcr-id-6) (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((6 3) (8 2)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 0)) ((9 0) (12 1)) ((9 3) (6 2)) ((10 0) (12 1))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (13 1)) ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-3) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-3) nonce-4) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-3) nonce-4)
          (hash pcr-id-5 (cat (cat n nonce-3) nonce-4) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)
          nonce aik-0))))
  (label 376)
  (parent 348)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((6 3) (8 2)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (11 0)) ((9 0) (12 1)) ((9 0) (13 0))
    ((9 3) (6 2)) ((10 0) (12 1)) ((10 0) (13 0)) ((10 3) (9 1))
    ((11 1) (9 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 377)
  (parent 348)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2))
    ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2)))))
  (label 378)
  (parent 353)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-6) (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 3) (7 2)) ((9 0) (11 1)) ((9 3) (8 1))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (12 1)) ((12 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 379)
  (parent 353)
  (unrealized (9 1) (10 0) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2))
    ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-2))
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-2))))
  (label 380)
  (parent 353)
  (unrealized (10 0) (11 1) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-3) nonce-4))
    (pcr-id pcr-id-6) (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((8 3) (6 2))
    ((9 0) (11 0)) ((9 0) (12 1)) ((9 3) (8 2)) ((10 0) (12 1))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (13 1)) ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-3) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-3) nonce-4) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-3) nonce-4)
          (hash pcr-id-5 (cat (cat n nonce-3) nonce-4) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)
          nonce aik-0))))
  (label 381)
  (parent 354)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 1)) ((9 0) (13 0))
    ((9 3) (8 2)) ((10 0) (12 1)) ((10 0) (13 0)) ((10 3) (9 1))
    ((11 1) (9 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 382)
  (parent 354)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 3) (8 1)) ((12 1) (8 1)) ((13 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2)))))
  (label 383)
  (parent 358)
  (unrealized (9 1) (10 1) (11 1) (12 0) (13 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 3) (8 1)) ((12 1) (8 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 384)
  (parent 358)
  (unrealized (10 1) (11 1) (12 0) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (13 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 385)
  (parent 359)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 386)
  (parent 359)
  (unrealized (10 1) (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2)))))
  (label 387)
  (parent 361)
  (unrealized (9 1) (10 1) (11 0) (12 1) (13 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (13 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 388)
  (parent 361)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 389)
  (parent 361)
  (unrealized (10 1) (11 0) (12 1) (13 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 nonce-6
      pcr-id-7 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-6) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-4)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 0) (13 1))
    ((10 3) (8 2)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (14 1))
    ((14 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-4)
          (hash pcr-id-6 (cat n nonce-4) nonce-6)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-4) nonce aik-0))))
  (label 390)
  (parent 362)
  (unrealized (10 1) (11 1) (12 0) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 3) (9 1))
    ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 391)
  (parent 362)
  (unrealized (11 1) (12 0) (13 1) (14 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (13 1)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (13 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1))
    ((13 0) (2 0)) ((13 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (displaced 7 14 tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 392)
  (parent 363)
  (unrealized (10 1) (11 0) (12 0) (13 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (12 0)) ((9 0) (14 1)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 0) (14 1)) ((11 3) (9 1)) ((12 1) (9 1))
    ((13 1) (10 1)) ((14 3) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))))
  (label 393)
  (parent 363)
  (seen 418)
  (unrealized (11 1) (12 0) (13 0) (14 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (12 0)) ((9 0) (14 0)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 0) (14 0)) ((11 3) (9 1)) ((12 1) (9 1))
    ((13 1) (10 1)) ((14 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 394)
  (parent 363)
  (unrealized (12 0) (13 0) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (13 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 395)
  (parent 364)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (13 1)) ((12 3) (9 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 396)
  (parent 364)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 0)) ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (9 1)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 397)
  (parent 364)
  (unrealized (10 0) (11 1) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-3) nonce-4))
    (pcr-id pcr-id-6) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (13 1))
    ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-3) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-3) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-3) nonce-4)
          (hash pcr-id-5 (cat (cat n nonce-3) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)
          nonce aik-0))))
  (label 398)
  (parent 369)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (2 0)) ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (12 1)) ((10 0) (13 0))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 399)
  (parent 369)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-6) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (12 1)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (13 1))
    ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 400)
  (parent 371)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (12 1)) ((8 0) (13 0)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 0) (12 1)) ((10 0) (13 0))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-3))
    (hash pcr-id-4 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-3))))
  (label 401)
  (parent 371)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-7) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2))
    ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (6 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (13 1)) ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 402)
  (parent 373)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-7) (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((6 3) (7 2)) ((7 3) (5 2))
    ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (6 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (13 1)) ((12 3) (9 1)) ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 403)
  (parent 373)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((6 3) (7 2))
    ((7 3) (5 2)) ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 1))
    ((8 0) (13 0)) ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (8 1)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (9 1)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-2))
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-2))))
  (label 404)
  (parent 373)
  (unrealized (10 0) (11 1) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-7) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2))
    ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (13 1)) ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 405)
  (parent 378)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-7) (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((7 3) (6 2))
    ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (13 1)) ((12 3) (9 1)) ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 406)
  (parent 378)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((7 3) (6 2)) ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 1))
    ((8 0) (13 0)) ((8 3) (7 2)) ((9 0) (11 1)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (8 1)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (9 1)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-2))
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-2))))
  (label 407)
  (parent 378)
  (unrealized (10 0) (11 1) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-8)
    (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 3) (8 1)) ((12 1) (8 1)) ((13 3) (14 1)) ((14 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 408)
  (parent 383)
  (unrealized (9 1) (10 1) (11 1) (12 0) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1))
    ((2 1) (14 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0))
    ((8 3) (6 2)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 3) (8 1)) ((12 1) (8 1))
    ((13 3) (9 1)) ((14 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 409)
  (parent 383)
  (unrealized (10 1) (11 1) (12 0) (13 1) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-8)
    (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 3) (14 1)) ((14 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 410)
  (parent 387)
  (unrealized (9 1) (10 1) (11 0) (12 1) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-8)
    (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (14 1)) ((13 3) (9 1)) ((14 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 411)
  (parent 387)
  (unrealized (9 1) (10 1) (11 0) (12 1) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 1) (14 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1))
    ((13 3) (9 1)) ((14 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 412)
  (parent 387)
  (unrealized (10 1) (11 0) (12 1) (13 1) (14 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1))
    ((14 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 413)
  (parent 389)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 0)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1))
    ((14 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 414)
  (parent 389)
  (unrealized (11 0) (12 1) (13 0) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0))
    ((14 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test (displaced 7 15 tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 415)
  (parent 391)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5
      pcr-id-7 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 1)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 0) (15 1))
    ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1))
    ((15 3) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))))
  (label 416)
  (parent 391)
  (seen 427)
  (unrealized (11 1) (12 0) (13 1) (14 0) (15 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 0)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 0) (15 0))
    ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1))
    ((15 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 417)
  (parent 391)
  (unrealized (12 0) (13 1) (14 0) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 1))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (10 1)) ((14 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 418)
  (parent 392)
  (unrealized (10 1) (11 0) (12 0) (13 1) (14 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-7) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (13 1)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (13 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1))
    ((13 0) (2 0)) ((13 3) (14 1)) ((14 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 419)
  (parent 392)
  (unrealized (10 1) (11 0) (12 0) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 0)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 0))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (10 1)) ((14 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 420)
  (parent 392)
  (unrealized (11 0) (12 0) (13 1) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 nonce-6
      pcr-id-7 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (deflistener (cat pcr-id-4 n nonce-4))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-5))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-6) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-3) nonce-5))
    (pcr-id pcr-id-7) (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (12 0)) ((9 0) (14 1)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 0) (14 1)) ((11 3) (9 1)) ((12 1) (9 1))
    ((13 1) (10 1)) ((14 3) (15 1)) ((15 2) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-3) nonce-5)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-3) nonce-5) (11 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((recv (cat pcr-id-4 n nonce-4)) (send (cat pcr-id-4 n nonce-4)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat (cat n nonce-3) nonce-5)
          (hash pcr-id-6 (cat (cat n nonce-3) nonce-5) nonce-6)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
    ((recv tpm-8 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-5 (cat n nonce-3) nonce-5)
          nonce aik-0))))
  (label 421)
  (parent 393)
  (unrealized (11 1) (12 0) (13 0) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 1)) ((2 1) (15 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (14 1)) ((9 0) (15 0))
    ((9 3) (6 2)) ((10 0) (13 0)) ((10 3) (8 2)) ((11 0) (14 1))
    ((11 0) (15 0)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 1) (10 1))
    ((14 3) (11 1)) ((15 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 422)
  (parent 393)
  (unrealized (12 0) (13 0) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 1)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0))
    ((12 3) (9 1)) ((13 3) (9 1)) ((14 1) (9 1)) ((15 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 423)
  (parent 412)
  (unrealized (10 1) (11 0) (12 1) (13 1) (14 0) (15 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 0)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (15 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0))
    ((12 3) (9 1)) ((13 3) (9 1)) ((14 1) (9 1)) ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 424)
  (parent 412)
  (unrealized (11 0) (12 1) (13 1) (14 0) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1))
    ((14 3) (15 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 425)
  (parent 413)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 0))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 0)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1)) ((14 3) (10 1))
    ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 426)
  (parent 413)
  (unrealized (11 0) (12 1) (13 0) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 1))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1))
    ((15 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 427)
  (parent 415)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1) (15 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-6) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0))
    ((14 3) (15 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-6))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-6)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 428)
  (parent 415)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 0))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 0)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1))
    ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 429)
  (parent 415)
  (unrealized (11 0) (12 1) (13 0) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 nonce-6
      pcr-id-7 nonce-7 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-6) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-4))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-5))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-7) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-8) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-3) nonce-5))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-9) (pcr pcr-3))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 1)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 0) (15 1))
    ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1))
    ((15 3) (16 1)) ((16 2) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-3) nonce-5)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-3) nonce-5) (11 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-4)
          (hash pcr-id-6 (cat n nonce-4) nonce-6)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4))))
    ((recv (cat pcr-id-4 n nonce-4)) (send (cat pcr-id-4 n nonce-4)))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-7 (cat (cat n nonce-3) nonce-5)
          (hash pcr-id-7 (cat (cat n nonce-3) nonce-5) nonce-7)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
    ((recv tpm-9 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-3) nonce-5)
          nonce aik-0))))
  (label 430)
  (parent 416)
  (unrealized (11 1) (12 0) (13 1) (14 0) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5
      pcr-id-7 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-8) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 1))
    ((2 1) (16 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 1))
    ((9 0) (16 0)) ((9 3) (6 2)) ((10 0) (13 1)) ((10 0) (14 0))
    ((10 3) (8 2)) ((11 0) (15 1)) ((11 0) (16 0)) ((11 3) (9 1))
    ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1)) ((15 3) (11 1))
    ((16 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 431)
  (parent 416)
  (unrealized (12 0) (13 1) (14 0) (15 1) (16 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 1))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (10 1)) ((14 3) (15 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 432)
  (parent 418)
  (unrealized (10 1) (11 0) (12 0) (13 1) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 1))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (15 1)) ((14 3) (10 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 433)
  (parent 418)
  (unrealized (10 1) (11 0) (12 0) (13 1) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1))
    ((8 0) (15 0)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (13 1)) ((10 0) (14 1)) ((10 0) (15 0)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0)) ((13 3) (10 1))
    ((14 3) (10 1)) ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 434)
  (parent 418)
  (unrealized (11 0) (12 0) (13 1) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 nonce-7 pcr-id-9 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-7)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-9) (pt pt-12) (aik aik-0) (tpm tpm-9) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 1)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0))
    ((12 3) (9 1)) ((13 3) (9 1)) ((14 1) (9 1)) ((15 3) (16 1))
    ((16 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-8 (cat (cat n nonce-2) nonce-4) nonce-7)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-9 (cat "quote" pcr-id-9 nonce))
      (load pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-9 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 435)
  (parent 423)
  (unrealized (10 1) (11 0) (12 1) (13 1) (14 0) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 1)) ((2 1) (16 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 1))
    ((8 0) (16 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 1))
    ((9 0) (14 0)) ((9 3) (7 2)) ((10 0) (15 1)) ((10 0) (16 0))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1))
    ((13 3) (9 1)) ((14 1) (9 1)) ((15 3) (10 1)) ((16 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 436)
  (parent 423)
  (unrealized (11 0) (12 1) (13 1) (14 0) (15 1) (16 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 nonce-7 pcr-id-9 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-6) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-7)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-9) (pt pt-12) (aik aik-0) (tpm tpm-9) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 1))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1))
    ((15 3) (16 1)) ((16 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-6))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-6)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-8 (cat (cat n nonce-2) nonce-4) nonce-7)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-9 (cat "quote" pcr-id-9 nonce))
      (load pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-9 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 437)
  (parent 427)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 nonce-7 pcr-id-9 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-6) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-7)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-9) (pt pt-10) (aik aik-0) (tpm tpm-9) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 1))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (16 1))
    ((15 3) (10 1)) ((16 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-6))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-6)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-8 (cat (cat n nonce-2) nonce-4) nonce-7)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-9 (cat "quote" pcr-id-9 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-9 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 438)
  (parent 427)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 1) (16 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1))
    ((8 0) (15 1)) ((8 0) (16 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 0) (15 1))
    ((10 0) (16 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (9 1))
    ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1)) ((15 3) (10 1))
    ((16 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 439)
  (parent 427)
  (unrealized (11 0) (12 1) (13 0) (14 1) (15 1) (16 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol envelope-plus-2 basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm "power on") (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 "0")))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat "token" nonce))
      (recv tpm (cat "extend" pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send "ext ok"))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "quote" pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc "quote" pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat "create-req" pcr-id pcrval))
      (send (enc "created" k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "decrypt" (enc m k)))
      (recv (enc "created" k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey) (tpm chan))
    (trace (recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 2)
          (p "tpm-extend-enc" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (cat v1 v2)))
        (false))))
  (defrule pcr-id-identifies-pcr
    (forall ((y z strd) (pcr-id text) (pcr pcr-0 locn))
      (implies
        (and (p "tpm-extend-enc" y 3) (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "pcr-id" y pcr-id)
          (p "tpm-extend-enc" "pcr-id" z pcr-id)
          (p "tpm-extend-enc" "pcr" y pcr)
          (p "tpm-extend-enc" "pcr" z pcr-0))
        (= pcr pcr-0)))))

(defskeleton envelope-plus-2
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 440)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment "Not a skeleton"))

(defskeleton envelope-plus-2
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 441)
  (parent 440)
  (unrealized (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpm-0 chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik) (1 3))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))))
  (label 442)
  (parent 441)
  (unrealized (0 0) (2 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-1) (pcr pcr))
  (precedes ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm-0)
  (operation nonce-test (added-strand tpm-decrypt 4) v (0 0) (enc v k))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 443)
  (parent 442)
  (unrealized (2 0) (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 4 1 alice 3)
    (ch-msg tpm-1
      (cat "create-req" pcr-id (hash (hash "0" n) "obtain"))) (2 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 444)
  (parent 443)
  (unrealized (1 0) (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce v n k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat "token" nonce)) (1 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v))
    ((send tpm (cat "token" nonce))))
  (label 445)
  (parent 444)
  (unrealized (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id nonce text) (v n data) (pt pval) (k aik akey)
    (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n k)
  (genStV (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 5 2 tpm-create-key 2)
    (enc "created" k pcr-id-0 current-value aik-0) (3 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce))))
  (label 446)
  (parent 445)
  (unrealized (3 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)) ((4 3) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-0)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 4 5 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "obtain"))) (3 2))
  (traces ((recv v) (send v))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain")))))
  (label 447)
  (parent 446)
  (unrealized (4 1) (4 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id nonce pcr-id-0 nonce-0 text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)) ((5 3) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "obtain"))) (3 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain")))))
  (label 448)
  (parent 446)
  (unrealized (5 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((4 3) (3 2)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-0)
  (auth tpm-0)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces ((recv v) (send v))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 449)
  (parent 447)
  (unrealized (4 1) (5 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 4 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-1 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 450)
  (parent 448)
  (unrealized (5 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 451)
  (parent 448)
  (unrealized (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
    (5 1))
  (traces ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-1 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 452)
  (parent 450)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((v v) (n n) (pcr-id pcr-id) (nonce nonce-0) (k k) (aik aik)
        (tpm tpm-1))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (2 1)) (v (1 4))))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (displaced 4 7 tpm-extend-enc 4)
    (hash pcr-id-1 n nonce-0) (6 1))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0)))))
  (label 453)
  (parent 451)
  (unrealized (5 1) (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 0) (7 1))
    ((6 3) (5 2)) ((7 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-1 n nonce-1) (6 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))))
  (label 454)
  (parent 451)
  (seen 456)
  (unrealized (6 1) (7 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (deflistener (cat pcr-id-1 n nonce-1))
  (precedes ((1 1) (7 0)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 0) (7 0))
    ((6 3) (5 2)) ((7 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-1))
    (hash pcr-id-1 n nonce-1) (6 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1))))
  (label 455)
  (parent 451)
  (unrealized (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-1 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-0)))))
  (label 456)
  (parent 453)
  (unrealized (5 1) (6 1) (7 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-1)) (pcr-id pcr-id-3)
    (pt pt-3) (aik aik-0) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (7 1)) ((7 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-1)
    (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv tpm-3 (cat "quote" pcr-id-3 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
      (send
        (enc "quote" pcr-id-3 (hash pcr-id-1 n nonce-1) nonce aik-0))))
  (label 457)
  (parent 453)
  (unrealized (5 1) (6 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 0)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 0)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-0))
    (hash pcr-id-1 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0))))
  (label 458)
  (parent 453)
  (unrealized (6 1) (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id nonce-0 pcr-id-0 nonce-1 pcr-id-1 nonce-2 pcr-id-2 nonce-3
      pcr-id-3 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-2)) (pcr-id pcr-id-3)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2)) ((6 0) (7 1))
    ((6 3) (5 2)) ((7 3) (8 1)) ((8 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-2) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-2)
          (hash pcr-id-2 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-3 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2)))
      (send
        (enc "quote" pcr-id-3 (hash pcr-id-1 n nonce-2) nonce aik-0))))
  (label 459)
  (parent 454)
  (unrealized (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (precedes ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (7 1)) ((6 0) (8 0)) ((6 3) (5 2)) ((7 3) (6 1))
    ((8 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-1))
    (hash pcr-id-1 n nonce-1) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1))))
  (label 460)
  (parent 454)
  (unrealized (7 1) (8 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-1)) (pcr-id pcr-id-4)
    (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (8 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-1)
    (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-1 n nonce-1) nonce aik-0))))
  (label 461)
  (parent 456)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-1 n nonce-1)) (pcr-id pcr-id-4)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (8 1))
    ((7 3) (5 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-1 n nonce-1)
    (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-1 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-1 n nonce-1) nonce aik-0))))
  (label 462)
  (parent 456)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-1 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (6 1)) ((5 0) (7 1)) ((5 0) (8 0)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)) ((7 3) (5 1)) ((8 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-1 n nonce-0))
    (hash pcr-id-1 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-0))))
  (traces ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id n (hash pcr-id n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-2 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-1))
      (stor pcr-1 (cat pt-5 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0))))
  (label 463)
  (parent 456)
  (unrealized (6 1) (7 1) (8 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (displaced 4 9 tpm-extend-enc 4)
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (7 1))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1)))))
  (label 464)
  (parent 460)
  (unrealized (6 1) (7 0) (8 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      pcr-id-3 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (5 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (7 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))))
  (label 465)
  (parent 460)
  (seen 467)
  (unrealized (7 1) (8 0) (9 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (deflistener (cat pcr-id-2 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 0)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (8 0)) ((6 0) (9 0)) ((6 3) (5 2)) ((7 0) (9 0))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-1) nonce-2))
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (7 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((recv (cat pcr-id-2 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-2 (cat n nonce-1) nonce-2))))
  (label 466)
  (parent 460)
  (unrealized (8 0) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-0) nonce-1)))))
  (label 467)
  (parent 464)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-4) (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (9 1)) ((9 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 468)
  (parent 464)
  (unrealized (6 1) (7 0) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (v n data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-2 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 0)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 0)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 0)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 v n pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-0) nonce-1))
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-2 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-2 (cat n nonce-0) nonce-1))))
  (label 469)
  (parent 464)
  (unrealized (7 0) (8 1) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id nonce-0 pcr-id-0 nonce-1 pcr-id-1 nonce-2 pcr-id-2 nonce-3
      pcr-id-3 nonce-4 pcr-id-4 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-4) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-4) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (2 0)) ((1 4) (3 0))
    ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0)) ((5 3) (3 2))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (5 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (10 1)) ((10 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 v n pt pt-0 pt-3
    pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-2) nonce-3) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-2) nonce-3))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce-0)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-2)
          (hash pcr-id-2 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-2))))
    ((recv (cat pcr-id-1 n nonce-2)) (send (cat pcr-id-1 n nonce-2)))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-3 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-3 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-2) nonce-3))))
    ((recv tpm-5 (cat "quote" pcr-id-4 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 470)
  (parent 465)
  (unrealized (7 1) (8 0) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2
      pcr-id-3 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (deflistener (cat pcr-id-2 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 1) (10 0)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 0) (1 0))
    ((5 3) (3 2)) ((6 0) (8 0)) ((6 0) (9 1)) ((6 0) (10 0))
    ((6 3) (5 2)) ((7 0) (9 1)) ((7 0) (10 0)) ((7 3) (6 1))
    ((8 1) (6 1)) ((9 3) (7 1)) ((10 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-1) nonce-2))
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm (cat "token" nonce)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-2 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-2 (cat n nonce-1) nonce-2))))
  (label 471)
  (parent 465)
  (unrealized (8 0) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-5) (pt pt-7) (aik aik-0) (tpm tpm-5) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (10 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 v n pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 472)
  (parent 467)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-5) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (2 0))
    ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0)) ((4 3) (3 2))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (10 1)) ((9 3) (6 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 v n pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-2 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain"
          (hash pcr-id-0 "obtain" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-1)
          (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-1))))
    ((recv (cat pcr-id-1 n nonce-1)) (send (cat pcr-id-1 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-3 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 473)
  (parent 467)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (v n data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-1) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-1 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (deflistener (cat pcr-id-2 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 1) (10 0))
    ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 3) (3 2)) ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1))
    ((5 0) (10 0)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 0) (9 1))
    ((6 0) (10 0)) ((6 3) (5 1)) ((7 1) (5 1)) ((8 0) (1 0))
    ((8 3) (6 1)) ((9 3) (6 1)) ((10 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 v n pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-2 (cat n nonce-0) nonce-1))
    (hash pcr-id-2 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
  (traces ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id n (hash pcr-id n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-3 (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (send (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik)))
    ((recv tpm (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-0 "obtain" (hash pcr-id-0 "obtain" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "obtain"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 (cat n nonce-0)
          (hash pcr-id-2 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-1))
      (stor pcr-0 (cat pt-3 (hash pcr-id-1 n nonce-0))))
    ((recv (cat pcr-id-1 n nonce-0)) (send (cat pcr-id-1 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-3 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-2))
      (stor pcr-2 (cat pt-7 (hash pcr-id-2 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-2 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-2 (cat n nonce-0) nonce-1))))
  (label 474)
  (parent 467)
  (unrealized (7 0) (8 1) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol envelope-plus-2 basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm "power on") (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 "0")))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat "token" nonce))
      (recv tpm (cat "extend" pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send "ext ok"))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "quote" pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc "quote" pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat "create-req" pcr-id pcrval))
      (send (enc "created" k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "decrypt" (enc m k)))
      (recv (enc "created" k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey) (tpm chan))
    (trace (recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 2)
          (p "tpm-extend-enc" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (cat v1 v2)))
        (false))))
  (defrule pcr-id-identifies-pcr
    (forall ((y z strd) (pcr-id text) (pcr pcr-0 locn))
      (implies
        (and (p "tpm-extend-enc" y 3) (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "pcr-id" y pcr-id)
          (p "tpm-extend-enc" "pcr-id" z pcr-id)
          (p "tpm-extend-enc" "pcr" y pcr)
          (p "tpm-extend-enc" "pcr" z pcr-0))
        (= pcr pcr-0)))))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 475)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment "Not a skeleton"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 476)
  (parent 475)
  (unrealized (0 0) (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 4) (2 0)) ((2 2) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))))
  (label 477)
  (parent 476)
  (unrealized (1 3) (2 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (precedes ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik) (1 3))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))))
  (label 478)
  (parent 477)
  (unrealized (2 1) (3 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (precedes ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "refuse"))) (2 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 479)
  (parent 478)
  (unrealized (3 0) (4 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 3) (2 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 5 1 alice 3)
    (ch-msg tpm-2
      (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain"))) (3 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 480)
  (parent 479)
  (unrealized (1 0) (4 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data) (pt pt-0 pval)
    (k aik akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 0) (1 0)) ((4 3) (2 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-0)
  (auth tpm-0)
  (operation channel-test (displaced 5 4 tpm-extend-enc 1)
    (ch-msg tpm-1 (cat "token" nonce-0)) (1 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 481)
  (parent 480)
  (unrealized (4 1) (4 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 3) (2 1)) ((5 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat "token" nonce)) (1 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce))))
  (label 482)
  (parent 480)
  (unrealized (4 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 0) (1 0)) ((4 3) (2 1)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-0)
  (auth tpm-0)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0 (cat "token" nonce))
      (send tpm-0 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-0
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 483)
  (parent 481)
  (unrealized (4 1) (5 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 5 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 484)
  (parent 482)
  (unrealized (5 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash "0" n))) (4 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 485)
  (parent 482)
  (unrealized (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
    (5 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1 (cat "token" nonce-0))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n)))))
  (label 486)
  (parent 484)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-0) (tpm tpm-1))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (3 1)) (v (1 4))))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (displaced 5 7 tpm-extend-enc 4)
    (hash pcr-id-2 n nonce-0) (6 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0)))))
  (label 487)
  (parent 485)
  (unrealized (5 1) (6 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 0) (7 1))
    ((6 3) (4 2)) ((7 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 n nonce-1) (6 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))))
  (label 488)
  (parent 485)
  (seen 490)
  (unrealized (6 1) (7 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (deflistener (cat pcr-id-2 n nonce-1))
  (precedes ((1 1) (7 0)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 0) (7 0))
    ((6 3) (4 2)) ((7 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-1))
    (hash pcr-id-2 n nonce-1) (6 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1))))
  (label 489)
  (parent 485)
  (unrealized (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-2 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-0)
          (hash pcr-id-4 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-0)))))
  (label 490)
  (parent 487)
  (unrealized (5 1) (6 1) (7 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-1)) (pcr-id pcr-id-4)
    (pt pt-3) (aik aik-0) (tpm tpm-3) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (7 1)) ((7 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-1)
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv tpm-3 (cat "quote" pcr-id-4 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 n nonce-1) nonce aik-0))))
  (label 491)
  (parent 487)
  (unrealized (5 1) (6 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 0)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 0)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-0))
    (hash pcr-id-2 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0))))
  (label 492)
  (parent 487)
  (unrealized (6 1) (7 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-2)) (pcr-id pcr-id-4)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0))
    ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0)) ((6 0) (7 1))
    ((6 3) (4 2)) ((7 3) (8 1)) ((8 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-2) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-2)
          (hash pcr-id-3 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-4 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2)))
      (send
        (enc "quote" pcr-id-4 (hash pcr-id-2 n nonce-2) nonce aik-0))))
  (label 493)
  (parent 488)
  (unrealized (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (precedes ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (7 1)) ((6 0) (8 0)) ((6 3) (4 2)) ((7 3) (6 1))
    ((8 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-1))
    (hash pcr-id-2 n nonce-1) (6 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1))))
  (label 494)
  (parent 488)
  (unrealized (7 1) (8 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-1)) (pcr-id pcr-id-5)
    (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (5 1))
    ((7 3) (8 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-1)
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 n nonce-1) nonce aik-0))))
  (label 495)
  (parent 490)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-2 n nonce-1)) (pcr-id pcr-id-5)
    (pt pt-3) (aik aik-0) (tpm tpm-4) (pcr pcr-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (6 1))
    ((5 0) (7 1)) ((5 3) (4 2)) ((6 0) (1 0)) ((6 3) (8 1))
    ((7 3) (5 1)) ((8 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-2 n nonce-1)
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-2 n nonce-1) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-2))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-1))))
    ((recv tpm-4 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-2 n nonce-1) nonce aik-0))))
  (label 496)
  (parent 490)
  (unrealized (5 1) (6 1) (7 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-2 n nonce-0))
  (precedes ((1 1) (6 1)) ((1 1) (7 1)) ((1 1) (8 0)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (6 1)) ((5 0) (7 1)) ((5 0) (8 0)) ((5 3) (4 2))
    ((6 0) (1 0)) ((6 3) (5 1)) ((7 3) (5 1)) ((8 1) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation encryption-test (added-listener (cat pcr-id-2 n nonce-0))
    (hash pcr-id-2 n nonce-0) (5 1)
    (ch-msg pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0)))
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-0))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2 (cat "token" nonce-1))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat n nonce-0)
          (hash pcr-id-4 (cat n nonce-0) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-2))
      (stor pcr-1 (cat pt-5 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0))))
  (label 497)
  (parent 490)
  (unrealized (6 1) (7 1) (8 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (displaced 5 9 tpm-extend-enc 4)
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (7 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1)))))
  (label 498)
  (parent 494)
  (unrealized (6 1) (7 0) (8 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (4 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (7 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))))
  (label 499)
  (parent 494)
  (seen 501)
  (unrealized (7 1) (8 0) (9 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (deflistener (cat pcr-id-3 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 0)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (8 0)) ((6 0) (9 0)) ((6 3) (4 2)) ((7 0) (9 0))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-1) nonce-2))
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (7 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((recv (cat pcr-id-3 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-3 (cat n nonce-1) nonce-2))))
  (label 500)
  (parent 494)
  (unrealized (8 0) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-5 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-0) nonce-1)))))
  (label 501)
  (parent 498)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-5) (pt pt-5) (aik aik-0) (tpm tpm-4) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (7 0))
    ((5 0) (8 1)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 3) (5 1))
    ((7 1) (5 1)) ((8 0) (1 0)) ((8 3) (9 1)) ((9 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv tpm-4 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 502)
  (parent 498)
  (unrealized (6 1) (7 0) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (deflistener (cat pcr-id-3 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 0)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 0)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 0)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-3 pt-5 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-0) nonce-1))
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-3 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-3 (cat n nonce-0) nonce-1))))
  (label 503)
  (parent 498)
  (unrealized (7 0) (8 1) (9 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-2) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-5) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 2) (3 0)) ((1 4) (2 0))
    ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1)) ((5 0) (1 0))
    ((6 0) (8 0)) ((6 0) (9 1)) ((6 3) (4 2)) ((7 0) (9 1))
    ((7 3) (6 1)) ((8 1) (6 1)) ((9 3) (10 1)) ((10 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-3
    pt-5 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-2) nonce-3) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-2)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-2)
          (hash pcr-id-3 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-2))))
    ((recv (cat pcr-id-2 n nonce-2)) (send (cat pcr-id-2 n nonce-2)))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-4 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-2) nonce-3))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 504)
  (parent 499)
  (unrealized (7 1) (8 0) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-4) (pcr pcr-1))
  (deflistener (cat pcr-id-3 (cat n nonce-1) nonce-2))
  (precedes ((1 1) (8 0)) ((1 1) (9 1)) ((1 1) (10 0)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (1 0)) ((6 0) (8 0)) ((6 0) (9 1)) ((6 0) (10 0))
    ((6 3) (4 2)) ((7 0) (9 1)) ((7 0) (10 0)) ((7 3) (6 1))
    ((8 1) (6 1)) ((9 3) (7 1)) ((10 1) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-1) nonce-2))
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (7 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-3 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-3 (cat n nonce-1) nonce-2))))
  (label 505)
  (parent 499)
  (unrealized (8 0) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-6) (pt pt-7) (aik aik-0) (tpm tpm-5) (pcr pcr-2))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (6 1)) ((9 3) (10 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-6 nonce))
      (load pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 506)
  (parent 501)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 (cat n nonce-1) nonce-2))
    (pcr-id pcr-id-6) (pt pt-5) (aik aik-0) (tpm tpm-5) (pcr pcr-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 2) (3 0))
    ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3)) ((4 3) (2 1))
    ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1)) ((5 3) (4 2))
    ((6 0) (8 1)) ((6 0) (9 1)) ((6 3) (5 1)) ((7 1) (5 1))
    ((8 0) (1 0)) ((8 3) (10 1)) ((9 3) (6 1)) ((10 2) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-3
    pt-5 pt-7 k)
  (genStV (hash "0" n) (hash pcr-id-3 (cat n nonce-1) nonce-2)
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 (cat n nonce-1) nonce-2) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-3))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce-0))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-1))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-2))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-1)
          (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-1))))
    ((recv (cat pcr-id-2 n nonce-1)) (send (cat pcr-id-2 n nonce-1)))
    ((send tpm-3 (cat "token" nonce-3))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-4 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((send tpm-4 (cat "token" nonce-4))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-1) nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-1) nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 (cat n nonce-1) nonce-2)
          nonce aik-0))))
  (label 507)
  (parent 501)
  (unrealized (6 1) (7 0) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-0))
    (current-value pcr-id-2) (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2)
    (pt-0 pt-3) (tpm tpm-2) (pcr pcr-0))
  (deflistener (cat pcr-id-2 n nonce-0))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4)
    (pt-0 pt-5) (tpm tpm-3) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-0) nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-6)
    (pt-0 pt-7) (tpm tpm-4) (pcr pcr-2))
  (deflistener (cat pcr-id-3 (cat n nonce-0) nonce-1))
  (precedes ((1 1) (7 0)) ((1 1) (8 1)) ((1 1) (9 1)) ((1 1) (10 0))
    ((1 2) (3 0)) ((1 4) (2 0)) ((2 2) (0 0)) ((3 1) (1 3))
    ((4 3) (2 1)) ((5 0) (7 0)) ((5 0) (8 1)) ((5 0) (9 1))
    ((5 0) (10 0)) ((5 3) (4 2)) ((6 0) (8 1)) ((6 0) (9 1))
    ((6 0) (10 0)) ((6 3) (5 1)) ((7 1) (5 1)) ((8 0) (1 0))
    ((8 3) (6 1)) ((9 3) (6 1)) ((10 1) (6 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-3 pt-5
    pt-7 k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-3 (cat n nonce-0) nonce-1))
    (hash pcr-id-3 (cat n nonce-0) nonce-1) (6 1)
    (ch-msg pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1)))
    (ch-msg pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((send tpm-0 (cat "token" nonce))
      (recv tpm-0
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-0 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1 (cat "extend" pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 "0")) (stor pcr (cat pt-0 (hash "0" n))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-3 (cat n nonce-0)
          (hash pcr-id-3 (cat n nonce-0) nonce-1)))
      (load pcr-0 (cat pt-2 pcr-id-2))
      (stor pcr-0 (cat pt-3 (hash pcr-id-2 n nonce-0))))
    ((recv (cat pcr-id-2 n nonce-0)) (send (cat pcr-id-2 n nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-4 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-4 (cat (cat n nonce-0) nonce-1) nonce-2)))
      (load pcr-1 (cat pt-4 pcr-id-3))
      (stor pcr-1 (cat pt-5 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-5 (cat (cat n nonce-0) nonce-1)
          (hash pcr-id-5 (cat (cat n nonce-0) nonce-1) nonce-3)))
      (load pcr-2 (cat pt-6 pcr-id-3))
      (stor pcr-2 (cat pt-7 (hash pcr-id-3 (cat n nonce-0) nonce-1))))
    ((recv (cat pcr-id-3 (cat n nonce-0) nonce-1))
      (send (cat pcr-id-3 (cat n nonce-0) nonce-1))))
  (label 508)
  (parent 501)
  (unrealized (7 0) (8 1) (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol envelope-plus-2 basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm "power on") (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 "0")))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat "token" nonce))
      (recv tpm (cat "extend" pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send "ext ok"))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "quote" pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc "quote" pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat "create-req" pcr-id pcrval))
      (send (enc "created" k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat "decrypt" (enc m k)))
      (recv (enc "created" k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey) (tpm chan))
    (trace (recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat "create-req" pcr-id (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-power-on" z 2)
          (p "tpm-power-on" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-extend-enc" z 2)
          (p "tpm-extend-enc" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-decrypt" z 3)
          (p "tpm-decrypt" "current-value" z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p "tpm-quote" z 2)
          (p "tpm-quote" "current-value" z (cat v1 v2)))
        (false))))
  (defrule pcr-id-identifies-pcr
    (forall ((y z strd) (pcr-id text) (pcr pcr-0 locn))
      (implies
        (and (p "tpm-extend-enc" y 3) (p "tpm-extend-enc" z 3)
          (p "tpm-extend-enc" "pcr-id" y pcr-id)
          (p "tpm-extend-enc" "pcr-id" z pcr-id)
          (p "tpm-extend-enc" "pcr" y pcr)
          (p "tpm-extend-enc" "pcr" z pcr-0))
        (= pcr pcr-0)))))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 509)
  (unrealized (0 0) (1 0) (2 3))
  (preskeleton)
  (origs (v (2 4)) (n (2 1)))
  (comment "Not a skeleton"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (precedes ((2 4) (0 0)) ((2 4) (1 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k))))
  (label 510)
  (parent 509)
  (unrealized (0 0) (2 3))
  (origs (v (2 4)) (n (2 1)))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((2 4) (1 0)) ((2 4) (3 0)) ((3 2) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))))
  (label 511)
  (parent 510)
  (unrealized (2 3) (3 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (precedes ((2 4) (1 0)) ((2 4) (3 0)) ((3 2) (0 0)) ((4 1) (2 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik) (2 3))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))))
  (label 512)
  (parent 511)
  (unrealized (1 0) (3 1) (4 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (current-value mesg) (pcr-id pcr-id-0 nonce pcr-id-1 text)
    (n v data) (pt pt-0 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-2)
    (pcr pcr-0))
  (precedes ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (operation nonce-test (added-strand tpm-decrypt 4) v (1 0) (enc v k))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-2 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v)))
  (label 513)
  (parent 512)
  (unrealized (3 1) (4 0) (5 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (current-value mesg)
    (pcr-id pcr-id-0 nonce pcr-id-1 pcr-id-2 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-2)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-3) (pcr pcr))
  (precedes ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm-1)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash "0" n) "refuse"))) (3 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-2 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-3 (cat "token" nonce-0))
      (recv tpm-3
        (cat "extend" pcr-id-2 "refuse"
          (hash pcr-id-2 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 514)
  (parent 513)
  (unrealized (4 0) (5 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (current-value mesg)
    (pcr-id pcr-id-0 nonce pcr-id-1 pcr-id-2 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-1)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 7 2 alice 3)
    (ch-msg tpm-3
      (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain"))) (4 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "refuse"
          (hash pcr-id-2 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 515)
  (parent 514)
  (unrealized (2 0) (5 1) (6 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (current-value mesg)
    (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 nonce text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-0)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0)) ((6 3) (3 1)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (displaced 7 6 tpm-extend-enc 1)
    (ch-msg tpm-2 (cat "token" nonce-0)) (2 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-2 "refuse" (hash pcr-id-2 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 516)
  (parent 515)
  (unrealized (5 1) (6 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (current-value mesg)
    (pcr-id pcr-id-0 nonce pcr-id-1 pcr-id-2 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik aik-0 akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt-0) (k k) (aik aik-0) (tpm tpm-1)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat "token" nonce)) (2 0))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-1 current-value aik-0))
      (load pcr-0 (cat pt-0 current-value)) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "refuse"
          (hash pcr-id-2 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce))))
  (label 517)
  (parent 515)
  (unrealized (5 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0)) ((6 3) (3 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 7 4 tpm-create-key 2)
    (enc "created" k pcr-id-2 current-value aik-0) (5 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse")))))
  (label 518)
  (parent 516)
  (unrealized (5 2) (6 1) (6 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpm tpm-0 tpm-1 tpm-2 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 8 4 tpm-create-key 2)
    (enc "created" k pcr-id-2 current-value aik-0) (5 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce))))
  (label 519)
  (parent 517)
  (unrealized (5 2) (6 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0)) ((6 3) (3 1))
    ((7 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (5 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain")))))
  (label 520)
  (parent 518)
  (unrealized (6 1) (6 2) (7 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((7 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (displaced 7 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (5 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain")))))
  (label 521)
  (parent 519)
  (unrealized (6 2) (7 1) (7 2))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (precedes ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (5 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain")))))
  (label 522)
  (parent 519)
  (unrealized (6 2) (8 2))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 0) (2 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-1)
  (auth tpm-1)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat "token" nonce))
      (send tpm-1 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-1
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-1
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 523)
  (parent 520)
  (unrealized (6 1) (7 2) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((7 3) (5 2)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 524)
  (parent 521)
  (unrealized (7 1) (7 2) (8 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 7 9 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 525)
  (parent 522)
  (unrealized (7 2) (8 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-1 (hash "0" n))) (6 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 526)
  (parent 522)
  (unrealized (8 2) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((7 3) (5 2)) ((8 3) (6 2)) ((8 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (displaced 9 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 527)
  (parent 524)
  (unrealized (7 1) (8 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-2))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-2))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((7 3) (5 2)) ((8 3) (6 2))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-2)
  (auth tpm-2)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-2 (cat "token" nonce-0))
      (send tpm-2 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-2
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-2
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 528)
  (parent 524)
  (unrealized (7 1) (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2)) ((8 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 9 8 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 529)
  (parent 525)
  (unrealized (8 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (7 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 530)
  (parent 525)
  (unrealized (8 1) (9 1))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 3) (6 2)) ((9 0) (2 0))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation channel-test (displaced 7 10 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (8 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 531)
  (parent 526)
  (unrealized (8 1) (9 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 3) (6 2)) ((9 3) (8 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 10 9 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash "0" n))) (8 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 532)
  (parent 526)
  (unrealized (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 3) (6 2))
    ((10 3) (8 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash "0" n))) (8 2))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 533)
  (parent 526)
  (unrealized (9 1) (10 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 1) (8 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2)) ((8 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 9 2 alice 2)
    (ch-msg tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
    (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n)))))
  (label 534)
  (parent 529)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-1) (tpm tpm-3))))
  (origs (n (2 1)) (nonce-1 (8 0)) (pt-1 (8 3)) (nonce-0 (7 0))
    (pt-0 (7 3)) (k (4 1)) (nonce (6 0)) (pt (6 3)) (v (2 4))))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (precedes ((2 1) (8 1)) ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 3) (7 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation channel-test (displaced 10 2 alice 2)
    (ch-msg tpm-3 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-1)))
    (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n)))))
  (label 535)
  (parent 530)
  (unrealized (9 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))))
  (label 536)
  (parent 531)
  (unrealized (8 1) (9 1) (10 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 537)
  (parent 531)
  (unrealized (9 1) (10 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (9 1)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (2 0)) ((9 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (displaced 7 10 tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1)))))
  (label 538)
  (parent 532)
  (unrealized (8 1) (9 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (precedes ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 1)) ((9 3) (6 2))
    ((9 3) (8 2)) ((10 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))))
  (label 539)
  (parent 532)
  (seen 549)
  (unrealized (9 1) (10 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 0)) ((9 3) (6 2))
    ((9 3) (8 2)) ((10 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 540)
  (parent 532)
  (unrealized (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (displaced 7 11 tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))))
  (label 541)
  (parent 533)
  (unrealized (8 1) (9 1) (10 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 1))
    ((9 3) (6 2)) ((10 3) (8 2)) ((11 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))))
  (label 542)
  (parent 533)
  (seen 554)
  (unrealized (9 1) (10 1) (11 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 3) (8 2)) ((11 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 543)
  (parent 533)
  (unrealized (10 1) (11 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (8 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 0) (10 1)) ((9 3) (7 2)) ((10 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))))
  (label 544)
  (parent 535)
  (unrealized (9 1) (10 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (8 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 0) (10 0)) ((9 3) (7 2)) ((10 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 545)
  (parent 535)
  (unrealized (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 3) (11 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 546)
  (parent 536)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 547)
  (parent 536)
  (unrealized (9 1) (10 1) (11 0))
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-2 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation channel-test (displaced 11 2 alice 2)
    (ch-msg tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
    (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 548)
  (parent 537)
  (unrealized (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (9 1)) ((8 0) (10 1))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))))
  (label 549)
  (parent 538)
  (unrealized (8 1) (9 1) (10 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-5)
    (pt pt-4) (aik aik-0) (tpm tpm-5) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (9 1)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (2 0)) ((9 3) (10 1)) ((10 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-5 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 550)
  (parent 538)
  (unrealized (8 1) (9 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (9 1)) ((8 0) (10 0))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-1 pt-4 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 551)
  (parent 538)
  (unrealized (9 1) (10 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-3)) (pcr-id pcr-id-5)
    (pt pt-4) (aik aik-0) (tpm tpm-6) (pcr pcr-0))
  (precedes ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 1)) ((9 3) (6 2))
    ((9 3) (8 2)) ((10 3) (11 1)) ((11 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-3) (9 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-5 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-3) nonce aik-0))))
  (label 552)
  (parent 539)
  (unrealized (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (10 1))
    ((9 0) (11 0)) ((9 3) (6 2)) ((9 3) (8 2)) ((10 3) (9 1))
    ((11 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 553)
  (parent 539)
  (unrealized (10 1) (11 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (8 1)) ((11 3) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1)))))
  (label 554)
  (parent 541)
  (unrealized (8 1) (9 1) (10 1) (11 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1)) ((8 3) (6 2))
    ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (11 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 555)
  (parent 541)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 556)
  (parent 541)
  (unrealized (9 1) (10 1) (11 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-3)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 1))
    ((9 3) (6 2)) ((10 3) (8 2)) ((11 3) (12 1)) ((12 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-3) nonce aik-0))))
  (label 557)
  (parent 542)
  (unrealized (9 1) (10 1) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 3) (8 2))
    ((11 3) (9 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 558)
  (parent 542)
  (unrealized (10 1) (11 1) (12 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (11 1)) ((9 3) (7 2)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (displaced 7 12 tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2)))))
  (label 559)
  (parent 543)
  (unrealized (9 1) (10 0) (11 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 0) (12 1)) ((10 3) (8 2)) ((11 1) (9 1))
    ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))))
  (label 560)
  (parent 543)
  (seen 579)
  (unrealized (10 1) (11 0) (12 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 0) (12 0)) ((10 3) (8 2)) ((11 1) (9 1))
    ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 561)
  (parent 543)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-3)) (pcr-id pcr-id-5)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (8 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0)) ((8 3) (6 2))
    ((9 0) (10 1)) ((9 3) (7 2)) ((10 3) (11 1)) ((11 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-5 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3)))
      (send
        (enc "quote" pcr-id-5 (hash pcr-id-3 n nonce-3) nonce aik-0))))
  (label 562)
  (parent 544)
  (unrealized (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (precedes ((2 1) (8 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (10 1)) ((9 0) (11 0)) ((9 3) (7 2))
    ((10 3) (9 1)) ((11 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-2))
    (hash pcr-id-3 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2))))
  (label 563)
  (parent 544)
  (unrealized (10 1) (11 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation channel-test (displaced 12 2 alice 2)
    (ch-msg tpm-4 (cat "extend" pcr-id-5 n (hash pcr-id-5 n nonce-2)))
    (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 564)
  (parent 547)
  (unrealized (10 1) (11 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (9 1)) ((8 0) (10 1))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (8 1))
    ((10 3) (11 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 565)
  (parent 549)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-6)
    (pt pt-4) (aik aik-0) (tpm tpm-6) (pcr pcr-0))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (9 1)) ((8 0) (10 1))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (2 0)) ((9 3) (11 1))
    ((10 3) (8 1)) ((11 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 566)
  (parent 549)
  (unrealized (8 1) (9 1) (10 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (9 1))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (2 0)) ((9 3) (8 1)) ((10 3) (8 1)) ((11 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1)))
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 567)
  (parent 549)
  (unrealized (9 1) (10 1) (11 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 0) (11 1))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (11 1)) ((9 3) (8 1))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (displaced 7 12 tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2)))))
  (label 568)
  (parent 553)
  (unrealized (9 1) (10 0) (11 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 0) (12 1)) ((9 3) (6 2)) ((9 3) (8 2)) ((10 0) (12 1))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))))
  (label 569)
  (parent 553)
  (seen 588)
  (unrealized (10 1) (11 0) (12 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan) (pcr pcr-0 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 0) (12 0)) ((9 3) (6 2)) ((9 3) (8 2)) ((10 0) (12 0))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 570)
  (parent 553)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (8 1)) ((11 3) (12 1)) ((12 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 571)
  (parent 554)
  (unrealized (8 1) (9 1) (10 1) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-3 n nonce-2)) (pcr-id pcr-id-7)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 1)) ((8 3) (6 2)) ((9 3) (7 2)) ((10 0) (2 0))
    ((10 3) (12 1)) ((11 3) (8 1)) ((12 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-3 n nonce-2)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-3 n nonce-2) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-3 n nonce-2) nonce aik-0))))
  (label 572)
  (parent 554)
  (unrealized (8 1) (9 1) (10 1) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (precedes ((2 1) (9 1)) ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1)) ((11 3) (8 1))
    ((12 1) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-3 n nonce-1))
    (hash pcr-id-3 n nonce-1) (8 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1))))
  (label 573)
  (parent 554)
  (unrealized (9 1) (10 1) (11 1) (12 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))))
  (label 574)
  (parent 556)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 575)
  (parent 556)
  (unrealized (10 1) (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (displaced 7 13 tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))))
  (label 576)
  (parent 558)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 0) (13 1))
    ((10 3) (8 2)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))))
  (label 577)
  (parent 558)
  (seen 597)
  (unrealized (10 1) (11 1) (12 0) (13 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 578)
  (parent 558)
  (unrealized (11 1) (12 0) (13 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))))
  (label 579)
  (parent 559)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 3) (6 2))
    ((9 0) (11 1)) ((9 3) (7 2)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (12 1)) ((12 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 580)
  (parent 559)
  (unrealized (9 1) (10 0) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 581)
  (parent 559)
  (unrealized (10 0) (11 1) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-4)) (pcr-id pcr-id-6)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 3) (6 2)) ((10 0) (12 1)) ((10 3) (8 2)) ((11 1) (9 1))
    ((12 3) (13 1)) ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-4) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-4)
          (hash pcr-id-5 (cat n nonce-4) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 n nonce-4) nonce aik-0))))
  (label 582)
  (parent 560)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 0)) ((9 3) (6 2)) ((10 0) (12 1)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 1) (9 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 583)
  (parent 560)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3)))))
  (label 584)
  (parent 563)
  (unrealized (10 1) (11 0) (12 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (12 0)) ((10 3) (9 1)) ((11 1) (9 1)) ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 585)
  (parent 563)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (12 1)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-3)))))
  (label 586)
  (parent 564)
  (unrealized (10 1) (11 0) (12 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (12 0)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 0) (12 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-2
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-3))
    (hash pcr-id-4 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-3))))
  (label 587)
  (parent 564)
  (unrealized (11 0) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2)))))
  (label 588)
  (parent 568)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-6) (pt pt-6) (aik aik-0) (tpm tpm-6) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0)) ((8 0) (11 1))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (11 1)) ((9 3) (8 1))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (12 1)) ((12 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0 pt-1
    pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-6 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 589)
  (parent 568)
  (unrealized (9 1) (10 0) (11 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 n v pt pt-0 pt-1 pt-4
    pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-2))
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-2))))
  (label 590)
  (parent 568)
  (unrealized (10 0) (11 1) (12 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-3) nonce-4))
    (pcr-id pcr-id-6) (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (11 0))
    ((9 0) (12 1)) ((9 3) (6 2)) ((9 3) (8 2)) ((10 0) (12 1))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (13 1)) ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-3) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-3) nonce-4) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-3) nonce-4)
          (hash pcr-id-5 (cat (cat n nonce-3) nonce-4) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)
          nonce aik-0))))
  (label 591)
  (parent 569)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-3) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-5) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 0)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (6 2))
    ((9 3) (8 2)) ((10 0) (12 1)) ((10 0) (13 0)) ((10 3) (9 1))
    ((11 1) (9 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 592)
  (parent 569)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 3) (8 1)) ((12 1) (8 1)) ((13 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2)))))
  (label 593)
  (parent 573)
  (unrealized (9 1) (10 1) (11 1) (12 0) (13 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 3) (8 1)) ((12 1) (8 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 594)
  (parent 573)
  (unrealized (10 1) (11 1) (12 0) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (13 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 595)
  (parent 574)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 596)
  (parent 574)
  (unrealized (10 1) (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 3) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2)))))
  (label 597)
  (parent 576)
  (unrealized (9 1) (10 1) (11 0) (12 1) (13 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 1))
    ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (13 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 598)
  (parent 576)
  (unrealized (9 1) (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 599)
  (parent 576)
  (unrealized (10 1) (11 0) (12 1) (13 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 nonce-6
      pcr-id-7 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-6) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-4)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2)) ((10 0) (13 1))
    ((10 3) (8 2)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (14 1))
    ((14 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-4)
          (hash pcr-id-6 (cat n nonce-4) nonce-6)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-4) nonce aik-0))))
  (label 600)
  (parent 577)
  (unrealized (10 1) (11 1) (12 0) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (precedes ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (11 1)) ((9 0) (12 0)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 3) (9 1))
    ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-3))
    (hash pcr-id-4 n nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3))))
  (label 601)
  (parent 577)
  (unrealized (11 1) (12 0) (13 1) (14 0))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (13 1)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (13 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1))
    ((13 0) (2 0)) ((13 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (displaced 7 14 tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 602)
  (parent 578)
  (unrealized (10 1) (11 0) (12 0) (13 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (12 0)) ((9 0) (14 1)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 0) (14 1)) ((11 3) (9 1)) ((12 1) (9 1))
    ((13 1) (10 1)) ((14 3) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))))
  (label 603)
  (parent 578)
  (seen 625)
  (unrealized (11 1) (12 0) (13 0) (14 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 0)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (12 0)) ((9 0) (14 0)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 0) (14 0)) ((11 3) (9 1)) ((12 1) (9 1))
    ((13 1) (10 1)) ((14 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 604)
  (parent 578)
  (unrealized (12 0) (13 0) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (13 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 605)
  (parent 579)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-7)
    (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 1) (8 1)) ((11 0) (2 0)) ((11 3) (13 1)) ((12 3) (9 1))
    ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 606)
  (parent 579)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 0)) ((8 3) (6 2)) ((9 0) (11 1)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (9 1)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 607)
  (parent 579)
  (unrealized (10 0) (11 1) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-3) nonce-4))
    (pcr-id pcr-id-6) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (2 0))
    ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 1)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (13 1))
    ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-3) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-3) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-2))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-3)
          (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-3) nonce-4)
          (hash pcr-id-5 (cat (cat n nonce-3) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-3) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-3) nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-3) nonce-4)
          nonce aik-0))))
  (label 608)
  (parent 584)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-1) (n n) (v v) (k k)
    (aik aik) (tpm tpm-3))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-3))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 (cat n nonce-2) nonce-3))
  (precedes ((2 1) (8 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (2 0)) ((8 3) (6 2)) ((9 0) (11 0)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (12 1)) ((10 0) (13 0))
    ((10 3) (9 1)) ((11 1) (9 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-3)
  (auth tpm-3)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-2) nonce-3))
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-3 (cat "token" nonce-1))
      (send tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (send tpm-3
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-3
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv (cat pcr-id-4 (cat n nonce-2) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-2) nonce-3))))
  (label 609)
  (parent 584)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-6) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (12 1)) ((8 3) (6 2)) ((9 0) (2 0)) ((9 3) (7 2))
    ((10 0) (12 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (13 1))
    ((13 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-3))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-6 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-6 (hash pcr-id-4 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 610)
  (parent 586)
  (unrealized (10 1) (11 0) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-2) (n n) (v v) (k k)
    (aik aik) (tpm tpm-4))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-4))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-0) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (9 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (12 1)) ((8 0) (13 0)) ((8 3) (6 2))
    ((9 0) (2 0)) ((9 3) (7 2)) ((10 0) (12 1)) ((10 0) (13 0))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (10 1)) ((13 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-4)
  (auth tpm-4)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-3))
    (hash pcr-id-4 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-4 (cat "token" nonce-2))
      (send tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (send tpm-4
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-4
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-3))))
  (label 611)
  (parent 586)
  (unrealized (11 0) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-7) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (9 1)) ((12 3) (13 1)) ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 612)
  (parent 588)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 (cat n nonce-2) nonce-3))
    (pcr-id pcr-id-7) (pt pt-6) (aik aik-0) (tpm tpm-7) (pcr pcr-1))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (10 0))
    ((8 0) (11 1)) ((8 0) (12 1)) ((8 3) (6 2)) ((8 3) (7 2))
    ((9 0) (11 1)) ((9 0) (12 1)) ((9 3) (8 1)) ((10 1) (8 1))
    ((11 0) (2 0)) ((11 3) (13 1)) ((12 3) (9 1)) ((13 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-4 (cat n nonce-2) nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 (cat n nonce-2) nonce-3) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-2)
          (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-5 (cat (cat n nonce-2) nonce-3) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-2) nonce-3))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-2) nonce-3)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-4 (cat n nonce-2) nonce-3)
          nonce aik-0))))
  (label 613)
  (parent 588)
  (unrealized (9 1) (10 0) (11 1) (12 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-2) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-3)
    (pt-0 pt-4) (tpm tpm-4) (pcr pcr-0))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 (cat n nonce-1) nonce-2))
  (precedes ((2 1) (10 0)) ((2 1) (11 1)) ((2 1) (12 1)) ((2 1) (13 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 0)) ((8 0) (11 1)) ((8 0) (12 1)) ((8 0) (13 0))
    ((8 3) (6 2)) ((8 3) (7 2)) ((9 0) (11 1)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (8 1)) ((10 1) (8 1)) ((11 0) (2 0))
    ((11 3) (9 1)) ((12 3) (9 1)) ((13 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-4 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test
    (added-listener (cat pcr-id-4 (cat n nonce-1) nonce-2))
    (hash pcr-id-4 (cat n nonce-1) nonce-2) (9 1)
    (ch-msg pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2)))
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-2 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4
        (cat "extend" pcr-id-4 (cat n nonce-1)
          (hash pcr-id-4 (cat n nonce-1) nonce-2)))
      (load pcr-0 (cat pt-3 pcr-id-3))
      (stor pcr-0 (cat pt-4 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-5 (cat (cat n nonce-1) nonce-2) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-4))
      (stor pcr-1 (cat pt-6 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-2)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 (cat n nonce-1) nonce-2))))
    ((recv (cat pcr-id-4 (cat n nonce-1) nonce-2))
      (send (cat pcr-id-4 (cat n nonce-1) nonce-2))))
  (label 614)
  (parent 588)
  (unrealized (10 0) (11 1) (12 1) (13 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-8)
    (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0)) ((8 3) (6 2))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 0) (2 0)) ((10 3) (8 1))
    ((11 3) (8 1)) ((12 1) (8 1)) ((13 3) (14 1)) ((14 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-4))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 615)
  (parent 593)
  (unrealized (9 1) (10 1) (11 1) (12 0) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-3) (n n) (v v) (k k)
    (aik aik) (tpm tpm-5))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-5))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 1)) ((2 1) (12 0)) ((2 1) (13 1))
    ((2 1) (14 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (10 1)) ((8 0) (11 1)) ((8 0) (12 0))
    ((8 3) (6 2)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (2 0)) ((10 3) (8 1)) ((11 3) (8 1)) ((12 1) (8 1))
    ((13 3) (9 1)) ((14 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-5)
  (auth tpm-5)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-5 (cat "token" nonce-3))
      (send tpm-5 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-3)))
      (send tpm-5
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-5
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-1)
          (hash pcr-id-6 (cat n nonce-1) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-3))
      (stor pcr-2 (cat pt-8 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 616)
  (parent 593)
  (unrealized (10 1) (11 1) (12 0) (13 1) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-8)
    (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 3) (14 1)) ((14 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 617)
  (parent 597)
  (unrealized (9 1) (10 1) (11 0) (12 1) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-4 n nonce-3)) (pcr-id pcr-id-8)
    (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 1)) ((9 3) (7 2)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (14 1)) ((13 3) (9 1)) ((14 2) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-4 n nonce-3)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-4 n nonce-3) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-4 n nonce-3) nonce aik-0))))
  (label 618)
  (parent 597)
  (unrealized (9 1) (10 1) (11 0) (12 1) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (precedes ((2 1) (10 1)) ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1))
    ((2 1) (14 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (10 1)) ((8 0) (11 0)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1))
    ((13 3) (9 1)) ((14 1) (9 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-listener (cat pcr-id-4 n nonce-2))
    (hash pcr-id-4 n nonce-2) (9 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2))))
  (label 619)
  (parent 597)
  (unrealized (10 1) (11 0) (12 1) (13 1) (14 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1))
    ((14 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 620)
  (parent 599)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 0)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1))
    ((14 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 621)
  (parent 599)
  (unrealized (11 0) (12 1) (13 0) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0))
    ((14 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test (displaced 7 15 tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 622)
  (parent 601)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5
      pcr-id-7 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 1)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 0) (15 1))
    ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1))
    ((15 3) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))))
  (label 623)
  (parent 601)
  (seen 634)
  (unrealized (11 1) (12 0) (13 1) (14 0) (15 1))
  (comment "3 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 0)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 0) (15 0))
    ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1))
    ((15 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 624)
  (parent 601)
  (unrealized (12 0) (13 1) (14 0) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 1))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (10 1)) ((14 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 625)
  (parent 602)
  (unrealized (10 1) (11 0) (12 0) (13 1) (14 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-7) (pt pt-8) (aik aik-0) (tpm tpm-7) (pcr pcr-2))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0))
    ((8 0) (13 1)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (13 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1))
    ((13 0) (2 0)) ((13 3) (14 1)) ((14 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-7 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 626)
  (parent 602)
  (unrealized (10 1) (11 0) (12 0) (13 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 0)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 0))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (10 1)) ((14 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 n v pt pt-0
    pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 627)
  (parent 602)
  (unrealized (11 0) (12 0) (13 1) (14 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 nonce-6
      pcr-id-7 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (deflistener (cat pcr-id-4 n nonce-4))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-5))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-6) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-3) nonce-5))
    (pcr-id pcr-id-7) (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 1)) ((2 2) (4 0))
    ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3))
    ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0)) ((8 3) (5 2))
    ((9 0) (12 0)) ((9 0) (14 1)) ((9 3) (6 2)) ((10 0) (13 0))
    ((10 3) (8 2)) ((11 0) (14 1)) ((11 3) (9 1)) ((12 1) (9 1))
    ((13 1) (10 1)) ((14 3) (15 1)) ((15 2) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-3) nonce-5)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-3) nonce-5) (11 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((recv (cat pcr-id-4 n nonce-4)) (send (cat pcr-id-4 n nonce-4)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat (cat n nonce-3) nonce-5)
          (hash pcr-id-6 (cat (cat n nonce-3) nonce-5) nonce-6)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
    ((recv tpm-8 (cat "quote" pcr-id-7 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (send
        (enc "quote" pcr-id-7 (hash pcr-id-5 (cat n nonce-3) nonce-5)
          nonce aik-0))))
  (label 628)
  (parent 603)
  (unrealized (11 1) (12 0) (13 0) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 0)) ((2 1) (14 1)) ((2 1) (15 0))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (14 1)) ((9 0) (15 0))
    ((9 3) (6 2)) ((10 0) (13 0)) ((10 3) (8 2)) ((11 0) (14 1))
    ((11 0) (15 0)) ((11 3) (9 1)) ((12 1) (9 1)) ((13 1) (10 1))
    ((14 3) (11 1)) ((15 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 629)
  (parent 603)
  (unrealized (12 0) (13 0) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 1)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0))
    ((12 3) (9 1)) ((13 3) (9 1)) ((14 1) (9 1)) ((15 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 630)
  (parent 619)
  (unrealized (10 1) (11 0) (12 1) (13 1) (14 0) (15 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 0)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (15 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0))
    ((12 3) (9 1)) ((13 3) (9 1)) ((14 1) (9 1)) ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 631)
  (parent 619)
  (unrealized (11 0) (12 1) (13 1) (14 0) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1))
    ((14 3) (15 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 632)
  (parent 620)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 0))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 0)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 0) (2 0)) ((12 3) (9 1)) ((13 1) (9 1)) ((14 3) (10 1))
    ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 633)
  (parent 620)
  (unrealized (11 0) (12 1) (13 0) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 1))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1))
    ((15 3) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test (added-strand tpm-extend-enc 4)
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3)))))
  (label 634)
  (parent 622)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1) (15 1))
  (comment "3 in cohort - 3 not yet seen"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-6) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (14 1)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0))
    ((14 3) (15 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-6))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-6)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 635)
  (parent 622)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 0))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 0)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1))
    ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 636)
  (parent 622)
  (unrealized (11 0) (12 1) (13 0) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 nonce-0 pcr-id-1 nonce-1 pcr-id-2 nonce-2 pcr-id-3
      nonce-3 pcr-id-4 nonce-4 pcr-id-5 nonce-5 pcr-id-6 nonce-6
      pcr-id-7 nonce-7 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-1)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce-0) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-2)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-3) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-4) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-5) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-4))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-6) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-4))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-3) nonce-5))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-7) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-8) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-3) nonce-5))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-9) (pcr pcr-3))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 0) (2 0))
    ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 1)) ((9 3) (6 2))
    ((10 0) (13 1)) ((10 0) (14 0)) ((10 3) (8 2)) ((11 0) (15 1))
    ((11 3) (9 1)) ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1))
    ((15 3) (16 1)) ((16 2) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-3) nonce-5)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-3) nonce-5) (11 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce-0))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-1)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce-0)))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-2)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-3)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-4)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-3)
          (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-3))))
    ((recv (cat pcr-id-3 n nonce-3)) (send (cat pcr-id-3 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-4)
          (hash pcr-id-6 (cat n nonce-4) nonce-6)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-4))))
    ((recv (cat pcr-id-4 n nonce-4)) (send (cat pcr-id-4 n nonce-4)))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-7 (cat (cat n nonce-3) nonce-5)
          (hash pcr-id-7 (cat (cat n nonce-3) nonce-5) nonce-7)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-3) nonce-5))))
    ((recv tpm-9 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-3) nonce-5)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-3) nonce-5)
          nonce aik-0))))
  (label 637)
  (parent 623)
  (unrealized (11 1) (12 0) (13 1) (14 0) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5
      pcr-id-7 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-3) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-4)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-5)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-6) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-7) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-8) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-2) nonce-4))
  (precedes ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 0)) ((2 1) (15 1))
    ((2 1) (16 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 0) (2 0)) ((8 3) (5 2)) ((9 0) (12 0)) ((9 0) (15 1))
    ((9 0) (16 0)) ((9 3) (6 2)) ((10 0) (13 1)) ((10 0) (14 0))
    ((10 3) (8 2)) ((11 0) (15 1)) ((11 0) (16 0)) ((11 3) (9 1))
    ((12 1) (9 1)) ((13 3) (10 1)) ((14 1) (10 1)) ((15 3) (11 1))
    ((16 1) (11 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm)
  (auth tpm)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-2) nonce-4))
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (11 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat "token" nonce))
      (send tpm (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm-0 (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-1 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm (cat "token" nonce)))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv (cat pcr-id-5 (cat n nonce-2) nonce-4))
      (send (cat pcr-id-5 (cat n nonce-2) nonce-4))))
  (label 638)
  (parent 623)
  (unrealized (12 0) (13 1) (14 0) (15 1) (16 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-10) (aik aik-0) (tpm tpm-8) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 1))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (10 1)) ((14 3) (15 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 639)
  (parent 625)
  (unrealized (10 1) (11 0) (12 0) (13 1) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-8) (pt pt-8) (aik aik-0) (tpm tpm-8) (pcr pcr-2))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0)) ((3 2) (0 0))
    ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1)) ((7 3) (5 2))
    ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1)) ((8 3) (6 2))
    ((9 0) (12 0)) ((9 3) (7 2)) ((10 0) (13 1)) ((10 0) (14 1))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0))
    ((13 3) (15 1)) ((14 3) (10 1)) ((15 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-6 (cat (cat n nonce-2) nonce-4) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-8 (cat "quote" pcr-id-8 nonce))
      (load pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-8 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 640)
  (parent 625)
  (unrealized (10 1) (11 0) (12 0) (13 1) (14 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pval)
    (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 0)) ((2 1) (13 1)) ((2 1) (14 1))
    ((2 1) (15 0)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (13 1)) ((8 0) (14 1))
    ((8 0) (15 0)) ((8 3) (6 2)) ((9 0) (12 0)) ((9 3) (7 2))
    ((10 0) (13 1)) ((10 0) (14 1)) ((10 0) (15 0)) ((10 3) (8 1))
    ((11 1) (8 1)) ((12 1) (9 1)) ((13 0) (2 0)) ((13 3) (10 1))
    ((14 3) (10 1)) ((15 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 n v
    pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3)))
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-6 (cat (cat n nonce-1) nonce-3) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-5))
      (stor pcr-2 (cat pt-8 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 641)
  (parent 625)
  (unrealized (11 0) (12 0) (13 1) (14 1) (15 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 nonce-7 pcr-id-9 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-7)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-9) (pt pt-12) (aik aik-0) (tpm tpm-9) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 1)) ((8 3) (6 2))
    ((9 0) (12 1)) ((9 0) (13 1)) ((9 0) (14 0)) ((9 3) (7 2))
    ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0))
    ((12 3) (9 1)) ((13 3) (9 1)) ((14 1) (9 1)) ((15 3) (16 1))
    ((16 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-5))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-3)
          (hash pcr-id-7 (cat n nonce-3) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-8 (cat (cat n nonce-2) nonce-4) nonce-7)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-9 (cat "quote" pcr-id-9 nonce))
      (load pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-9 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 642)
  (parent 630)
  (unrealized (10 1) (11 0) (12 1) (13 1) (14 0) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-4) (n n) (v v) (k k)
    (aik aik) (tpm tpm-6))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-6))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 1)) ((2 1) (14 0))
    ((2 1) (15 1)) ((2 1) (16 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (15 1))
    ((8 0) (16 0)) ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 1))
    ((9 0) (14 0)) ((9 3) (7 2)) ((10 0) (15 1)) ((10 0) (16 0))
    ((10 3) (8 1)) ((11 1) (8 1)) ((12 0) (2 0)) ((12 3) (9 1))
    ((13 3) (9 1)) ((14 1) (9 1)) ((15 3) (10 1)) ((16 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-6)
  (auth tpm-6)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-6 (cat "token" nonce-4))
      (send tpm-6 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-4)))
      (send tpm-6
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-6
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat n nonce-2)
          (hash pcr-id-7 (cat n nonce-2) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-4))
      (stor pcr-3 (cat pt-10 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 643)
  (parent 630)
  (unrealized (11 0) (12 1) (13 1) (14 0) (15 1) (16 0))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 nonce-7 pcr-id-9 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-6) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-7)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-9) (pt pt-12) (aik aik-0) (tpm tpm-9) (pcr pcr-4))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 1))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1))
    ((15 3) (16 1)) ((16 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-6))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-6)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-8 (cat (cat n nonce-2) nonce-4) nonce-7)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-9 (cat "quote" pcr-id-9 nonce))
      (load pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-9 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 644)
  (parent 634)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars (nonce mesg)
    (pcr-id pcr-id-0 pcr-id-1 nonce-0 pcr-id-2 nonce-1 pcr-id-3 nonce-2
      pcr-id-4 nonce-3 pcr-id-5 nonce-4 pcr-id-6 nonce-5 pcr-id-7
      nonce-6 pcr-id-8 nonce-7 pcr-id-9 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik aik-0 akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 tpm-9
      chan) (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-6) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-3) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-4) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-3))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-5) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-6) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-2) nonce-4))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-7)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (defstrand tpm-quote 3 (nonce nonce)
    (current-value (hash pcr-id-5 (cat n nonce-2) nonce-4))
    (pcr-id pcr-id-9) (pt pt-10) (aik aik-0) (tpm tpm-9) (pcr pcr-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 2) (4 0)) ((2 4) (3 0)) ((2 4) (5 0))
    ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0)) ((6 3) (3 1))
    ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1)) ((8 0) (15 1))
    ((8 3) (6 2)) ((9 0) (12 1)) ((9 0) (13 0)) ((9 3) (7 2))
    ((10 0) (14 1)) ((10 0) (15 1)) ((10 3) (8 1)) ((11 1) (8 1))
    ((12 3) (9 1)) ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (16 1))
    ((15 3) (10 1)) ((16 2) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5 nonce-6
    nonce-7 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash pcr-id-5 (cat n nonce-2) nonce-4)
    (hash (hash "0" n) "obtain") (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (hash pcr-id-5 (cat n nonce-2) nonce-4) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-6))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-6)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce-0))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse"
          (hash pcr-id-1 "refuse" nonce-0)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-1))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-1)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-2))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-3))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-3)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-4))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-2)
          (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-2))))
    ((recv (cat pcr-id-3 n nonce-2)) (send (cat pcr-id-3 n nonce-2)))
    ((send tpm-6 (cat "token" nonce-5))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-3)
          (hash pcr-id-6 (cat n nonce-3) nonce-5)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-3))))
    ((recv (cat pcr-id-4 n nonce-3)) (send (cat pcr-id-4 n nonce-3)))
    ((send tpm-7 (cat "token" nonce-6))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-7 (cat (cat n nonce-2) nonce-4) nonce-6)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((send tpm-8 (cat "token" nonce-7))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-2) nonce-4)
          (hash pcr-id-8 (cat (cat n nonce-2) nonce-4) nonce-7)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-2) nonce-4))))
    ((recv tpm-9 (cat "quote" pcr-id-9 nonce))
      (load pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-2) nonce-4)))
      (send
        (enc "quote" pcr-id-9 (hash pcr-id-5 (cat n nonce-2) nonce-4)
          nonce aik-0))))
  (label 645)
  (parent 634)
  (unrealized (10 1) (11 0) (12 1) (13 0) (14 1) (15 1))
  (dead)
  (comment "empty cohort"))

(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 pcr-id-3 nonce-1
      pcr-id-4 nonce-2 pcr-id-5 nonce-3 pcr-id-6 nonce-4 pcr-id-7
      nonce-5 pcr-id-8 nonce-6 text) (n v data)
    (pt pt-0 pt-1 pt-2 pt-3 pt-4 pt-5 pt-6 pt-7 pt-8 pt-9 pt-10 pt-11
      pt-12 pval) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 tpm-5 tpm-6 tpm-7 tpm-8 chan)
    (pcr pcr-0 pcr-1 pcr-2 pcr-3 pcr-4 locn))
  (deflistener
    (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-5) (n n) (v v) (k k)
    (aik aik) (tpm tpm-7))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash "0" n) "refuse")) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-create-key 2 (pcrval (hash (hash "0" n) "obtain"))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-7))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash "0" n) "obtain")) (pcr-id pcr-id-0)
    (pt pt-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value "refuse")
    (current-value (hash "0" n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-1) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value "obtain")
    (current-value (hash "0" n)) (pcr-id pcr-id-2) (nonce nonce-0)
    (pt pt-2) (pt-0 pt-0) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-3) (nonce nonce-1) (pt pt-3) (pt-0 pt-1) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value "0")
    (pcr-id pcr-id-4) (nonce nonce-2) (pt pt-4) (pt-0 pt-2) (tpm tpm-4)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-1))
    (current-value pcr-id-3) (pcr-id pcr-id-5) (nonce nonce-3) (pt pt-5)
    (pt-0 pt-6) (tpm tpm-5) (pcr pcr-1))
  (deflistener (cat pcr-id-3 n nonce-1))
  (defstrand tpm-extend-enc 4 (value (cat n nonce-2))
    (current-value pcr-id-4) (pcr-id pcr-id-6) (nonce nonce-4) (pt pt-7)
    (pt-0 pt-8) (tpm tpm-6) (pcr pcr-2))
  (deflistener (cat pcr-id-4 n nonce-2))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-7) (nonce nonce-5) (pt pt-9)
    (pt-0 pt-10) (tpm tpm-7) (pcr pcr-3))
  (defstrand tpm-extend-enc 4 (value (cat (cat n nonce-1) nonce-3))
    (current-value pcr-id-5) (pcr-id pcr-id-8) (nonce nonce-6)
    (pt pt-11) (pt-0 pt-12) (tpm tpm-8) (pcr pcr-4))
  (deflistener (cat pcr-id-5 (cat n nonce-1) nonce-3))
  (precedes ((2 1) (11 0)) ((2 1) (12 1)) ((2 1) (13 0)) ((2 1) (14 1))
    ((2 1) (15 1)) ((2 1) (16 0)) ((2 2) (4 0)) ((2 4) (3 0))
    ((2 4) (5 0)) ((3 2) (0 0)) ((4 1) (2 3)) ((5 3) (1 0))
    ((6 3) (3 1)) ((7 3) (5 2)) ((8 0) (11 0)) ((8 0) (14 1))
    ((8 0) (15 1)) ((8 0) (16 0)) ((8 3) (6 2)) ((9 0) (12 1))
    ((9 0) (13 0)) ((9 3) (7 2)) ((10 0) (14 1)) ((10 0) (15 1))
    ((10 0) (16 0)) ((10 3) (8 1)) ((11 1) (8 1)) ((12 3) (9 1))
    ((13 1) (9 1)) ((14 0) (2 0)) ((14 3) (10 1)) ((15 3) (10 1))
    ((16 1) (10 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 nonce-3 nonce-4 nonce-5
    nonce-6 n v pt pt-0 pt-1 pt-2 pt-6 pt-8 pt-10 pt-12 k)
  (genStV (hash "0" n) (hash (hash "0" n) "obtain")
    (hash (hash "0" n) "refuse"))
  (conf tpm-7)
  (auth tpm-7)
  (operation encryption-test
    (added-listener (cat pcr-id-5 (cat n nonce-1) nonce-3))
    (hash pcr-id-5 (cat n nonce-1) nonce-3) (10 1)
    (ch-msg pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3)))
    (ch-msg pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
  (traces
    ((recv
       (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k) aik))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-7 (cat "token" nonce-5))
      (send tpm-7 (cat "extend" pcr-id-0 n (hash pcr-id-0 n nonce-5)))
      (send tpm-7
        (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (send (enc v k)))
    ((recv tpm (cat "quote" pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash "0" n) "refuse")))
      (send
        (enc "quote" pcr-id (hash (hash "0" n) "refuse") (enc v k)
          aik)))
    ((recv tpm-7
       (cat "create-req" pcr-id-0 (hash (hash "0" n) "obtain")))
      (send
        (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik)))
    ((recv tpm-0 (cat "decrypt" (enc v k)))
      (recv (enc "created" k pcr-id-0 (hash (hash "0" n) "obtain") aik))
      (load pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))) (send v))
    ((send tpm-1 (cat "token" nonce))
      (recv tpm-1
        (cat "extend" pcr-id-1 "refuse" (hash pcr-id-1 "refuse" nonce)))
      (load pcr (cat pt-1 (hash "0" n)))
      (stor pcr (cat pt (hash (hash "0" n) "refuse"))))
    ((send tpm-2 (cat "token" nonce-0))
      (recv tpm-2
        (cat "extend" pcr-id-2 "obtain"
          (hash pcr-id-2 "obtain" nonce-0)))
      (load pcr-0 (cat pt-2 (hash "0" n)))
      (stor pcr-0 (cat pt-0 (hash (hash "0" n) "obtain"))))
    ((send tpm-3 (cat "token" nonce-1))
      (recv tpm-3 (cat "extend" pcr-id-3 n (hash pcr-id-3 n nonce-1)))
      (load pcr (cat pt-3 "0")) (stor pcr (cat pt-1 (hash "0" n))))
    ((send tpm-4 (cat "token" nonce-2))
      (recv tpm-4 (cat "extend" pcr-id-4 n (hash pcr-id-4 n nonce-2)))
      (load pcr-0 (cat pt-4 "0")) (stor pcr-0 (cat pt-2 (hash "0" n))))
    ((send tpm-5 (cat "token" nonce-3))
      (recv tpm-5
        (cat "extend" pcr-id-5 (cat n nonce-1)
          (hash pcr-id-5 (cat n nonce-1) nonce-3)))
      (load pcr-1 (cat pt-5 pcr-id-3))
      (stor pcr-1 (cat pt-6 (hash pcr-id-3 n nonce-1))))
    ((recv (cat pcr-id-3 n nonce-1)) (send (cat pcr-id-3 n nonce-1)))
    ((send tpm-6 (cat "token" nonce-4))
      (recv tpm-6
        (cat "extend" pcr-id-6 (cat n nonce-2)
          (hash pcr-id-6 (cat n nonce-2) nonce-4)))
      (load pcr-2 (cat pt-7 pcr-id-4))
      (stor pcr-2 (cat pt-8 (hash pcr-id-4 n nonce-2))))
    ((recv (cat pcr-id-4 n nonce-2)) (send (cat pcr-id-4 n nonce-2)))
    ((send tpm-7 (cat "token" nonce-5))
      (recv tpm-7
        (cat "extend" pcr-id-7 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-7 (cat (cat n nonce-1) nonce-3) nonce-5)))
      (load pcr-3 (cat pt-9 pcr-id-5))
      (stor pcr-3 (cat pt-10 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((send tpm-8 (cat "token" nonce-6))
      (recv tpm-8
        (cat "extend" pcr-id-8 (cat (cat n nonce-1) nonce-3)
          (hash pcr-id-8 (cat (cat n nonce-1) nonce-3) nonce-6)))
      (load pcr-4 (cat pt-11 pcr-id-5))
      (stor pcr-4 (cat pt-12 (hash pcr-id-5 (cat n nonce-1) nonce-3))))
    ((recv (cat pcr-id-5 (cat n nonce-1) nonce-3))
      (send (cat pcr-id-5 (cat n nonce-1) nonce-3))))
  (label 646)
  (parent 634)
  (unrealized (11 0) (12 1) (13 0) (14 1) (15 1) (16 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")
