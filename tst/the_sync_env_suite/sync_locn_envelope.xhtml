<?xml version="1.0"?>
<!-- CPSA 4.2.3 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>Envelope Protocol, location-based version</title>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <style>
  svg.diagram { border-width: 1px; border-style: solid }
 </style>
</head>
<body>

<pre>(herald &quot;Envelope Protocol, location-based version&quot; (check-nonces)
  (bound 30) (limit 6000))
(comment &quot;CPSA 4.2.3&quot;)
(comment &quot;All input read from sync_locn_envelope.scm&quot;)
(comment &quot;Step count limited to 6000&quot;)
(comment &quot;Strand count bounded at 30&quot;)
(comment &quot;Nonces checked first&quot;)</pre>

<p id="top">Trees: <a href="#t0">0</a> <a href="#t12">12</a> <a href="#t23">23</a> <a href="#t39">39</a> <a href="#t51">51</a> <a href="#t62">62</a> <a href="#t79">79</a> <a href="#t91">91</a> <a href="#t102">102</a>.</p>

<p id="t0">Tree <a href="#top">0</a>.</p>

<div>
 <svg
  class='diagram' width='529.200pt' height='229.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 529.200 229.920' font-size='12.000'>
  <text
   x='439.320' y='176.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k10&quot;, &quot;_self&quot;)'>10</text>
  <line
   x1='389.400' y1='152.460' x2='439.320' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='489.240' y='101.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k11&quot;, &quot;_self&quot;)'>11</text>
  <line
   x1='439.320' y1='114.960' x2='489.240' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k9&quot;, &quot;_self&quot;)'>9</text>
  <line
   x1='389.400' y1='152.460' x2='439.320' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k8&quot;, &quot;_self&quot;)'>8</text>
  <line
   x1='339.480' y1='114.960' x2='389.400' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k7&quot;, &quot;_self&quot;)'>7</text>
  <line
   x1='339.480' y1='114.960' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k6&quot;, &quot;_self&quot;)'>6</text>
  <line
   x1='289.560' y1='114.960' x2='339.480' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k5&quot;, &quot;_self&quot;)'>5</text>
  <line
   x1='239.640' y1='114.960' x2='289.560' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k4&quot;, &quot;_self&quot;)'>4</text>
  <line
   x1='189.720' y1='114.960' x2='239.640' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k3&quot;, &quot;_self&quot;)'>3</text>
  <line
   x1='139.800' y1='114.960' x2='189.720' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k2&quot;, &quot;_self&quot;)'>2</text>
  <line
   x1='89.880' y1='114.960' x2='139.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k1&quot;, &quot;_self&quot;)'>1</text>
  <line
   x1='39.960' y1='114.960' x2='89.880' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k0&quot;, &quot;_self&quot;)'>0</text>
  </svg></div>

<pre>(defprotocol envelope basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm &quot;power on&quot;) (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 &quot;0&quot;)))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat &quot;token&quot; nonce))
      (recv tpm (cat &quot;extend&quot; pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send &quot;ext ok&quot;))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey)
      (tpm tpmconf chan))
    (trace (recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpmconf)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false)))))</pre>

<p id="k0">Item <a href="#t0">0</a>, Child: <a href="#k1">1</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960' style='text-anchor: middle;'>envelope 0</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpmconf)
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 0)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k1">Item <a href="#t0">1</a>, Parent: <a href="#k0">0</a>, Child: <a href="#k2">2</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960' style='text-anchor: middle;'>envelope 1</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpmconf)
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 1)
  (parent 0)
  (unrealized (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k2">Item <a href="#t0">2</a>, Parent: <a href="#k1">1</a>, Child: <a href="#k3">3</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 191.564 262.464 143.247 334.967'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960' style='text-anchor: middle;'>envelope 2</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id nonce text) (v n data) (k aik akey)
    (tpm tpmconf tpm-0 chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpmconf)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 3))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 2)
  (parent 1)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k3">Item <a href="#t0">3</a>, Parent: <a href="#k2">2</a>, Child: <a href="#k4">4</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960' style='text-anchor: middle;'>envelope 3</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 3)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 3)
  (parent 2)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k4">Item <a href="#t0">4</a>, Parent: <a href="#k3">3</a>, Child: <a href="#k5">5</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960' style='text-anchor: middle;'>envelope 4</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)) ((3 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat &quot;token&quot; nonce)) (1 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce))))
  (label 4)
  (parent 3)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k5">Item <a href="#t0">5</a>, Parent: <a href="#k4">4</a>, Child: <a href="#k6">6</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt current-value))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 current-value aik-0)</title>
   <circle style='fill: red;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960' style='text-anchor: middle;'>envelope 5</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce v n k)
  (conf tpmconf)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (0 0) (enc v k))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 5)
  (parent 4)
  (unrealized (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k6">Item <a href="#t0">6</a>, Parent: <a href="#k5">5</a>, Children: <a href="#k7">7</a> <a href="#k8">8</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960' style='text-anchor: middle;'>envelope 6</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id nonce text) (v n data) (pt pval) (k aik akey)
    (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 3) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 5 2 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 current-value aik-0) (4 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v)))
  (label 6)
  (parent 5)
  (unrealized (4 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k7">Item <a href="#t0">7</a>, Parent: <a href="#k6">6</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 339.960 Q 391.038 449.718 342.276 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 292.860 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 639.960 Q 192.900 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm-0) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960' style='text-anchor: middle;'>envelope 7</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpmconf tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)) ((4 3) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 3 5 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (4 2))
  (traces ((recv v) (send v))
    ((recv tpm-0 (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm-0
        (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 7)
  (parent 6)
  (unrealized (4 1) (4 2))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k8">Item <a href="#t0">8</a>, Parent: <a href="#k6">6</a>, Children: <a href="#k9">9</a> <a href="#k10">10</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 490.998 449.718 442.236 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960' style='text-anchor: middle;'>envelope 8</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id nonce pcr-id-0 nonce-0 text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpm tpmconf tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 3) (0 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (4 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;
          (hash pcr-id-0 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 8)
  (parent 6)
  (unrealized (5 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k9">Item <a href="#t0">9</a>, Parent: <a href="#k8">8</a>, Child: <a href="#k11">11</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-0)))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 391.484 487.464 343.167 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 639.960 Q 192.900 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpm-1) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960' style='text-anchor: middle;'>envelope 9</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-1)
  (operation channel-test (displaced 3 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm-1 (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))
      (send tpm-1
        (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-1 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 9)
  (parent 8)
  (unrealized (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k10">Item <a href="#t0">10</a>, Parent: <a href="#k8">8</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-1)))</title>
   <circle style='fill: red;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 386.820 152.460 633.720 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope 10</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpmconf tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3))
    ((3 0) (1 0)) ((4 3) (0 0)) ((5 3) (4 2)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;
          (hash pcr-id-0 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 10)
  (parent 8)
  (unrealized (6 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k11">Item <a href="#t0">11</a>, Parent: <a href="#k9">9</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 391.484 487.464 343.167 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 639.960 Q 192.900 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 11 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-0)))
    (5 1))
  (traces ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 11)
  (parent 9)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((v v) (n n) (pcr-id pcr-id) (nonce nonce-0) (k k) (aik aik)
        (tpm tpmconf) (tpmconf tpmconf))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (2 1)) (v (1 4))))</pre>

<p id="t12">Tree <a href="#top">12</a>.</p>

<div>
 <svg
  class='diagram' width='479.280pt' height='229.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.280 229.920' font-size='12.000'>
  <text
   x='389.400' y='176.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k21&quot;, &quot;_self&quot;)'>21</text>
  <line
   x1='339.480' y1='152.460' x2='389.400' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='101.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k22&quot;, &quot;_self&quot;)'>22</text>
  <line
   x1='389.400' y1='114.960' x2='439.320' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k20&quot;, &quot;_self&quot;)'>20</text>
  <line
   x1='339.480' y1='152.460' x2='389.400' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k19&quot;, &quot;_self&quot;)'>19</text>
  <line
   x1='289.560' y1='114.960' x2='339.480' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='26.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k18&quot;, &quot;_self&quot;)'>18</text>
  <line
   x1='289.560' y1='114.960' x2='339.480' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k17&quot;, &quot;_self&quot;)'>17</text>
  <line
   x1='239.640' y1='114.960' x2='289.560' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k16&quot;, &quot;_self&quot;)'>16</text>
  <line
   x1='189.720' y1='114.960' x2='239.640' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k15&quot;, &quot;_self&quot;)'>15</text>
  <line
   x1='139.800' y1='114.960' x2='189.720' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k14&quot;, &quot;_self&quot;)'>14</text>
  <line
   x1='89.880' y1='114.960' x2='139.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k13&quot;, &quot;_self&quot;)'>13</text>
  <line
   x1='39.960' y1='114.960' x2='89.880' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k12&quot;, &quot;_self&quot;)'>12</text>
  </svg></div>

<pre>(defprotocol envelope basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm &quot;power on&quot;) (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 &quot;0&quot;)))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat &quot;token&quot; nonce))
      (recv tpm (cat &quot;extend&quot; pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send &quot;ext ok&quot;))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey)
      (tpm tpmconf chan))
    (trace (recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpmconf)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false)))))</pre>

<p id="k12">Item <a href="#t12">12</a>, Child: <a href="#k13">13</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960' style='text-anchor: middle;'>envelope 12</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 12)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k13">Item <a href="#t12">13</a>, Parent: <a href="#k12">12</a>, Child: <a href="#k14">14</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960' style='text-anchor: middle;'>envelope 13</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 13)
  (parent 12)
  (unrealized (0 0) (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k14">Item <a href="#t12">14</a>, Parent: <a href="#k13">13</a>, Child: <a href="#k15">15</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 191.564 262.464 143.247 334.967'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope 14</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 3))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 14)
  (parent 13)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k15">Item <a href="#t12">15</a>, Parent: <a href="#k14">14</a>, Child: <a href="#k16">16</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope 15</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 3)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 15)
  (parent 14)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k16">Item <a href="#t12">16</a>, Parent: <a href="#k15">15</a>, Child: <a href="#k17">17</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope 16</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)) ((3 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat &quot;token&quot; nonce)) (1 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce))))
  (label 16)
  (parent 15)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k17">Item <a href="#t12">17</a>, Parent: <a href="#k16">16</a>, Children: <a href="#k18">18</a> <a href="#k19">19</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 564.960 Q 242.880 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: red;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope 17</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 17)
  (parent 16)
  (unrealized (4 1))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k18">Item <a href="#t12">18</a>, Parent: <a href="#k17">17</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 339.960 Q 391.484 412.464 343.167 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 292.860 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm-0) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope 18</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data) (pt pt-0 pval)
    (k aik akey) (tpmconf tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 2) (0 0))
    ((4 0) (1 0)) ((4 3) (3 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 3 5 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-0 (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 18)
  (parent 17)
  (unrealized (4 1) (4 2))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k19">Item <a href="#t12">19</a>, Parent: <a href="#k17">17</a>, Children: <a href="#k20">20</a> <a href="#k21">21</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 242.880 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 19</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpmconf tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 2) (0 0)) ((5 3) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;
          (hash pcr-id-1 &quot;refuse&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 19)
  (parent 17)
  (unrealized (5 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k20">Item <a href="#t12">20</a>, Parent: <a href="#k19">19</a>, Child: <a href="#k22">22</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 392.220 450.660 344.639 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpm-1) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 20</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 2) (0 0)) ((4 3) (3 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm-1)
  (operation channel-test (displaced 3 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-1
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 20)
  (parent 19)
  (unrealized (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k21">Item <a href="#t12">21</a>, Parent: <a href="#k19">19</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))</title>
   <circle style='fill: red;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 492.180 450.660 444.599 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 242.880 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 386.820 152.460 633.720 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope 21</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpmconf tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3))
    ((3 0) (1 0)) ((4 2) (0 0)) ((5 3) (4 1)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;
          (hash pcr-id-1 &quot;refuse&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 21)
  (parent 19)
  (unrealized (6 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k22">Item <a href="#t12">22</a>, Parent: <a href="#k20">20</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 392.220 450.660 344.639 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 22 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 2) (0 0)) ((4 3) (3 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
    (5 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 22)
  (parent 20)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-0) (tpm tpmconf) (tpmconf tpmconf))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (2 1)) (v (1 4))))</pre>

<p id="t23">Tree <a href="#top">23</a>.</p>

<div>
 <svg
  class='diagram' width='678.960pt' height='304.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 678.960 304.920' font-size='12.000'>
  <text
   x='439.320' y='251.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k33&quot;, &quot;_self&quot;)'>33</text>
  <line
   x1='389.400' y1='189.960' x2='439.320' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='639.000' y='176.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k38&quot;, &quot;_self&quot;)'>38</text>
  <line
   x1='589.080' y1='152.460' x2='639.000' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='639.000' y='101.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k37&quot;, &quot;_self&quot;)'>37</text>
  <line
   x1='589.080' y1='152.460' x2='639.000' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k36&quot;, &quot;_self&quot;)'>36</text>
  <line
   x1='539.160' y1='152.460' x2='589.080' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='539.160' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k35&quot;, &quot;_self&quot;)'>35</text>
  <line
   x1='489.240' y1='152.460' x2='539.160' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='489.240' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k34&quot;, &quot;_self&quot;)'>34</text>
  <line
   x1='439.320' y1='152.460' x2='489.240' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k32&quot;, &quot;_self&quot;)'>32</text>
  <line
   x1='389.400' y1='189.960' x2='439.320' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k31&quot;, &quot;_self&quot;)'>31</text>
  <line
   x1='339.480' y1='152.460' x2='389.400' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k30&quot;, &quot;_self&quot;)'>30</text>
  <line
   x1='339.480' y1='152.460' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k29&quot;, &quot;_self&quot;)'>29</text>
  <line
   x1='289.560' y1='152.460' x2='339.480' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k28&quot;, &quot;_self&quot;)'>28</text>
  <line
   x1='239.640' y1='152.460' x2='289.560' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k27&quot;, &quot;_self&quot;)'>27</text>
  <line
   x1='189.720' y1='152.460' x2='239.640' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k26&quot;, &quot;_self&quot;)'>26</text>
  <line
   x1='139.800' y1='152.460' x2='189.720' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k25&quot;, &quot;_self&quot;)'>25</text>
  <line
   x1='89.880' y1='152.460' x2='139.800' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k24&quot;, &quot;_self&quot;)'>24</text>
  <line
   x1='39.960' y1='152.460' x2='89.880' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k23&quot;, &quot;_self&quot;)'>23</text>
  </svg></div>

<pre>(defprotocol envelope basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm &quot;power on&quot;) (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 &quot;0&quot;)))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat &quot;token&quot; nonce))
      (recv tpm (cat &quot;extend&quot; pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send &quot;ext ok&quot;))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey)
      (tpm tpmconf chan))
    (trace (recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpmconf)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false)))))</pre>

<p id="k23">Item <a href="#t23">23</a>, Child: <a href="#k24">24</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope 23</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 23)
  (unrealized (0 0) (1 0) (2 3))
  (preskeleton)
  (origs (v (2 4)) (n (2 1)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k24">Item <a href="#t23">24</a>, Parent: <a href="#k23">23</a>, Child: <a href="#k25">25</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope 24</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (precedes ((2 4) (0 0)) ((2 4) (1 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 24)
  (parent 23)
  (unrealized (0 0) (2 3))
  (origs (v (2 4)) (n (2 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k25">Item <a href="#t23">25</a>, Parent: <a href="#k24">24</a>, Child: <a href="#k26">26</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 189.960 Q 291.524 262.464 243.207 334.967'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope 25</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((2 4) (0 0)) ((2 4) (1 0)) ((3 1) (2 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (2 3))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 25)
  (parent 24)
  (unrealized (0 0) (1 0) (3 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k26">Item <a href="#t23">26</a>, Parent: <a href="#k25">25</a>, Child: <a href="#k27">27</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope 26</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (1 0)) ((3 1) (2 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (displaced 4 2 alice 3)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (3 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 26)
  (parent 25)
  (unrealized (0 0) (1 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k27">Item <a href="#t23">27</a>, Parent: <a href="#k26">26</a>, Child: <a href="#k28">28</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope 27</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (1 0)) ((3 1) (2 3))
    ((4 0) (2 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat &quot;token&quot; nonce)) (2 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce))))
  (label 27)
  (parent 26)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k28">Item <a href="#t23">28</a>, Parent: <a href="#k27">27</a>, Child: <a href="#k29">29</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt current-value))</title>
   <circle style='fill: blue;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-1 current-value aik-0)</title>
   <circle style='fill: red;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-1) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 28</text></svg></div>

<pre>(defskeleton envelope
  (vars (current-value mesg) (pcr-id pcr-id-0 nonce pcr-id-1 text)
    (n v data) (pt pval) (k aik aik-0 akey) (tpm tpmconf tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0)) ((3 1) (2 3))
    ((4 0) (2 0)) ((5 3) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce n v k)
  (conf tpmconf)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (1 0) (enc v k))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-1 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 28)
  (parent 27)
  (unrealized (0 0) (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k29">Item <a href="#t23">29</a>, Parent: <a href="#k28">28</a>, Children: <a href="#k30">30</a> <a href="#k31">31</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 29</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0)) ((3 1) (2 3))
    ((4 0) (2 0)) ((5 3) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 6 3 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-1 current-value aik-0) (5 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v)))
  (label 29)
  (parent 28)
  (unrealized (0 0) (5 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k30">Item <a href="#t23">30</a>, Parent: <a href="#k29">29</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 490.998 449.718 442.236 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 392.820 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm-0) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 30</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data) (pt pt-0 pval)
    (k aik akey) (tpmconf tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (4 0)) ((3 1) (2 3))
    ((4 3) (1 0)) ((5 0) (2 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 4 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-0 (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 30)
  (parent 29)
  (unrealized (0 0) (5 1) (5 2))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k31">Item <a href="#t23">31</a>, Parent: <a href="#k29">29</a>, Children: <a href="#k32">32</a> <a href="#k33">33</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 590.958 449.718 542.196 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope 31</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpmconf tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0)) ((3 1) (2 3))
    ((4 0) (2 0)) ((5 3) (1 0)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;
          (hash pcr-id-1 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 31)
  (parent 29)
  (unrealized (0 0) (6 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k32">Item <a href="#t23">32</a>, Parent: <a href="#k31">31</a>, Child: <a href="#k34">34</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))</title>
   <circle style='fill: red;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpm-1) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope 32</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (4 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-1)
  (operation channel-test (displaced 4 7 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (6 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-1
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 32)
  (parent 31)
  (unrealized (0 0) (6 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k33">Item <a href="#t23">33</a>, Parent: <a href="#k31">31</a>.</p>

<div>
 <svg
  class='diagram' width='779.640pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 779.640 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='739.680' y1='114.960' x2='739.680' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='189.960' x2='639.720' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 739.680 339.960 Q 692.700 339.960 645.720 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))</title>
   <circle style='fill: red;' cx='739.680' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='739.680' cy='114.960' r='6.000'/></g>
  <path
   d='M 639.720 414.960 Q 591.404 487.464 543.087 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='639.720' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 486.780 152.460 733.680 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='739.680' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='389.820' y='39.960'
   style='text-anchor: middle;'>envelope 33</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpmconf tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((2 1) (7 1)) ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0))
    ((3 1) (2 3)) ((4 0) (2 0)) ((5 3) (1 0)) ((6 3) (5 2))
    ((7 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (6 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;
          (hash pcr-id-1 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 33)
  (parent 31)
  (unrealized (0 0) (7 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k34">Item <a href="#t23">34</a>, Parent: <a href="#k32">32</a>, Child: <a href="#k35">35</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope 34</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (4 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 7 2 alice 2)
    (ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
    (6 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 34)
  (parent 32)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k35">Item <a href="#t23">35</a>, Parent: <a href="#k34">34</a>, Child: <a href="#k36">36</a>.</p>

<div>
 <svg
  class='diagram' width='779.640pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 779.640 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: red;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='389.820' y='39.960'
   style='text-anchor: middle;'>envelope 35</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pt-2 pval) (k aik akey) (tpmconf tpm tpm-0 tpm-1 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (4 0)) ((2 4) (7 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)) ((7 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 35)
  (parent 34)
  (unrealized (7 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k36">Item <a href="#t23">36</a>, Parent: <a href="#k35">35</a>, Children: <a href="#k37">37</a> <a href="#k38">38</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='114.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 339.960 Q 791.324 412.464 743.007 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot; (hash pcr-id-2 &quot;refuse&quot; nonce-1)))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='839.640' cy='114.960' r='6.000'/></g>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope 36</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (4 0)) ((2 4) (7 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)) ((7 2) (0 0)) ((8 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-2 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))) (7 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2
        (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;
          (hash pcr-id-2 &quot;refuse&quot; nonce-1)))
      (load pcr-0 (cat pt-3 (hash &quot;0&quot; n)))
      (stor pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 36)
  (parent 35)
  (unrealized (8 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k37">Item <a href="#t23">37</a>, Parent: <a href="#k36">36</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 414.960 Q 792.060 450.660 744.479 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='839.640' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot; (hash pcr-id-2 &quot;refuse&quot; nonce-1)))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 639.720 339.960 Q 736.680 302.460 833.640 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-0) (pt-0 pt-2) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope 37 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-0) (pt-0 pt-2) (tpm tpm-2) (pcr pcr))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (4 0)) ((2 4) (7 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)) ((6 3) (8 2)) ((7 2) (0 0)) ((8 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-2 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 9 6 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n))) (8 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2
        (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;
          (hash pcr-id-2 &quot;refuse&quot; nonce-1)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 37)
  (parent 36)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-0) (tpm tpmconf) (tpmconf tpmconf))))
  (origs (nonce-0 (6 0)) (pt-0 (6 3)) (nonce-1 (8 0)) (pt-2 (8 3))
    (n (2 1)) (nonce (5 0)) (pt (5 3)) (k (3 1)) (v (2 4))))</pre>

<p id="k38">Item <a href="#t23">38</a>, Parent: <a href="#k36">36</a>.</p>

<div>
 <svg
  class='diagram' width='979.560pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 979.560 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='939.600' y1='114.960' x2='939.600' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 939.600 339.960 Q 892.620 339.960 845.640 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='939.600' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (cat pt-4 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='939.600' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-3 n (hash pcr-id-3 n nonce-2)))</title>
   <circle style='fill: red;' cx='939.600' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-3 (cat &quot;token&quot; nonce-2))</title>
   <circle cx='939.600' cy='114.960' r='6.000'/></g>
  <path
   d='M 839.640 414.960 Q 792.060 450.660 744.479 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='839.640' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot; (hash pcr-id-2 &quot;refuse&quot; nonce-1)))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 189.960 Q 586.740 152.460 933.600 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='939.600' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='489.780' y='39.960'
   style='text-anchor: middle;'>envelope 38</text></svg></div>

<pre>(defskeleton envelope
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpmconf tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-3) (tpm tpm-3)
    (pcr pcr-0))
  (precedes ((2 1) (6 1)) ((2 1) (9 1)) ((2 2) (3 0)) ((2 4) (4 0))
    ((2 4) (7 0)) ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2))
    ((6 0) (2 0)) ((6 3) (5 2)) ((7 2) (0 0)) ((8 3) (7 1))
    ((9 3) (8 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-2 pt-3 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n))) (8 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2
        (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;
          (hash pcr-id-2 &quot;refuse&quot; nonce-1)))
      (load pcr-0 (cat pt-3 (hash &quot;0&quot; n)))
      (stor pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpm-3 (cat &quot;token&quot; nonce-2))
      (recv tpm-3 (cat &quot;extend&quot; pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 &quot;0&quot;)) (stor pcr-0 (cat pt-3 (hash &quot;0&quot; n)))))
  (label 38)
  (parent 36)
  (unrealized (9 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="t39">Tree <a href="#top">39</a>.</p>

<div>
 <svg
  class='diagram' width='529.200pt' height='229.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 529.200 229.920' font-size='12.000'>
  <text
   x='439.320' y='176.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k49&quot;, &quot;_self&quot;)'>49</text>
  <line
   x1='389.400' y1='152.460' x2='439.320' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='489.240' y='101.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k50&quot;, &quot;_self&quot;)'>50</text>
  <line
   x1='439.320' y1='114.960' x2='489.240' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k48&quot;, &quot;_self&quot;)'>48</text>
  <line
   x1='389.400' y1='152.460' x2='439.320' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k47&quot;, &quot;_self&quot;)'>47</text>
  <line
   x1='339.480' y1='114.960' x2='389.400' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k46&quot;, &quot;_self&quot;)'>46</text>
  <line
   x1='339.480' y1='114.960' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k45&quot;, &quot;_self&quot;)'>45</text>
  <line
   x1='289.560' y1='114.960' x2='339.480' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k44&quot;, &quot;_self&quot;)'>44</text>
  <line
   x1='239.640' y1='114.960' x2='289.560' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k43&quot;, &quot;_self&quot;)'>43</text>
  <line
   x1='189.720' y1='114.960' x2='239.640' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k42&quot;, &quot;_self&quot;)'>42</text>
  <line
   x1='139.800' y1='114.960' x2='189.720' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k41&quot;, &quot;_self&quot;)'>41</text>
  <line
   x1='89.880' y1='114.960' x2='139.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k40&quot;, &quot;_self&quot;)'>40</text>
  <line
   x1='39.960' y1='114.960' x2='89.880' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k39&quot;, &quot;_self&quot;)'>39</text>
  </svg></div>

<pre>(defprotocol envelope-plus basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm &quot;power on&quot;) (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 &quot;0&quot;)))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat &quot;token&quot; nonce))
      (recv tpm (cat &quot;extend&quot; pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send &quot;ext ok&quot;))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey)
      (tpm tpmconf chan))
    (trace (recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpmconf)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule ordered-extends
    (forall ((y z strd) (pcr locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 4) (p &quot;tpm-extend-enc&quot; z 4)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr))
        (or (= y z) (prec y 3 z 2) (prec z 3 y 2))))))</pre>

<p id="k39">Item <a href="#t39">39</a>, Child: <a href="#k40">40</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus 39</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpmconf)
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 39)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k40">Item <a href="#t39">40</a>, Parent: <a href="#k39">39</a>, Child: <a href="#k41">41</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus 40</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpmconf)
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 40)
  (parent 39)
  (unrealized (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k41">Item <a href="#t39">41</a>, Parent: <a href="#k40">40</a>, Child: <a href="#k42">42</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 191.564 262.464 143.247 334.967'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 41</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id nonce text) (v n data) (k aik akey)
    (tpm tpmconf tpm-0 chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpmconf)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 3))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 41)
  (parent 40)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k42">Item <a href="#t39">42</a>, Parent: <a href="#k41">41</a>, Child: <a href="#k43">43</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 42</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 3)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 42)
  (parent 41)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k43">Item <a href="#t39">43</a>, Parent: <a href="#k42">42</a>, Child: <a href="#k44">44</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus 43</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)) ((3 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat &quot;token&quot; nonce)) (1 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce))))
  (label 43)
  (parent 42)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k44">Item <a href="#t39">44</a>, Parent: <a href="#k43">43</a>, Child: <a href="#k45">45</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt current-value))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 current-value aik-0)</title>
   <circle style='fill: red;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus 44</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce v n k)
  (conf tpmconf)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (0 0) (enc v k))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 44)
  (parent 43)
  (unrealized (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k45">Item <a href="#t39">45</a>, Parent: <a href="#k44">44</a>, Children: <a href="#k46">46</a> <a href="#k47">47</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus 45</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id nonce text) (v n data) (pt pval) (k aik akey)
    (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 3) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 5 2 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 current-value aik-0) (4 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v)))
  (label 45)
  (parent 44)
  (unrealized (4 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k46">Item <a href="#t39">46</a>, Parent: <a href="#k45">45</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 339.960 Q 391.038 449.718 342.276 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 292.860 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 639.960 Q 192.900 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm-0) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus 46</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpmconf tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)) ((4 3) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 3 5 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (4 2))
  (traces ((recv v) (send v))
    ((recv tpm-0 (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm-0
        (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 46)
  (parent 45)
  (unrealized (4 1) (4 2))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k47">Item <a href="#t39">47</a>, Parent: <a href="#k45">45</a>, Children: <a href="#k48">48</a> <a href="#k49">49</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 490.998 449.718 442.236 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 47</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id nonce pcr-id-0 nonce-0 text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpm tpmconf tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 3) (0 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (4 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;
          (hash pcr-id-0 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 47)
  (parent 45)
  (unrealized (5 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k48">Item <a href="#t39">48</a>, Parent: <a href="#k47">47</a>, Child: <a href="#k50">50</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-0)))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 391.484 487.464 343.167 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 639.960 Q 192.900 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpm-1) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 48</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-1)
  (operation channel-test (displaced 3 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm-1 (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))
      (send tpm-1
        (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-1 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 48)
  (parent 47)
  (unrealized (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k49">Item <a href="#t39">49</a>, Parent: <a href="#k47">47</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-1)))</title>
   <circle style='fill: red;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 386.820 152.460 633.720 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus 49</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpmconf tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3))
    ((3 0) (1 0)) ((4 3) (0 0)) ((5 3) (4 2)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;
          (hash pcr-id-0 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 49)
  (parent 47)
  (unrealized (6 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k50">Item <a href="#t39">50</a>, Parent: <a href="#k48">48</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 391.484 487.464 343.167 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 639.960 Q 192.900 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 50 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-0)))
    (5 1))
  (traces ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 50)
  (parent 48)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((v v) (n n) (pcr-id pcr-id) (nonce nonce-0) (k k) (aik aik)
        (tpm tpmconf) (tpmconf tpmconf))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (2 1)) (v (1 4))))</pre>

<p id="t51">Tree <a href="#top">51</a>.</p>

<div>
 <svg
  class='diagram' width='479.280pt' height='229.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.280 229.920' font-size='12.000'>
  <text
   x='389.400' y='176.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k60&quot;, &quot;_self&quot;)'>60</text>
  <line
   x1='339.480' y1='152.460' x2='389.400' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='101.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k61&quot;, &quot;_self&quot;)'>61</text>
  <line
   x1='389.400' y1='114.960' x2='439.320' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k59&quot;, &quot;_self&quot;)'>59</text>
  <line
   x1='339.480' y1='152.460' x2='389.400' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k58&quot;, &quot;_self&quot;)'>58</text>
  <line
   x1='289.560' y1='114.960' x2='339.480' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='26.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k57&quot;, &quot;_self&quot;)'>57</text>
  <line
   x1='289.560' y1='114.960' x2='339.480' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k56&quot;, &quot;_self&quot;)'>56</text>
  <line
   x1='239.640' y1='114.960' x2='289.560' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k55&quot;, &quot;_self&quot;)'>55</text>
  <line
   x1='189.720' y1='114.960' x2='239.640' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k54&quot;, &quot;_self&quot;)'>54</text>
  <line
   x1='139.800' y1='114.960' x2='189.720' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k53&quot;, &quot;_self&quot;)'>53</text>
  <line
   x1='89.880' y1='114.960' x2='139.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k52&quot;, &quot;_self&quot;)'>52</text>
  <line
   x1='39.960' y1='114.960' x2='89.880' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k51&quot;, &quot;_self&quot;)'>51</text>
  </svg></div>

<pre>(defprotocol envelope-plus basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm &quot;power on&quot;) (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 &quot;0&quot;)))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat &quot;token&quot; nonce))
      (recv tpm (cat &quot;extend&quot; pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send &quot;ext ok&quot;))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey)
      (tpm tpmconf chan))
    (trace (recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpmconf)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule ordered-extends
    (forall ((y z strd) (pcr locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 4) (p &quot;tpm-extend-enc&quot; z 4)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr))
        (or (= y z) (prec y 3 z 2) (prec z 3 y 2))))))</pre>

<p id="k51">Item <a href="#t51">51</a>, Child: <a href="#k52">52</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus 51</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 51)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k52">Item <a href="#t51">52</a>, Parent: <a href="#k51">51</a>, Child: <a href="#k53">53</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus 52</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 52)
  (parent 51)
  (unrealized (0 0) (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k53">Item <a href="#t51">53</a>, Parent: <a href="#k52">52</a>, Child: <a href="#k54">54</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 191.564 262.464 143.247 334.967'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 53</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 3))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 53)
  (parent 52)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k54">Item <a href="#t51">54</a>, Parent: <a href="#k53">53</a>, Child: <a href="#k55">55</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 54</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 3)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 54)
  (parent 53)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k55">Item <a href="#t51">55</a>, Parent: <a href="#k54">54</a>, Child: <a href="#k56">56</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus 55</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)) ((3 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat &quot;token&quot; nonce)) (1 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce))))
  (label 55)
  (parent 54)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k56">Item <a href="#t51">56</a>, Parent: <a href="#k55">55</a>, Children: <a href="#k57">57</a> <a href="#k58">58</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 564.960 Q 242.880 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: red;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus 56</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 56)
  (parent 55)
  (unrealized (4 1))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k57">Item <a href="#t51">57</a>, Parent: <a href="#k56">56</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 339.960 Q 391.484 412.464 343.167 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 292.860 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm-0) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus 57</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data) (pt pt-0 pval)
    (k aik akey) (tpmconf tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 2) (0 0))
    ((4 0) (1 0)) ((4 3) (3 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 3 5 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-0 (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 57)
  (parent 56)
  (unrealized (4 1) (4 2))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k58">Item <a href="#t51">58</a>, Parent: <a href="#k56">56</a>, Children: <a href="#k59">59</a> <a href="#k60">60</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 242.880 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 58</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpmconf tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 2) (0 0)) ((5 3) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;
          (hash pcr-id-1 &quot;refuse&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 58)
  (parent 56)
  (unrealized (5 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k59">Item <a href="#t51">59</a>, Parent: <a href="#k58">58</a>, Child: <a href="#k61">61</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 392.220 450.660 344.639 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpm-1) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 59</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 2) (0 0)) ((4 3) (3 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm-1)
  (operation channel-test (displaced 3 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-1
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 59)
  (parent 58)
  (unrealized (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k60">Item <a href="#t51">60</a>, Parent: <a href="#k58">58</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))</title>
   <circle style='fill: red;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 492.180 450.660 444.599 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 242.880 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 386.820 152.460 633.720 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus 60</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpmconf tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3))
    ((3 0) (1 0)) ((4 2) (0 0)) ((5 3) (4 1)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;
          (hash pcr-id-1 &quot;refuse&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 60)
  (parent 58)
  (unrealized (6 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k61">Item <a href="#t51">61</a>, Parent: <a href="#k59">59</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 392.220 450.660 344.639 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 61 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 2) (0 0)) ((4 3) (3 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
    (5 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 61)
  (parent 59)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-0) (tpm tpmconf) (tpmconf tpmconf))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (2 1)) (v (1 4))))</pre>

<p id="t62">Tree <a href="#top">62</a>.</p>

<div>
 <svg
  class='diagram' width='678.960pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 678.960 529.920' font-size='12.000'>
  <text
   x='439.320' y='476.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k72&quot;, &quot;_self&quot;)'>72</text>
  <line
   x1='389.400' y1='302.460' x2='439.320' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='639.000' y='401.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k78&quot;, &quot;_self&quot;)'>78</text>
  <line
   x1='589.080' y1='264.960' x2='639.000' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='639.000' y='326.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k77&quot;, &quot;_self&quot;)'>77</text>
  <line
   x1='589.080' y1='264.960' x2='639.000' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='639.000' y='251.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k76&quot;, &quot;_self&quot;)'>76</text>
  <line
   x1='589.080' y1='264.960' x2='639.000' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='639.000' y='176.040'
   style='font-style: italic; text-anchor: middle; fill: green;'
   onclick='window.open(&quot;#k77&quot;, &quot;_self&quot;)'>77</text>
  <line
   x1='589.080' y1='264.960' x2='639.000' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='639.000' y='101.040'
   style='font-style: italic; text-anchor: middle; fill: green;'
   onclick='window.open(&quot;#k76&quot;, &quot;_self&quot;)'>76</text>
  <line
   x1='589.080' y1='264.960' x2='639.000' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k75&quot;, &quot;_self&quot;)'>75</text>
  <line
   x1='539.160' y1='264.960' x2='589.080' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='539.160' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k74&quot;, &quot;_self&quot;)'>74</text>
  <line
   x1='489.240' y1='264.960' x2='539.160' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='489.240' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k73&quot;, &quot;_self&quot;)'>73</text>
  <line
   x1='439.320' y1='264.960' x2='489.240' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k71&quot;, &quot;_self&quot;)'>71</text>
  <line
   x1='389.400' y1='302.460' x2='439.320' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='288.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k70&quot;, &quot;_self&quot;)'>70</text>
  <line
   x1='339.480' y1='264.960' x2='389.400' y2='302.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k69&quot;, &quot;_self&quot;)'>69</text>
  <line
   x1='339.480' y1='264.960' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k68&quot;, &quot;_self&quot;)'>68</text>
  <line
   x1='289.560' y1='264.960' x2='339.480' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k67&quot;, &quot;_self&quot;)'>67</text>
  <line
   x1='239.640' y1='264.960' x2='289.560' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k66&quot;, &quot;_self&quot;)'>66</text>
  <line
   x1='189.720' y1='264.960' x2='239.640' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k65&quot;, &quot;_self&quot;)'>65</text>
  <line
   x1='139.800' y1='264.960' x2='189.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k64&quot;, &quot;_self&quot;)'>64</text>
  <line
   x1='89.880' y1='264.960' x2='139.800' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k63&quot;, &quot;_self&quot;)'>63</text>
  <line
   x1='39.960' y1='264.960' x2='89.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='251.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k62&quot;, &quot;_self&quot;)'>62</text>
  </svg></div>

<pre>(defprotocol envelope-plus basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm &quot;power on&quot;) (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 &quot;0&quot;)))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat &quot;token&quot; nonce))
      (recv tpm (cat &quot;extend&quot; pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send &quot;ext ok&quot;))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey)
      (tpm tpmconf chan))
    (trace (recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpmconf)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule ordered-extends
    (forall ((y z strd) (pcr locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 4) (p &quot;tpm-extend-enc&quot; z 4)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr))
        (or (= y z) (prec y 3 z 2) (prec z 3 y 2))))))</pre>

<p id="k62">Item <a href="#t62">62</a>, Child: <a href="#k63">63</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 62</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 62)
  (unrealized (0 0) (1 0) (2 3))
  (preskeleton)
  (origs (v (2 4)) (n (2 1)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k63">Item <a href="#t62">63</a>, Parent: <a href="#k62">62</a>, Child: <a href="#k64">64</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 63</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (precedes ((2 4) (0 0)) ((2 4) (1 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 63)
  (parent 62)
  (unrealized (0 0) (2 3))
  (origs (v (2 4)) (n (2 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k64">Item <a href="#t62">64</a>, Parent: <a href="#k63">63</a>, Child: <a href="#k65">65</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 189.960 Q 291.524 262.464 243.207 334.967'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus 64</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((2 4) (0 0)) ((2 4) (1 0)) ((3 1) (2 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (2 3))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 64)
  (parent 63)
  (unrealized (0 0) (1 0) (3 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k65">Item <a href="#t62">65</a>, Parent: <a href="#k64">64</a>, Child: <a href="#k66">66</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus 65</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (1 0)) ((3 1) (2 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (displaced 4 2 alice 3)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (3 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 65)
  (parent 64)
  (unrealized (0 0) (1 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k66">Item <a href="#t62">66</a>, Parent: <a href="#k65">65</a>, Child: <a href="#k67">67</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus 66</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (1 0)) ((3 1) (2 3))
    ((4 0) (2 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat &quot;token&quot; nonce)) (2 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce))))
  (label 66)
  (parent 65)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k67">Item <a href="#t62">67</a>, Parent: <a href="#k66">66</a>, Child: <a href="#k68">68</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt current-value))</title>
   <circle style='fill: blue;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-1 current-value aik-0)</title>
   <circle style='fill: red;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-1) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 67</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (current-value mesg) (pcr-id pcr-id-0 nonce pcr-id-1 text)
    (n v data) (pt pval) (k aik aik-0 akey) (tpm tpmconf tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0)) ((3 1) (2 3))
    ((4 0) (2 0)) ((5 3) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce n v k)
  (conf tpmconf)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (1 0) (enc v k))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-1 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 67)
  (parent 66)
  (unrealized (0 0) (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k68">Item <a href="#t62">68</a>, Parent: <a href="#k67">67</a>, Children: <a href="#k69">69</a> <a href="#k70">70</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 68</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0)) ((3 1) (2 3))
    ((4 0) (2 0)) ((5 3) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 6 3 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-1 current-value aik-0) (5 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v)))
  (label 68)
  (parent 67)
  (unrealized (0 0) (5 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k69">Item <a href="#t62">69</a>, Parent: <a href="#k68">68</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 490.998 449.718 442.236 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 392.820 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm-0) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 69</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data) (pt pt-0 pval)
    (k aik akey) (tpmconf tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (4 0)) ((3 1) (2 3))
    ((4 3) (1 0)) ((5 0) (2 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 4 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-0 (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 69)
  (parent 68)
  (unrealized (0 0) (5 1) (5 2))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k70">Item <a href="#t62">70</a>, Parent: <a href="#k68">68</a>, Children: <a href="#k71">71</a> <a href="#k72">72</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 590.958 449.718 542.196 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus 70</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpmconf tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0)) ((3 1) (2 3))
    ((4 0) (2 0)) ((5 3) (1 0)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;
          (hash pcr-id-1 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 70)
  (parent 68)
  (unrealized (0 0) (6 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k71">Item <a href="#t62">71</a>, Parent: <a href="#k70">70</a>, Child: <a href="#k73">73</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))</title>
   <circle style='fill: red;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpm-1) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus 71</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (4 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-1)
  (operation channel-test (displaced 4 7 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (6 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-1
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 71)
  (parent 70)
  (unrealized (0 0) (6 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k72">Item <a href="#t62">72</a>, Parent: <a href="#k70">70</a>.</p>

<div>
 <svg
  class='diagram' width='779.640pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 779.640 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='739.680' y1='114.960' x2='739.680' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='189.960' x2='639.720' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 739.680 339.960 Q 692.700 339.960 645.720 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))</title>
   <circle style='fill: red;' cx='739.680' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='739.680' cy='114.960' r='6.000'/></g>
  <path
   d='M 639.720 414.960 Q 591.404 487.464 543.087 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='639.720' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 486.780 152.460 733.680 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='739.680' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='389.820' y='39.960'
   style='text-anchor: middle;'>envelope-plus 72</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpmconf tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((2 1) (7 1)) ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0))
    ((3 1) (2 3)) ((4 0) (2 0)) ((5 3) (1 0)) ((6 3) (5 2))
    ((7 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (6 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;
          (hash pcr-id-1 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 72)
  (parent 70)
  (unrealized (0 0) (7 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k73">Item <a href="#t62">73</a>, Parent: <a href="#k71">71</a>, Child: <a href="#k74">74</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus 73</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (4 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 7 2 alice 2)
    (ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
    (6 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 73)
  (parent 71)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k74">Item <a href="#t62">74</a>, Parent: <a href="#k73">73</a>, Child: <a href="#k75">75</a>.</p>

<div>
 <svg
  class='diagram' width='779.640pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 779.640 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: red;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='389.820' y='39.960'
   style='text-anchor: middle;'>envelope-plus 74</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pt-2 pval) (k aik akey) (tpmconf tpm tpm-0 tpm-1 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (4 0)) ((2 4) (7 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)) ((7 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 74)
  (parent 73)
  (unrealized (7 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k75">Item <a href="#t62">75</a>, Parent: <a href="#k74">74</a>, Children: <a href="#k76">76</a> <a href="#k77">77</a> <a href="#k78">78</a>, Seen Children: <a href="#k76">76</a> <a href="#k77">77</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='114.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 339.960 Q 791.324 412.464 743.007 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot; (hash pcr-id-2 &quot;refuse&quot; nonce-1)))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='839.640' cy='114.960' r='6.000'/></g>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope-plus 75</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (4 0)) ((2 4) (7 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)) ((7 2) (0 0)) ((8 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-2 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))) (7 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2
        (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;
          (hash pcr-id-2 &quot;refuse&quot; nonce-1)))
      (load pcr-0 (cat pt-3 (hash &quot;0&quot; n)))
      (stor pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 75)
  (parent 74)
  (seen 76 77)
  (unrealized (8 2))
  (comment &quot;5 in cohort - 3 not yet seen&quot;))</pre>

<p id="k76">Item <a href="#t62">76</a>, Parent: <a href="#k75">75</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='264.960' x2='839.640' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 489.960 Q 792.660 489.960 745.680 489.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='839.640' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='839.640' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot; (hash pcr-id-2 &quot;refuse&quot; nonce-1)))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='839.640' cy='264.960' r='6.000'/></g>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 539.760 414.960 Q 686.700 377.460 833.640 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-0) (pt-0 pt-2) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope-plus 76 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-0) (pt-0 pt-2) (tpm tpm-2) (pcr pcr))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (4 0)) ((2 4) (7 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((5 3) (8 2))
    ((6 0) (2 0)) ((6 3) (5 2)) ((7 2) (0 0)) ((8 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-2 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (rule ordered-extends)
  (operation channel-test (displaced 9 6 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n))) (8 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2
        (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;
          (hash pcr-id-2 &quot;refuse&quot; nonce-1)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 76)
  (parent 75)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-0) (tpm tpmconf) (tpmconf tpmconf))))
  (origs (nonce-0 (6 0)) (pt-0 (6 3)) (nonce-1 (8 0)) (pt-2 (8 3))
    (n (2 1)) (nonce (5 0)) (pt (5 3)) (k (3 1)) (v (2 4))))</pre>

<p id="k77">Item <a href="#t62">77</a>, Parent: <a href="#k75">75</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='264.960' x2='539.760' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 414.960 Q 692.700 377.460 545.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 839.640 414.960 Q 792.060 450.660 744.479 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='839.640' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot; (hash pcr-id-2 &quot;refuse&quot; nonce-1)))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 736.680 302.460 833.640 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 489.960 Q 492.180 525.660 444.599 561.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='264.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-0) (pt-0 pt-2) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope-plus 77 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-0) (pt-0 pt-2) (tpm tpm-2) (pcr pcr))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (4 0)) ((2 4) (7 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (8 2)) ((7 2) (0 0)) ((8 3) (5 2)) ((8 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-2 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (rule ordered-extends)
  (operation channel-test (displaced 9 6 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n))) (8 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2
        (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;
          (hash pcr-id-2 &quot;refuse&quot; nonce-1)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 77)
  (parent 75)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-0) (tpm tpmconf) (tpmconf tpmconf))))
  (origs (nonce-0 (6 0)) (pt-0 (6 3)) (nonce-1 (8 0)) (pt-2 (8 3))
    (n (2 1)) (nonce (5 0)) (pt (5 3)) (k (3 1)) (v (2 4))))</pre>

<p id="k78">Item <a href="#t62">78</a>, Parent: <a href="#k75">75</a>.</p>

<div>
 <svg
  class='diagram' width='979.560pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 979.560 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='939.600' y1='114.960' x2='939.600' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 939.600 339.960 Q 892.620 339.960 845.640 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='939.600' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (cat pt-4 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='939.600' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-3 n (hash pcr-id-3 n nonce-2)))</title>
   <circle style='fill: red;' cx='939.600' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-3 (cat &quot;token&quot; nonce-2))</title>
   <circle cx='939.600' cy='114.960' r='6.000'/></g>
  <path
   d='M 839.640 414.960 Q 792.060 450.660 744.479 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='839.640' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot; (hash pcr-id-2 &quot;refuse&quot; nonce-1)))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 189.960 Q 586.740 152.460 933.600 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='939.600' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='489.780' y='39.960'
   style='text-anchor: middle;'>envelope-plus 78</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpmconf tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-3) (tpm tpm-3)
    (pcr pcr-0))
  (precedes ((2 1) (6 1)) ((2 1) (9 1)) ((2 2) (3 0)) ((2 4) (4 0))
    ((2 4) (7 0)) ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2))
    ((6 0) (2 0)) ((6 3) (5 2)) ((7 2) (0 0)) ((8 3) (7 1))
    ((9 3) (8 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-2 pt-3 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n))) (8 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2
        (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;
          (hash pcr-id-2 &quot;refuse&quot; nonce-1)))
      (load pcr-0 (cat pt-3 (hash &quot;0&quot; n)))
      (stor pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpm-3 (cat &quot;token&quot; nonce-2))
      (recv tpm-3 (cat &quot;extend&quot; pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 &quot;0&quot;)) (stor pcr-0 (cat pt-3 (hash &quot;0&quot; n)))))
  (label 78)
  (parent 75)
  (unrealized (9 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="t79">Tree <a href="#top">79</a>.</p>

<div>
 <svg
  class='diagram' width='529.200pt' height='229.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 529.200 229.920' font-size='12.000'>
  <text
   x='439.320' y='176.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k89&quot;, &quot;_self&quot;)'>89</text>
  <line
   x1='389.400' y1='152.460' x2='439.320' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='489.240' y='101.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k90&quot;, &quot;_self&quot;)'>90</text>
  <line
   x1='439.320' y1='114.960' x2='489.240' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k88&quot;, &quot;_self&quot;)'>88</text>
  <line
   x1='389.400' y1='152.460' x2='439.320' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k87&quot;, &quot;_self&quot;)'>87</text>
  <line
   x1='339.480' y1='114.960' x2='389.400' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k86&quot;, &quot;_self&quot;)'>86</text>
  <line
   x1='339.480' y1='114.960' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k85&quot;, &quot;_self&quot;)'>85</text>
  <line
   x1='289.560' y1='114.960' x2='339.480' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k84&quot;, &quot;_self&quot;)'>84</text>
  <line
   x1='239.640' y1='114.960' x2='289.560' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k83&quot;, &quot;_self&quot;)'>83</text>
  <line
   x1='189.720' y1='114.960' x2='239.640' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k82&quot;, &quot;_self&quot;)'>82</text>
  <line
   x1='139.800' y1='114.960' x2='189.720' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k81&quot;, &quot;_self&quot;)'>81</text>
  <line
   x1='89.880' y1='114.960' x2='139.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k80&quot;, &quot;_self&quot;)'>80</text>
  <line
   x1='39.960' y1='114.960' x2='89.880' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k79&quot;, &quot;_self&quot;)'>79</text>
  </svg></div>

<pre>(defprotocol envelope-plus-2 basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm &quot;power on&quot;) (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 &quot;0&quot;)))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat &quot;token&quot; nonce))
      (recv tpm (cat &quot;extend&quot; pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send &quot;ext ok&quot;))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey)
      (tpm tpmconf chan))
    (trace (recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpmconf)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule pcr-id-identifies-pcr
    (forall ((y z strd) (pcr-id text) (pcr pcr-0 locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 3) (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; y pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; z pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr-0))
        (= pcr pcr-0)))))</pre>

<p id="k79">Item <a href="#t79">79</a>, Child: <a href="#k80">80</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 79</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpmconf)
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 79)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k80">Item <a href="#t79">80</a>, Parent: <a href="#k79">79</a>, Child: <a href="#k81">81</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 80</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpmconf)
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 80)
  (parent 79)
  (unrealized (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k81">Item <a href="#t79">81</a>, Parent: <a href="#k80">80</a>, Child: <a href="#k82">82</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 191.564 262.464 143.247 334.967'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 81</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id nonce text) (v n data) (k aik akey)
    (tpm tpmconf tpm-0 chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpmconf)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 3))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 81)
  (parent 80)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k82">Item <a href="#t79">82</a>, Parent: <a href="#k81">81</a>, Child: <a href="#k83">83</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 82</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 3)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 82)
  (parent 81)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k83">Item <a href="#t79">83</a>, Parent: <a href="#k82">82</a>, Child: <a href="#k84">84</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 83</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id nonce text) (v n data) (k aik akey) (tpm tpmconf chan))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)) ((3 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat &quot;token&quot; nonce)) (1 0))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce))))
  (label 83)
  (parent 82)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k84">Item <a href="#t79">84</a>, Parent: <a href="#k83">83</a>, Child: <a href="#k85">85</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt current-value))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 current-value aik-0)</title>
   <circle style='fill: red;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 84</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (current-value mesg) (pcr-id nonce pcr-id-0 text) (v n data)
    (pt pval) (k aik aik-0 akey) (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce v n k)
  (conf tpmconf)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (0 0) (enc v k))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 84)
  (parent 83)
  (unrealized (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k85">Item <a href="#t79">85</a>, Parent: <a href="#k84">84</a>, Children: <a href="#k86">86</a> <a href="#k87">87</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 85</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id nonce text) (v n data) (pt pval) (k aik akey)
    (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 3) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 5 2 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 current-value aik-0) (4 1))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v)))
  (label 85)
  (parent 84)
  (unrealized (4 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k86">Item <a href="#t79">86</a>, Parent: <a href="#k85">85</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 339.960 Q 391.038 449.718 342.276 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 292.860 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 639.960 Q 192.900 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm-0) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 86</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpmconf tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 3) (0 0))
    ((4 0) (1 0)) ((4 3) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce v n pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 3 5 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (4 2))
  (traces ((recv v) (send v))
    ((recv tpm-0 (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm-0
        (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 86)
  (parent 85)
  (unrealized (4 1) (4 2))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k87">Item <a href="#t79">87</a>, Parent: <a href="#k85">85</a>, Children: <a href="#k88">88</a> <a href="#k89">89</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 490.998 449.718 442.236 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 87</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id nonce pcr-id-0 nonce-0 text) (v n data) (pt pt-0 pval)
    (k aik akey) (tpm tpmconf tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 3) (0 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (4 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;
          (hash pcr-id-0 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 87)
  (parent 85)
  (unrealized (5 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k88">Item <a href="#t79">88</a>, Parent: <a href="#k87">87</a>, Child: <a href="#k90">90</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-0)))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 391.484 487.464 343.167 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 639.960 Q 192.900 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpm-1) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 88</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-1)
  (operation channel-test (displaced 3 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm-1 (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))
      (send tpm-1
        (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-1 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 88)
  (parent 87)
  (unrealized (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k89">Item <a href="#t79">89</a>, Parent: <a href="#k87">87</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-1)))</title>
   <circle style='fill: red;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 242.880 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 386.820 152.460 633.720 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 89</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id nonce pcr-id-0 nonce-0 pcr-id-1 nonce-1 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpmconf tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-1) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3))
    ((3 0) (1 0)) ((4 3) (0 0)) ((5 3) (4 2)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 v n pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;
          (hash pcr-id-0 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-1)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 89)
  (parent 87)
  (unrealized (6 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k90">Item <a href="#t79">90</a>, Parent: <a href="#k88">88</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 391.484 487.464 343.167 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 639.960 Q 192.900 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 90 (realized)</text>
  </svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce nonce-0 text) (v n data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (pt pt)
    (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 3) (0 0)) ((4 3) (3 2)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 v n pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 n (hash pcr-id-1 n nonce-0)))
    (5 1))
  (traces ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot; (hash pcr-id-0 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 90)
  (parent 88)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((v v) (n n) (pcr-id pcr-id) (nonce nonce-0) (k k) (aik aik)
        (tpm tpmconf) (tpmconf tpmconf))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (2 1)) (v (1 4))))</pre>

<p id="t91">Tree <a href="#top">91</a>.</p>

<div>
 <svg
  class='diagram' width='479.280pt' height='229.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.280 229.920' font-size='12.000'>
  <text
   x='389.400' y='176.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k100&quot;, &quot;_self&quot;)'>100</text>
  <line
   x1='339.480' y1='152.460' x2='389.400' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='101.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k101&quot;, &quot;_self&quot;)'>101</text>
  <line
   x1='389.400' y1='114.960' x2='439.320' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k99&quot;, &quot;_self&quot;)'>99</text>
  <line
   x1='339.480' y1='152.460' x2='389.400' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k98&quot;, &quot;_self&quot;)'>98</text>
  <line
   x1='289.560' y1='114.960' x2='339.480' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='26.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k97&quot;, &quot;_self&quot;)'>97</text>
  <line
   x1='289.560' y1='114.960' x2='339.480' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k96&quot;, &quot;_self&quot;)'>96</text>
  <line
   x1='239.640' y1='114.960' x2='289.560' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k95&quot;, &quot;_self&quot;)'>95</text>
  <line
   x1='189.720' y1='114.960' x2='239.640' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k94&quot;, &quot;_self&quot;)'>94</text>
  <line
   x1='139.800' y1='114.960' x2='189.720' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k93&quot;, &quot;_self&quot;)'>93</text>
  <line
   x1='89.880' y1='114.960' x2='139.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k92&quot;, &quot;_self&quot;)'>92</text>
  <line
   x1='39.960' y1='114.960' x2='89.880' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k91&quot;, &quot;_self&quot;)'>91</text>
  </svg></div>

<pre>(defprotocol envelope-plus-2 basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm &quot;power on&quot;) (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 &quot;0&quot;)))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat &quot;token&quot; nonce))
      (recv tpm (cat &quot;extend&quot; pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send &quot;ext ok&quot;))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey)
      (tpm tpmconf chan))
    (trace (recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpmconf)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule pcr-id-identifies-pcr
    (forall ((y z strd) (pcr-id text) (pcr pcr-0 locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 3) (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; y pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; z pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr-0))
        (= pcr pcr-0)))))</pre>

<p id="k91">Item <a href="#t91">91</a>, Child: <a href="#k92">92</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 91</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 91)
  (unrealized (0 0) (1 3))
  (preskeleton)
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k92">Item <a href="#t91">92</a>, Parent: <a href="#k91">91</a>, Child: <a href="#k93">93</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 92</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (precedes ((1 4) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 92)
  (parent 91)
  (unrealized (0 0) (1 3))
  (origs (v (1 4)) (n (1 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k93">Item <a href="#t91">93</a>, Parent: <a href="#k92">92</a>, Child: <a href="#k94">94</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 191.564 262.464 143.247 334.967'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 93</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 3))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 93)
  (parent 92)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k94">Item <a href="#t91">94</a>, Parent: <a href="#k93">93</a>, Child: <a href="#k95">95</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 94</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 3)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 94)
  (parent 93)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k95">Item <a href="#t91">95</a>, Parent: <a href="#k94">94</a>, Child: <a href="#k96">96</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 95</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((1 2) (2 0)) ((1 4) (0 0)) ((2 1) (1 3)) ((3 0) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat &quot;token&quot; nonce)) (1 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce))))
  (label 95)
  (parent 94)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k96">Item <a href="#t91">96</a>, Parent: <a href="#k95">95</a>, Children: <a href="#k97">97</a> <a href="#k98">98</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 564.960 Q 242.880 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: red;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 96</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 96)
  (parent 95)
  (unrealized (4 1))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k97">Item <a href="#t91">97</a>, Parent: <a href="#k96">96</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 339.960 Q 391.484 412.464 343.167 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 292.860 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm-0) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 97</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data) (pt pt-0 pval)
    (k aik akey) (tpmconf tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3)) ((3 2) (0 0))
    ((4 0) (1 0)) ((4 3) (3 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 3 5 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-0 (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 97)
  (parent 96)
  (unrealized (4 1) (4 2))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k98">Item <a href="#t91">98</a>, Parent: <a href="#k96">96</a>, Children: <a href="#k99">99</a> <a href="#k100">100</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 242.880 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 98</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpmconf tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3)) ((3 0) (1 0))
    ((4 2) (0 0)) ((5 3) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;
          (hash pcr-id-1 &quot;refuse&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 98)
  (parent 96)
  (unrealized (5 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k99">Item <a href="#t91">99</a>, Parent: <a href="#k98">98</a>, Child: <a href="#k101">101</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 392.220 450.660 344.639 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpm-1) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 99</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 2) (0 0)) ((4 3) (3 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm-1)
  (operation channel-test (displaced 3 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-1
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 99)
  (parent 98)
  (unrealized (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k100">Item <a href="#t91">100</a>, Parent: <a href="#k98">98</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))</title>
   <circle style='fill: red;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 492.180 450.660 444.599 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 242.880 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 114.960 Q 242.880 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 286.860 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 386.820 152.460 633.720 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 100</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpmconf tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((1 1) (6 1)) ((1 2) (2 0)) ((1 4) (4 0)) ((2 1) (1 3))
    ((3 0) (1 0)) ((4 2) (0 0)) ((5 3) (4 1)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;
          (hash pcr-id-1 &quot;refuse&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 100)
  (parent 98)
  (unrealized (6 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k101">Item <a href="#t91">101</a>, Parent: <a href="#k99">99</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='414.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 492.780 339.960 445.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 342.840 77.460 145.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 414.960 Q 392.220 450.660 344.639 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 236.880 377.460 333.840 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 186.900 264.960 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 336.840 152.460 533.760 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 101 (realized)</text>
  </svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt)
    (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (precedes ((1 1) (5 1)) ((1 2) (2 0)) ((1 4) (3 0)) ((2 1) (1 3))
    ((3 2) (0 0)) ((4 3) (3 1)) ((5 0) (1 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 6 1 alice 2)
    (ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
    (5 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot; (hash pcr-id-1 &quot;refuse&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 101)
  (parent 99)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-0) (tpm tpmconf) (tpmconf tpmconf))))
  (origs (n (1 1)) (nonce-0 (5 0)) (pt-0 (5 3)) (nonce (4 0)) (pt (4 3))
    (k (2 1)) (v (1 4))))</pre>

<p id="t102">Tree <a href="#top">102</a>.</p>

<div>
 <svg
  class='diagram' width='678.960pt' height='304.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 678.960 304.920' font-size='12.000'>
  <text
   x='439.320' y='251.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k112&quot;, &quot;_self&quot;)'>112</text>
  <line
   x1='389.400' y1='189.960' x2='439.320' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='639.000' y='176.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k117&quot;, &quot;_self&quot;)'>117</text>
  <line
   x1='589.080' y1='152.460' x2='639.000' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='639.000' y='101.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k116&quot;, &quot;_self&quot;)'>116</text>
  <line
   x1='589.080' y1='152.460' x2='639.000' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k115&quot;, &quot;_self&quot;)'>115</text>
  <line
   x1='539.160' y1='152.460' x2='589.080' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='539.160' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k114&quot;, &quot;_self&quot;)'>114</text>
  <line
   x1='489.240' y1='152.460' x2='539.160' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='489.240' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k113&quot;, &quot;_self&quot;)'>113</text>
  <line
   x1='439.320' y1='152.460' x2='489.240' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k111&quot;, &quot;_self&quot;)'>111</text>
  <line
   x1='389.400' y1='189.960' x2='439.320' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k110&quot;, &quot;_self&quot;)'>110</text>
  <line
   x1='339.480' y1='152.460' x2='389.400' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: red;'
   onclick='window.open(&quot;#k109&quot;, &quot;_self&quot;)'>109</text>
  <line
   x1='339.480' y1='152.460' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k108&quot;, &quot;_self&quot;)'>108</text>
  <line
   x1='289.560' y1='152.460' x2='339.480' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k107&quot;, &quot;_self&quot;)'>107</text>
  <line
   x1='239.640' y1='152.460' x2='289.560' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k106&quot;, &quot;_self&quot;)'>106</text>
  <line
   x1='189.720' y1='152.460' x2='239.640' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k105&quot;, &quot;_self&quot;)'>105</text>
  <line
   x1='139.800' y1='152.460' x2='189.720' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k104&quot;, &quot;_self&quot;)'>104</text>
  <line
   x1='89.880' y1='152.460' x2='139.800' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k103&quot;, &quot;_self&quot;)'>103</text>
  <line
   x1='39.960' y1='152.460' x2='89.880' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k102&quot;, &quot;_self&quot;)'>102</text>
  </svg></div>

<pre>(defprotocol envelope-plus-2 basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan) (pt pt-0 pval))
    (trace (recv tpm &quot;power on&quot;) (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 &quot;0&quot;)))
    (uniq-orig pt-0))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id nonce text) (pcr locn)
      (tpm chan) (pt pt-0 pval))
    (trace (send tpm (cat &quot;token&quot; nonce))
      (recv tpm (cat &quot;extend&quot; pcr-id value (hash pcr-id value nonce)))
      (load pcr (cat pt current-value))
      (stor pcr (cat pt-0 (hash current-value value))) (send &quot;ext ok&quot;))
    (uniq-orig nonce pt-0))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr (cat pt current-value))
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan) (pt pval))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr (cat pt current-value)) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id nonce text) (k aik akey)
      (tpm tpmconf chan))
    (trace (recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id n (hash pcr-id n nonce)))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpmconf)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-not-catted-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule genStV-not-catted-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (cat v1 v2)))
        (false))))
  (defrule pcr-id-identifies-pcr
    (forall ((y z strd) (pcr-id text) (pcr pcr-0 locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 3) (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; y pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; z pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr-0))
        (= pcr pcr-0)))))</pre>

<p id="k102">Item <a href="#t102">102</a>, Child: <a href="#k103">103</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 102</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 102)
  (unrealized (0 0) (1 0) (2 3))
  (preskeleton)
  (origs (v (2 4)) (n (2 1)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k103">Item <a href="#t102">103</a>, Parent: <a href="#k102">102</a>, Child: <a href="#k104">104</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 103</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (precedes ((2 4) (0 0)) ((2 4) (1 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpmconf)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 103)
  (parent 102)
  (unrealized (0 0) (2 3))
  (origs (v (2 4)) (n (2 1)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k104">Item <a href="#t102">104</a>, Parent: <a href="#k103">103</a>, Child: <a href="#k105">105</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 189.960 Q 291.524 262.464 243.207 334.967'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 104</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((2 4) (0 0)) ((2 4) (1 0)) ((3 1) (2 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (2 3))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 104)
  (parent 103)
  (unrealized (0 0) (1 0) (3 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k105">Item <a href="#t102">105</a>, Parent: <a href="#k104">104</a>, Child: <a href="#k106">106</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 105</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (1 0)) ((3 1) (2 3)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (displaced 4 2 alice 3)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (3 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 105)
  (parent 104)
  (unrealized (0 0) (1 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k106">Item <a href="#t102">106</a>, Parent: <a href="#k105">105</a>, Child: <a href="#k107">107</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='529.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 529.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='414.960' x2='139.920' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 106</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (k aik akey)
    (tpm tpmconf chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (1 0)) ((3 1) (2 3))
    ((4 0) (2 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 1)
    (ch-msg tpm (cat &quot;token&quot; nonce)) (2 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce))))
  (label 106)
  (parent 105)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k107">Item <a href="#t102">107</a>, Parent: <a href="#k106">106</a>, Child: <a href="#k108">108</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt current-value))</title>
   <circle style='fill: blue;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-1 current-value aik-0)</title>
   <circle style='fill: red;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-1) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 107</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (current-value mesg) (pcr-id pcr-id-0 nonce pcr-id-1 text)
    (n v data) (pt pval) (k aik aik-0 akey) (tpm tpmconf tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (pt pt) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0)) ((3 1) (2 3))
    ((4 0) (2 0)) ((5 3) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig nonce n v k)
  (conf tpmconf)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (1 0) (enc v k))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-1 current-value aik-0))
      (load pcr (cat pt current-value)) (send v)))
  (label 107)
  (parent 106)
  (unrealized (0 0) (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k108">Item <a href="#t102">108</a>, Parent: <a href="#k107">107</a>, Children: <a href="#k109">109</a> <a href="#k110">110</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 108</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce text) (n v data) (pt pval) (k aik akey)
    (tpm tpmconf tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0)) ((3 1) (2 3))
    ((4 0) (2 0)) ((5 3) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 6 3 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-1 current-value aik-0) (5 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v)))
  (label 108)
  (parent 107)
  (unrealized (0 0) (5 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k109">Item <a href="#t102">109</a>, Parent: <a href="#k108">108</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 339.960 Q 490.998 449.718 442.236 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 114.960 Q 392.820 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm-0) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 109</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce text) (n v data) (pt pt-0 pval)
    (k aik akey) (tpmconf tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm-0) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (4 0)) ((3 1) (2 3))
    ((4 3) (1 0)) ((5 0) (2 0)) ((5 3) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-0)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (displaced 4 6 tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-0 (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm-0
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 109)
  (parent 108)
  (unrealized (0 0) (5 1) (5 2))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k110">Item <a href="#t102">110</a>, Parent: <a href="#k108">108</a>, Children: <a href="#k111">111</a> <a href="#k112">112</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 590.958 449.718 542.196 559.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 110</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 text) (n v data)
    (pt pt-0 pval) (k aik akey) (tpm tpmconf tpm-0 tpm-1 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (precedes ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0)) ((3 1) (2 3))
    ((4 0) (2 0)) ((5 3) (1 0)) ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (5 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;
          (hash pcr-id-1 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))))
  (label 110)
  (parent 108)
  (unrealized (0 0) (6 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k111">Item <a href="#t102">111</a>, Parent: <a href="#k110">110</a>, Child: <a href="#k113">113</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))</title>
   <circle style='fill: red;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpm-1) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 111</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce pcr-id-2 nonce-0 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpm-1) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-1))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (4 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm-1)
  (operation channel-test (displaced 4 7 tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (6 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm-1 (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpm-1
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-1
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 111)
  (parent 110)
  (unrealized (0 0) (6 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k112">Item <a href="#t102">112</a>, Parent: <a href="#k110">110</a>.</p>

<div>
 <svg
  class='diagram' width='779.640pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 779.640 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='739.680' y1='114.960' x2='739.680' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='189.960' x2='639.720' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='414.960' x2='539.760' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 739.680 339.960 Q 692.700 339.960 645.720 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))</title>
   <circle style='fill: red;' cx='739.680' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='739.680' cy='114.960' r='6.000'/></g>
  <path
   d='M 639.720 414.960 Q 591.404 487.464 543.087 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='639.720' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-1 (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 539.760 639.960 Q 342.840 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='539.760' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='539.760' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <path
   d='M 439.800 114.960 Q 342.840 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 386.820 377.460 533.760 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 486.780 152.460 733.680 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;token&quot; nonce))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='739.680' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0) (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g><title>((nonce nonce) (tpm tpm))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k) (aik aik) (tpm tpm) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='389.820' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 112</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 nonce pcr-id-1 nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pval) (k aik akey)
    (tpm tpmconf tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce) (n n) (v v) (k k)
    (aik aik) (tpm tpm) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-extend-enc 1 (nonce nonce) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce-0)
    (pt pt-0) (pt-0 pt) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-1) (pt-0 pt-0) (tpm tpm-2)
    (pcr pcr))
  (precedes ((2 1) (7 1)) ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (5 0))
    ((3 1) (2 3)) ((4 0) (2 0)) ((5 3) (1 0)) ((6 3) (5 2))
    ((7 3) (6 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr (cat pt-0 (hash &quot;0&quot; n))) (6 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpm (cat &quot;token&quot; nonce))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce)))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((send tpm (cat &quot;token&quot; nonce)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-1 (cat &quot;token&quot; nonce-0))
      (recv tpm-1
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;
          (hash pcr-id-1 &quot;obtain&quot; nonce-0)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-1)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 112)
  (parent 110)
  (unrealized (0 0) (7 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

<p id="k113">Item <a href="#t102">113</a>, Parent: <a href="#k111">111</a>, Child: <a href="#k114">114</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='414.960' x2='39.960' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 113</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pval) (k aik akey) (tpmconf tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (0 0)) ((2 4) (4 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 7 2 alice 2)
    (ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-2 n (hash pcr-id-2 n nonce-0)))
    (6 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n)))))
  (label 113)
  (parent 111)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k114">Item <a href="#t102">114</a>, Parent: <a href="#k113">113</a>, Child: <a href="#k115">115</a>.</p>

<div>
 <svg
  class='diagram' width='779.640pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 779.640 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: red;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='389.820' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 114</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 text) (n v data)
    (pt pt-0 pt-1 pt-2 pval) (k aik akey) (tpmconf tpm tpm-0 tpm-1 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (4 0)) ((2 4) (7 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)) ((7 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 n v pt pt-0 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 114)
  (parent 113)
  (unrealized (7 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k115">Item <a href="#t102">115</a>, Parent: <a href="#k114">114</a>, Children: <a href="#k116">116</a> <a href="#k117">117</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='114.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 339.960 Q 791.324 412.464 743.007 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n)))</title>
   <circle style='fill: red;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot; (hash pcr-id-2 &quot;refuse&quot; nonce-1)))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='839.640' cy='114.960' r='6.000'/></g>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 115</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pt-3 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (4 0)) ((2 4) (7 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)) ((7 2) (0 0)) ((8 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-2 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))) (7 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2
        (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;
          (hash pcr-id-2 &quot;refuse&quot; nonce-1)))
      (load pcr-0 (cat pt-3 (hash &quot;0&quot; n)))
      (stor pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 115)
  (parent 114)
  (unrealized (8 2))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k116">Item <a href="#t102">116</a>, Parent: <a href="#k115">115</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 414.960 Q 792.060 450.660 744.479 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='839.640' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot; (hash pcr-id-2 &quot;refuse&quot; nonce-1)))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 639.720 339.960 Q 736.680 302.460 833.640 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-0) (pt-0 pt-2) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 116 (realized)</text>
  </svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 pcr-id-2 nonce-1 text)
    (n v data) (pt pt-0 pt-1 pt-2 pval) (k aik akey)
    (tpmconf tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-0) (pt-0 pt-2) (tpm tpm-2) (pcr pcr))
  (precedes ((2 1) (6 1)) ((2 2) (3 0)) ((2 4) (4 0)) ((2 4) (7 0))
    ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2)) ((6 0) (2 0))
    ((6 3) (5 2)) ((6 3) (8 2)) ((7 2) (0 0)) ((8 3) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 n v pt pt-0 pt-2 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (displaced 9 6 tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n))) (8 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2
        (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;
          (hash pcr-id-2 &quot;refuse&quot; nonce-1)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))))
  (label 116)
  (parent 115)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (nonce nonce-0) (tpm tpmconf) (tpmconf tpmconf))))
  (origs (nonce-0 (6 0)) (pt-0 (6 3)) (nonce-1 (8 0)) (pt-2 (8 3))
    (n (2 1)) (nonce (5 0)) (pt (5 3)) (k (3 1)) (v (2 4))))</pre>

<p id="k117">Item <a href="#t102">117</a>, Parent: <a href="#k115">115</a>.</p>

<div>
 <svg
  class='diagram' width='979.560pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 979.560 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='939.600' y1='114.960' x2='939.600' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='414.960' x2='739.680' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='414.960' x2='439.800' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='264.960' x2='339.840' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='639.960' x2='139.920' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 939.600 339.960 Q 892.620 339.960 845.640 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='939.600' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (cat pt-4 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='939.600' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-3 n (hash pcr-id-3 n nonce-2)))</title>
   <circle style='fill: red;' cx='939.600' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-3 (cat &quot;token&quot; nonce-2))</title>
   <circle cx='939.600' cy='114.960' r='6.000'/></g>
  <path
   d='M 839.640 414.960 Q 792.060 450.660 744.479 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='839.640' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot; (hash pcr-id-2 &quot;refuse&quot; nonce-1)))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;token&quot; nonce-1))</title>
   <circle cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 564.960 Q 392.820 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))</title>
   <circle style='fill: blue;' cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <path
   d='M 639.720 339.960 Q 592.740 339.960 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='639.720' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-1 &quot;0&quot;))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <path
   d='M 639.720 114.960 Q 442.800 77.460 245.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 491.444 487.464 443.127 559.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (cat pt-0 (hash &quot;0&quot; n)))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;token&quot; nonce))</title>
   <circle cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 639.960 Q 292.860 602.460 145.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='639.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <path
   d='M 339.840 339.960 Q 292.860 339.960 245.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 336.840 377.460 433.800 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 414.960 Q 486.780 377.460 733.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 286.860 264.960 333.840 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 436.800 152.460 633.720 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 189.960 Q 586.740 152.460 933.600 189.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpmconf (cat &quot;token&quot; nonce-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-3) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='939.600' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1) (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0) (tpm tpmconf) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce) (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k) (aik aik) (tpm tpmconf) (tpmconf tpmconf))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='489.780' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 117</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars
    (pcr-id pcr-id-0 pcr-id-1 nonce nonce-0 pcr-id-2 nonce-1 pcr-id-3
      nonce-2 text) (n v data) (pt pt-0 pt-1 pt-2 pt-3 pt-4 pval)
    (k aik akey) (tpmconf tpm tpm-0 tpm-1 tpm-2 tpm-3 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 5 (pcr-id pcr-id-0) (nonce nonce-0) (n n) (v v) (k k)
    (aik aik) (tpm tpmconf) (tpmconf tpmconf))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpmconf))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0)
    (pt pt) (k k) (aik aik) (tpm tpm) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (nonce nonce)
    (pt pt-0) (pt-0 pt) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (nonce nonce-0) (pt pt-1) (pt-0 pt-0)
    (tpm tpmconf) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (pt pt-2) (aik aik) (tpm tpm-1) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (nonce nonce-1)
    (pt pt-3) (pt-0 pt-2) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 4 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-3) (nonce nonce-2) (pt pt-4) (pt-0 pt-3) (tpm tpm-3)
    (pcr pcr-0))
  (precedes ((2 1) (6 1)) ((2 1) (9 1)) ((2 2) (3 0)) ((2 4) (4 0))
    ((2 4) (7 0)) ((3 1) (2 3)) ((4 3) (1 0)) ((5 3) (4 2))
    ((6 0) (2 0)) ((6 3) (5 2)) ((7 2) (0 0)) ((8 3) (7 1))
    ((9 3) (8 2)))
  (non-orig aik (invk k))
  (uniq-orig nonce nonce-0 nonce-1 nonce-2 n v pt pt-0 pt-2 pt-3 k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpmconf)
  (auth tpmconf)
  (operation channel-test (added-strand tpm-extend-enc 4)
    (ch-msg pcr-0 (cat pt-3 (hash &quot;0&quot; n))) (8 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((recv tpmconf (cat &quot;token&quot; nonce-0))
      (send tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (send tpmconf
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpmconf
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (send v))
    ((send tpm-0 (cat &quot;token&quot; nonce))
      (recv tpm-0
        (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot; (hash pcr-id-1 &quot;obtain&quot; nonce)))
      (load pcr (cat pt-0 (hash &quot;0&quot; n)))
      (stor pcr (cat pt (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
    ((send tpmconf (cat &quot;token&quot; nonce-0))
      (recv tpmconf (cat &quot;extend&quot; pcr-id-0 n (hash pcr-id-0 n nonce-0)))
      (load pcr (cat pt-1 &quot;0&quot;)) (stor pcr (cat pt-0 (hash &quot;0&quot; n))))
    ((recv tpm-1 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm-2 (cat &quot;token&quot; nonce-1))
      (recv tpm-2
        (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;
          (hash pcr-id-2 &quot;refuse&quot; nonce-1)))
      (load pcr-0 (cat pt-3 (hash &quot;0&quot; n)))
      (stor pcr-0 (cat pt-2 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
    ((send tpm-3 (cat &quot;token&quot; nonce-2))
      (recv tpm-3 (cat &quot;extend&quot; pcr-id-3 n (hash pcr-id-3 n nonce-2)))
      (load pcr-0 (cat pt-4 &quot;0&quot;)) (stor pcr-0 (cat pt-3 (hash &quot;0&quot; n)))))
  (label 117)
  (parent 115)
  (unrealized (9 1))
  (dead)
  (comment &quot;empty cohort&quot;))</pre>

</body>
</html>
