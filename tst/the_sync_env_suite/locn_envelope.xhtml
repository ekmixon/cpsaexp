<?xml version="1.0"?>
<!-- CPSA 4.2.3 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>Envelope Protocol, location-based version</title>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <style>
  svg.diagram { border-width: 1px; border-style: solid }
 </style>
</head>
<body>

<pre>(herald &quot;Envelope Protocol, location-based version&quot; (bound 30)
  (limit 1200))
(comment &quot;CPSA 4.2.3&quot;)
(comment &quot;All input read from locn_envelope.scm&quot;)
(comment &quot;Step count limited to 1200&quot;)
(comment &quot;Strand count bounded at 30&quot;)</pre>

<p id="top">Trees: <a href="#t0">0</a> <a href="#t9">9</a> <a href="#t17">17</a> <a href="#t31">31</a> <a href="#t40">40</a> <a href="#t48">48</a> <a href="#t63">63</a> <a href="#t72">72</a> <a href="#t80">80</a>.</p>

<p id="t0">Tree <a href="#top">0</a>.</p>

<div>
 <svg
  class='diagram' width='479.280pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.280 79.920' font-size='12.000'>
  <text
   x='439.320' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k8&quot;, &quot;_self&quot;)'>8</text>
  <line
   x1='389.400' y1='39.960' x2='439.320' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k7&quot;, &quot;_self&quot;)'>7</text>
  <line
   x1='339.480' y1='39.960' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k6&quot;, &quot;_self&quot;)'>6</text>
  <line
   x1='289.560' y1='39.960' x2='339.480' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k5&quot;, &quot;_self&quot;)'>5</text>
  <line
   x1='239.640' y1='39.960' x2='289.560' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k4&quot;, &quot;_self&quot;)'>4</text>
  <line
   x1='189.720' y1='39.960' x2='239.640' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k3&quot;, &quot;_self&quot;)'>3</text>
  <line
   x1='139.800' y1='39.960' x2='189.720' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k2&quot;, &quot;_self&quot;)'>2</text>
  <line
   x1='89.880' y1='39.960' x2='139.800' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k1&quot;, &quot;_self&quot;)'>1</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k0&quot;, &quot;_self&quot;)'>0</text>
  </svg></div>

<pre>(defprotocol envelope basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan))
    (trace (recv tpm &quot;power on&quot;) (load pcr current-value)
      (stor pcr &quot;0&quot;)))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id text) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;extend&quot; pcr-id value))
      (load pcr current-value) (stor pcr (hash current-value value))
      (send &quot;ext ok&quot;)))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr current-value)
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr current-value) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id text) (k aik akey) (tpm chan))
    (trace (send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2))))))</pre>

<p id="k0">Item <a href="#t0">0</a>, Child: <a href="#k1">1</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960' style='text-anchor: middle;'>envelope 0</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 0)
  (unrealized (0 0) (1 2))
  (preskeleton)
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k1">Item <a href="#t0">1</a>, Parent: <a href="#k0">0</a>, Child: <a href="#k2">2</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960' style='text-anchor: middle;'>envelope 1</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (precedes ((1 3) (0 0)))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 1)
  (parent 0)
  (unrealized (1 2))
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k2">Item <a href="#t0">2</a>, Parent: <a href="#k1">1</a>, Child: <a href="#k3">3</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 192.300 225.660 144.719 261.359'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960' style='text-anchor: middle;'>envelope 2</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id text) (v n data) (k aik akey) (tpm tpm-0 chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 2))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 2)
  (parent 1)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k3">Item <a href="#t0">3</a>, Parent: <a href="#k2">2</a>, Child: <a href="#k4">4</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960' style='text-anchor: middle;'>envelope 3</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (precedes ((1 1) (2 0)) ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 2)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 3)
  (parent 2)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k4">Item <a href="#t0">4</a>, Parent: <a href="#k3">3</a>, Child: <a href="#k5">5</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g><title>(ch-msg pcr current-value)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 current-value aik-0)</title>
   <circle style='fill: red;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-0) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960' style='text-anchor: middle;'>envelope 4</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (current-value mesg) (pcr-id pcr-id-0 text) (v n data)
    (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (0 0) (enc v k))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 current-value aik-0))
      (load pcr current-value) (send v)))
  (label 4)
  (parent 3)
  (unrealized (3 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k5">Item <a href="#t0">5</a>, Parent: <a href="#k4">4</a>, Child: <a href="#k6">6</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: red;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960' style='text-anchor: middle;'>envelope 5</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id text) (v n data) (k aik akey) (tpm tpm-0 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 3) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 4 2 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 current-value aik-0) (3 1))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v)))
  (label 5)
  (parent 4)
  (unrealized (3 2))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k6">Item <a href="#t0">6</a>, Parent: <a href="#k5">5</a>, Child: <a href="#k7">7</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 264.960 Q 391.038 374.718 342.276 484.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960' style='text-anchor: middle;'>envelope 6</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (v n data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 3) (0 0))
    ((4 2) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (3 2))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
  (label 6)
  (parent 5)
  (unrealized (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k7">Item <a href="#t0">7</a>, Parent: <a href="#k6">6</a>, Child: <a href="#k8">8</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-1 n))</title>
   <circle style='fill: red;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 391.484 412.464 343.167 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-1) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960' style='text-anchor: middle;'>envelope 7</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (v n data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-1) (tpm tpm-2) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 3) (0 0)) ((4 2) (3 2)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash &quot;0&quot; n)) (4 1))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm-2 (cat &quot;extend&quot; pcr-id-1 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 7)
  (parent 6)
  (unrealized (5 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k8">Item <a href="#t0">8</a>, Parent: <a href="#k7">7</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle style='fill: blue;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 391.484 412.464 343.167 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id) (tpm tpm) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 8 (realized)</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (v n data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id) (tpm tpm) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 3) (0 0)) ((4 2) (3 2)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-1 pcr-id) (tpm-2 tpm)) n
    (5 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id n)))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 8)
  (parent 7)
  (unrealized)
  (shape)
  (maps ((0 1) ((v v) (n n) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))))
  (origs (k (2 1)) (n (1 0)) (v (1 3))))</pre>

<p id="t9">Tree <a href="#top">9</a>.</p>

<div>
 <svg
  class='diagram' width='429.360pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 429.360 79.920' font-size='12.000'>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k16&quot;, &quot;_self&quot;)'>16</text>
  <line
   x1='339.480' y1='39.960' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k15&quot;, &quot;_self&quot;)'>15</text>
  <line
   x1='289.560' y1='39.960' x2='339.480' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k14&quot;, &quot;_self&quot;)'>14</text>
  <line
   x1='239.640' y1='39.960' x2='289.560' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k13&quot;, &quot;_self&quot;)'>13</text>
  <line
   x1='189.720' y1='39.960' x2='239.640' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k12&quot;, &quot;_self&quot;)'>12</text>
  <line
   x1='139.800' y1='39.960' x2='189.720' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k11&quot;, &quot;_self&quot;)'>11</text>
  <line
   x1='89.880' y1='39.960' x2='139.800' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k10&quot;, &quot;_self&quot;)'>10</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k9&quot;, &quot;_self&quot;)'>9</text>
  </svg></div>

<pre>(defprotocol envelope basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan))
    (trace (recv tpm &quot;power on&quot;) (load pcr current-value)
      (stor pcr &quot;0&quot;)))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id text) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;extend&quot; pcr-id value))
      (load pcr current-value) (stor pcr (hash current-value value))
      (send &quot;ext ok&quot;)))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr current-value)
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr current-value) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id text) (k aik akey) (tpm chan))
    (trace (send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2))))))</pre>

<p id="k9">Item <a href="#t9">9</a>, Child: <a href="#k10">10</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960' style='text-anchor: middle;'>envelope 9</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 9)
  (unrealized (0 0) (1 2))
  (preskeleton)
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k10">Item <a href="#t9">10</a>, Parent: <a href="#k9">9</a>, Child: <a href="#k11">11</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960' style='text-anchor: middle;'>envelope 10</text>
  </svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (precedes ((1 3) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 10)
  (parent 9)
  (unrealized (0 0) (1 2))
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k11">Item <a href="#t9">11</a>, Parent: <a href="#k10">10</a>, Child: <a href="#k12">12</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 192.300 225.660 144.719 261.359'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope 11</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 11)
  (parent 10)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k12">Item <a href="#t9">12</a>, Parent: <a href="#k11">11</a>, Child: <a href="#k13">13</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope 12</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((1 1) (2 0)) ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 2)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 12)
  (parent 11)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k13">Item <a href="#t9">13</a>, Parent: <a href="#k12">12</a>, Child: <a href="#k14">14</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: red;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope 13</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 13)
  (parent 12)
  (unrealized (3 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k14">Item <a href="#t9">14</a>, Parent: <a href="#k13">13</a>, Child: <a href="#k15">15</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 264.960 Q 391.484 337.464 343.167 409.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope 14</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 2) (0 0))
    ((4 2) (3 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (3 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
  (label 14)
  (parent 13)
  (unrealized (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k15">Item <a href="#t9">15</a>, Parent: <a href="#k14">14</a>, Child: <a href="#k16">16</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n))</title>
   <circle style='fill: red;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 392.220 375.660 344.639 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 15</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 2) (0 0)) ((4 2) (3 1)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash &quot;0&quot; n)) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 15)
  (parent 14)
  (unrealized (5 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k16">Item <a href="#t9">16</a>, Parent: <a href="#k15">15</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 392.220 375.660 344.639 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 16 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 2) (0 0)) ((4 2) (3 1)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-2 pcr-id-0) (tpm-2 tpm)) n
    (5 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n)))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 16)
  (parent 15)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (tpm tpm))))
  (origs (n (1 0)) (k (2 1)) (v (1 3))))</pre>

<p id="t17">Tree <a href="#top">17</a>.</p>

<div>
 <svg
  class='diagram' width='678.960pt' height='154.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 678.960 154.920' font-size='12.000'>
  <text
   x='639.000' y='101.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k30&quot;, &quot;_self&quot;)'>30</text>
  <line
   x1='589.080' y1='114.960' x2='639.000' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k29&quot;, &quot;_self&quot;)'>29</text>
  <line
   x1='539.160' y1='77.460' x2='589.080' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k28&quot;, &quot;_self&quot;)'>28</text>
  <line
   x1='539.160' y1='77.460' x2='589.080' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='539.160' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k27&quot;, &quot;_self&quot;)'>27</text>
  <line
   x1='489.240' y1='77.460' x2='539.160' y2='77.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='489.240' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k26&quot;, &quot;_self&quot;)'>26</text>
  <line
   x1='439.320' y1='77.460' x2='489.240' y2='77.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k25&quot;, &quot;_self&quot;)'>25</text>
  <line
   x1='389.400' y1='77.460' x2='439.320' y2='77.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k24&quot;, &quot;_self&quot;)'>24</text>
  <line
   x1='339.480' y1='77.460' x2='389.400' y2='77.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k23&quot;, &quot;_self&quot;)'>23</text>
  <line
   x1='289.560' y1='77.460' x2='339.480' y2='77.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k22&quot;, &quot;_self&quot;)'>22</text>
  <line
   x1='239.640' y1='77.460' x2='289.560' y2='77.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k21&quot;, &quot;_self&quot;)'>21</text>
  <line
   x1='189.720' y1='77.460' x2='239.640' y2='77.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k20&quot;, &quot;_self&quot;)'>20</text>
  <line
   x1='139.800' y1='77.460' x2='189.720' y2='77.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k19&quot;, &quot;_self&quot;)'>19</text>
  <line
   x1='89.880' y1='77.460' x2='139.800' y2='77.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k18&quot;, &quot;_self&quot;)'>18</text>
  <line
   x1='39.960' y1='77.460' x2='89.880' y2='77.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='63.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k17&quot;, &quot;_self&quot;)'>17</text>
  </svg></div>

<pre>(defprotocol envelope basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan))
    (trace (recv tpm &quot;power on&quot;) (load pcr current-value)
      (stor pcr &quot;0&quot;)))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id text) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;extend&quot; pcr-id value))
      (load pcr current-value) (stor pcr (hash current-value value))
      (send &quot;ext ok&quot;)))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr current-value)
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr current-value) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id text) (k aik akey) (tpm chan))
    (trace (send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2))))))</pre>

<p id="k17">Item <a href="#t17">17</a>, Child: <a href="#k18">18</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope 17</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 17)
  (unrealized (0 0) (1 0) (2 2))
  (preskeleton)
  (origs (v (2 3)) (n (2 0)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k18">Item <a href="#t17">18</a>, Parent: <a href="#k17">17</a>, Child: <a href="#k19">19</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='339.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope 18</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (precedes ((2 3) (0 0)) ((2 3) (1 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 18)
  (parent 17)
  (unrealized (0 0) (2 2))
  (origs (v (2 3)) (n (2 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k19">Item <a href="#t17">19</a>, Parent: <a href="#k18">18</a>, Child: <a href="#k20">20</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='339.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 189.960 Q 292.260 225.660 244.679 261.359'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope 19</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((2 3) (0 0)) ((2 3) (1 0)) ((3 1) (2 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (2 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 19)
  (parent 18)
  (unrealized (0 0) (1 0) (3 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k20">Item <a href="#t17">20</a>, Parent: <a href="#k19">19</a>, Child: <a href="#k21">21</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='339.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope 20</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (1 0)) ((3 1) (2 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 4 2 alice 2)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (3 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 20)
  (parent 19)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k21">Item <a href="#t17">21</a>, Parent: <a href="#k20">20</a>, Child: <a href="#k22">22</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g><title>(ch-msg pcr current-value)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-1 current-value aik-0)</title>
   <circle style='fill: red;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-1) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope 21</text></svg></div>

<pre>(defskeleton envelope
  (vars (current-value mesg) (pcr-id pcr-id-0 pcr-id-1 text) (n v data)
    (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0)) ((3 1) (2 2))
    ((4 3) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (1 0) (enc v k))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-1 current-value aik-0))
      (load pcr current-value) (send v)))
  (label 21)
  (parent 20)
  (unrealized (0 0) (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k22">Item <a href="#t17">22</a>, Parent: <a href="#k21">21</a>, Child: <a href="#k23">23</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: red;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope 22</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0)) ((3 1) (2 2))
    ((4 3) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 5 3 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-1 current-value aik-0) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v)))
  (label 22)
  (parent 21)
  (unrealized (0 0) (4 2))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k23">Item <a href="#t17">23</a>, Parent: <a href="#k22">22</a>, Child: <a href="#k24">24</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 490.998 374.718 442.236 484.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope 23</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0)) ((3 1) (2 2))
    ((4 3) (1 0)) ((5 2) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (4 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
  (label 23)
  (parent 22)
  (unrealized (0 0) (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k24">Item <a href="#t17">24</a>, Parent: <a href="#k23">23</a>, Child: <a href="#k25">25</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n))</title>
   <circle style='fill: red;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope 24</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash &quot;0&quot; n)) (5 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 24)
  (parent 23)
  (unrealized (0 0) (6 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k25">Item <a href="#t17">25</a>, Parent: <a href="#k24">24</a>, Child: <a href="#k26">26</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope 25</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-2 pcr-id-0) (tpm-2 tpm)) n
    (6 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n)))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 25)
  (parent 24)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k26">Item <a href="#t17">26</a>, Parent: <a href="#k25">25</a>, Child: <a href="#k27">27</a>.</p>

<div>
 <svg
  class='diagram' width='779.640pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 779.640 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: red;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='389.820' y='39.960'
   style='text-anchor: middle;'>envelope 26</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (4 0)) ((2 3) (7 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1))
    ((7 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 26)
  (parent 25)
  (unrealized (7 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k27">Item <a href="#t17">27</a>, Parent: <a href="#k26">26</a>, Children: <a href="#k28">28</a> <a href="#k29">29</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='114.960' x2='839.640' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 264.960 Q 791.324 337.464 743.007 409.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='839.640' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='114.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope 27</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (4 0)) ((2 3) (7 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1))
    ((7 2) (0 0)) ((8 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (7 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr-0 (hash &quot;0&quot; n))
      (stor pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
  (label 27)
  (parent 26)
  (unrealized (8 1))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k28">Item <a href="#t17">28</a>, Parent: <a href="#k27">27</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 339.960 Q 792.060 375.660 744.479 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 639.720 264.960 Q 736.680 227.460 833.640 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope 28 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (4 0)) ((2 3) (7 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1))
    ((6 2) (8 1)) ((7 2) (0 0)) ((8 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 9 6 tpm-extend-enc 3)
    (ch-msg pcr-0 (hash &quot;0&quot; n)) (8 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
  (label 28)
  (parent 27)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (tpm tpm))))
  (origs (k (3 1)) (n (2 0)) (v (2 3))))</pre>

<p id="k29">Item <a href="#t17">29</a>, Parent: <a href="#k27">27</a>, Child: <a href="#k30">30</a>.</p>

<div>
 <svg
  class='diagram' width='979.560pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 979.560 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='939.600' y1='114.960' x2='939.600' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 939.600 264.960 Q 892.620 264.960 845.640 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='939.600' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='939.600' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-4 (cat &quot;extend&quot; pcr-id-3 n))</title>
   <circle style='fill: red;' cx='939.600' cy='114.960' r='6.000'/></g>
  <path
   d='M 839.640 339.960 Q 792.060 375.660 744.479 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 114.960 Q 586.740 77.460 933.600 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-3) (tpm tpm-4) (pcr pcr-0))</title>
   <text
    x='939.600' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='489.780' y='39.960'
   style='text-anchor: middle;'>envelope 29</text></svg></div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 pcr-id-3 text) (n v data)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-3) (tpm tpm-4) (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 0) (9 0)) ((2 1) (3 0)) ((2 3) (4 0))
    ((2 3) (7 0)) ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2))
    ((6 2) (5 1)) ((7 2) (0 0)) ((8 2) (7 1)) ((9 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr-0 (hash &quot;0&quot; n)) (8 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr-0 (hash &quot;0&quot; n))
      (stor pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm-4 (cat &quot;extend&quot; pcr-id-3 n)) (load pcr-0 &quot;0&quot;)
      (stor pcr-0 (hash &quot;0&quot; n))))
  (label 29)
  (parent 27)
  (unrealized (9 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k30">Item <a href="#t17">30</a>, Parent: <a href="#k29">29</a>.</p>

<div>
 <svg
  class='diagram' width='979.560pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 979.560 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='939.600' y1='114.960' x2='939.600' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 939.600 264.960 Q 892.620 264.960 845.640 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='939.600' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='939.600' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='939.600' cy='114.960' r='6.000'/></g>
  <path
   d='M 839.640 339.960 Q 792.060 375.660 744.479 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 114.960 Q 586.740 77.460 933.600 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr-0))</title>
   <text
    x='939.600' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='489.780' y='39.960'
   style='text-anchor: middle;'>envelope 30 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 0) (9 0)) ((2 1) (3 0)) ((2 3) (4 0))
    ((2 3) (7 0)) ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2))
    ((6 2) (5 1)) ((7 2) (0 0)) ((8 2) (7 1)) ((9 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-3 pcr-id-0) (tpm-4 tpm)) n
    (9 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n)))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr-0 (hash &quot;0&quot; n))
      (stor pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr-0 &quot;0&quot;)
      (stor pcr-0 (hash &quot;0&quot; n))))
  (label 30)
  (parent 29)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (tpm tpm))))
  (origs (k (3 1)) (n (2 0)) (v (2 3))))</pre>

<p id="t31">Tree <a href="#top">31</a>.</p>

<div>
 <svg
  class='diagram' width='479.280pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.280 79.920' font-size='12.000'>
  <text
   x='439.320' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k39&quot;, &quot;_self&quot;)'>39</text>
  <line
   x1='389.400' y1='39.960' x2='439.320' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k38&quot;, &quot;_self&quot;)'>38</text>
  <line
   x1='339.480' y1='39.960' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k37&quot;, &quot;_self&quot;)'>37</text>
  <line
   x1='289.560' y1='39.960' x2='339.480' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k36&quot;, &quot;_self&quot;)'>36</text>
  <line
   x1='239.640' y1='39.960' x2='289.560' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k35&quot;, &quot;_self&quot;)'>35</text>
  <line
   x1='189.720' y1='39.960' x2='239.640' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k34&quot;, &quot;_self&quot;)'>34</text>
  <line
   x1='139.800' y1='39.960' x2='189.720' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k33&quot;, &quot;_self&quot;)'>33</text>
  <line
   x1='89.880' y1='39.960' x2='139.800' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k32&quot;, &quot;_self&quot;)'>32</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k31&quot;, &quot;_self&quot;)'>31</text>
  </svg></div>

<pre>(defprotocol envelope-plus basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan))
    (trace (recv tpm &quot;power on&quot;) (load pcr current-value)
      (stor pcr &quot;0&quot;)))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id text) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;extend&quot; pcr-id value))
      (load pcr current-value) (stor pcr (hash current-value value))
      (send &quot;ext ok&quot;)))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr current-value)
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr current-value) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id text) (k aik akey) (tpm chan))
    (trace (send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule ordered-extends
    (forall ((y z strd) (pcr locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 3) (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr))
        (or (= y z) (prec y 2 z 1) (prec z 2 y 1))))))</pre>

<p id="k31">Item <a href="#t31">31</a>, Child: <a href="#k32">32</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus 31</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 31)
  (unrealized (0 0) (1 2))
  (preskeleton)
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k32">Item <a href="#t31">32</a>, Parent: <a href="#k31">31</a>, Child: <a href="#k33">33</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus 32</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (precedes ((1 3) (0 0)))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 32)
  (parent 31)
  (unrealized (1 2))
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k33">Item <a href="#t31">33</a>, Parent: <a href="#k32">32</a>, Child: <a href="#k34">34</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 192.300 225.660 144.719 261.359'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 33</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id text) (v n data) (k aik akey) (tpm tpm-0 chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 2))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 33)
  (parent 32)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k34">Item <a href="#t31">34</a>, Parent: <a href="#k33">33</a>, Child: <a href="#k35">35</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 34</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (precedes ((1 1) (2 0)) ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 2)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 34)
  (parent 33)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k35">Item <a href="#t31">35</a>, Parent: <a href="#k34">34</a>, Child: <a href="#k36">36</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g><title>(ch-msg pcr current-value)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 current-value aik-0)</title>
   <circle style='fill: red;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-0) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus 35</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (current-value mesg) (pcr-id pcr-id-0 text) (v n data)
    (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (0 0) (enc v k))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 current-value aik-0))
      (load pcr current-value) (send v)))
  (label 35)
  (parent 34)
  (unrealized (3 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k36">Item <a href="#t31">36</a>, Parent: <a href="#k35">35</a>, Child: <a href="#k37">37</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: red;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus 36</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id text) (v n data) (k aik akey) (tpm tpm-0 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 3) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 4 2 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 current-value aik-0) (3 1))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v)))
  (label 36)
  (parent 35)
  (unrealized (3 2))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k37">Item <a href="#t31">37</a>, Parent: <a href="#k36">36</a>, Child: <a href="#k38">38</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 264.960 Q 391.038 374.718 342.276 484.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus 37</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (v n data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 3) (0 0))
    ((4 2) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (3 2))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
  (label 37)
  (parent 36)
  (unrealized (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k38">Item <a href="#t31">38</a>, Parent: <a href="#k37">37</a>, Child: <a href="#k39">39</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-1 n))</title>
   <circle style='fill: red;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 391.484 412.464 343.167 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-1) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 38</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (v n data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-1) (tpm tpm-2) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 3) (0 0)) ((4 2) (3 2)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash &quot;0&quot; n)) (4 1))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm-2 (cat &quot;extend&quot; pcr-id-1 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 38)
  (parent 37)
  (unrealized (5 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k39">Item <a href="#t31">39</a>, Parent: <a href="#k38">38</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle style='fill: blue;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 391.484 412.464 343.167 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id) (tpm tpm) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 39 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (v n data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id) (tpm tpm) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 3) (0 0)) ((4 2) (3 2)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-1 pcr-id) (tpm-2 tpm)) n
    (5 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id n)))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 39)
  (parent 38)
  (unrealized)
  (shape)
  (maps ((0 1) ((v v) (n n) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))))
  (origs (k (2 1)) (n (1 0)) (v (1 3))))</pre>

<p id="t40">Tree <a href="#top">40</a>.</p>

<div>
 <svg
  class='diagram' width='429.360pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 429.360 79.920' font-size='12.000'>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k47&quot;, &quot;_self&quot;)'>47</text>
  <line
   x1='339.480' y1='39.960' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k46&quot;, &quot;_self&quot;)'>46</text>
  <line
   x1='289.560' y1='39.960' x2='339.480' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k45&quot;, &quot;_self&quot;)'>45</text>
  <line
   x1='239.640' y1='39.960' x2='289.560' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k44&quot;, &quot;_self&quot;)'>44</text>
  <line
   x1='189.720' y1='39.960' x2='239.640' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k43&quot;, &quot;_self&quot;)'>43</text>
  <line
   x1='139.800' y1='39.960' x2='189.720' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k42&quot;, &quot;_self&quot;)'>42</text>
  <line
   x1='89.880' y1='39.960' x2='139.800' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k41&quot;, &quot;_self&quot;)'>41</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k40&quot;, &quot;_self&quot;)'>40</text>
  </svg></div>

<pre>(defprotocol envelope-plus basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan))
    (trace (recv tpm &quot;power on&quot;) (load pcr current-value)
      (stor pcr &quot;0&quot;)))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id text) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;extend&quot; pcr-id value))
      (load pcr current-value) (stor pcr (hash current-value value))
      (send &quot;ext ok&quot;)))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr current-value)
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr current-value) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id text) (k aik akey) (tpm chan))
    (trace (send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule ordered-extends
    (forall ((y z strd) (pcr locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 3) (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr))
        (or (= y z) (prec y 2 z 1) (prec z 2 y 1))))))</pre>

<p id="k40">Item <a href="#t40">40</a>, Child: <a href="#k41">41</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus 40</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 40)
  (unrealized (0 0) (1 2))
  (preskeleton)
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k41">Item <a href="#t40">41</a>, Parent: <a href="#k40">40</a>, Child: <a href="#k42">42</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus 41</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (precedes ((1 3) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 41)
  (parent 40)
  (unrealized (0 0) (1 2))
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k42">Item <a href="#t40">42</a>, Parent: <a href="#k41">41</a>, Child: <a href="#k43">43</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 192.300 225.660 144.719 261.359'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 42</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 42)
  (parent 41)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k43">Item <a href="#t40">43</a>, Parent: <a href="#k42">42</a>, Child: <a href="#k44">44</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 43</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((1 1) (2 0)) ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 2)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 43)
  (parent 42)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k44">Item <a href="#t40">44</a>, Parent: <a href="#k43">43</a>, Child: <a href="#k45">45</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: red;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus 44</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 44)
  (parent 43)
  (unrealized (3 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k45">Item <a href="#t40">45</a>, Parent: <a href="#k44">44</a>, Child: <a href="#k46">46</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 264.960 Q 391.484 337.464 343.167 409.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus 45</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 2) (0 0))
    ((4 2) (3 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (3 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
  (label 45)
  (parent 44)
  (unrealized (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k46">Item <a href="#t40">46</a>, Parent: <a href="#k45">45</a>, Child: <a href="#k47">47</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n))</title>
   <circle style='fill: red;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 392.220 375.660 344.639 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 46</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 2) (0 0)) ((4 2) (3 1)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash &quot;0&quot; n)) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 46)
  (parent 45)
  (unrealized (5 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k47">Item <a href="#t40">47</a>, Parent: <a href="#k46">46</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 392.220 375.660 344.639 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 47 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 2) (0 0)) ((4 2) (3 1)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-2 pcr-id-0) (tpm-2 tpm)) n
    (5 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n)))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 47)
  (parent 46)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (tpm tpm))))
  (origs (n (1 0)) (k (2 1)) (v (1 3))))</pre>

<p id="t48">Tree <a href="#top">48</a>.</p>

<div>
 <svg
  class='diagram' width='678.960pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 678.960 379.920' font-size='12.000'>
  <text
   x='639.000' y='326.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k62&quot;, &quot;_self&quot;)'>62</text>
  <line
   x1='589.080' y1='339.960' x2='639.000' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='326.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k61&quot;, &quot;_self&quot;)'>61</text>
  <line
   x1='539.160' y1='189.960' x2='589.080' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='251.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k60&quot;, &quot;_self&quot;)'>60</text>
  <line
   x1='539.160' y1='189.960' x2='589.080' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='176.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k59&quot;, &quot;_self&quot;)'>59</text>
  <line
   x1='539.160' y1='189.960' x2='589.080' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='101.040'
   style='font-style: italic; text-anchor: middle; fill: green;'
   onclick='window.open(&quot;#k60&quot;, &quot;_self&quot;)'>60</text>
  <line
   x1='539.160' y1='189.960' x2='589.080' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='26.040'
   style='font-style: italic; text-anchor: middle; fill: green;'
   onclick='window.open(&quot;#k59&quot;, &quot;_self&quot;)'>59</text>
  <line
   x1='539.160' y1='189.960' x2='589.080' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='539.160' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k58&quot;, &quot;_self&quot;)'>58</text>
  <line
   x1='489.240' y1='189.960' x2='539.160' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='489.240' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k57&quot;, &quot;_self&quot;)'>57</text>
  <line
   x1='439.320' y1='189.960' x2='489.240' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k56&quot;, &quot;_self&quot;)'>56</text>
  <line
   x1='389.400' y1='189.960' x2='439.320' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k55&quot;, &quot;_self&quot;)'>55</text>
  <line
   x1='339.480' y1='189.960' x2='389.400' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k54&quot;, &quot;_self&quot;)'>54</text>
  <line
   x1='289.560' y1='189.960' x2='339.480' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k53&quot;, &quot;_self&quot;)'>53</text>
  <line
   x1='239.640' y1='189.960' x2='289.560' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k52&quot;, &quot;_self&quot;)'>52</text>
  <line
   x1='189.720' y1='189.960' x2='239.640' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k51&quot;, &quot;_self&quot;)'>51</text>
  <line
   x1='139.800' y1='189.960' x2='189.720' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k50&quot;, &quot;_self&quot;)'>50</text>
  <line
   x1='89.880' y1='189.960' x2='139.800' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k49&quot;, &quot;_self&quot;)'>49</text>
  <line
   x1='39.960' y1='189.960' x2='89.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='176.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k48&quot;, &quot;_self&quot;)'>48</text>
  </svg></div>

<pre>(defprotocol envelope-plus basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan))
    (trace (recv tpm &quot;power on&quot;) (load pcr current-value)
      (stor pcr &quot;0&quot;)))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id text) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;extend&quot; pcr-id value))
      (load pcr current-value) (stor pcr (hash current-value value))
      (send &quot;ext ok&quot;)))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr current-value)
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr current-value) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id text) (k aik akey) (tpm chan))
    (trace (send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule ordered-extends
    (forall ((y z strd) (pcr locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 3) (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr))
        (or (= y z) (prec y 2 z 1) (prec z 2 y 1))))))</pre>

<p id="k48">Item <a href="#t48">48</a>, Child: <a href="#k49">49</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 48</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 48)
  (unrealized (0 0) (1 0) (2 2))
  (preskeleton)
  (origs (v (2 3)) (n (2 0)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k49">Item <a href="#t48">49</a>, Parent: <a href="#k48">48</a>, Child: <a href="#k50">50</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='339.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus 49</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (precedes ((2 3) (0 0)) ((2 3) (1 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 49)
  (parent 48)
  (unrealized (0 0) (2 2))
  (origs (v (2 3)) (n (2 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k50">Item <a href="#t48">50</a>, Parent: <a href="#k49">49</a>, Child: <a href="#k51">51</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='339.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 189.960 Q 292.260 225.660 244.679 261.359'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus 50</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((2 3) (0 0)) ((2 3) (1 0)) ((3 1) (2 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (2 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 50)
  (parent 49)
  (unrealized (0 0) (1 0) (3 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k51">Item <a href="#t48">51</a>, Parent: <a href="#k50">50</a>, Child: <a href="#k52">52</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='339.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus 51</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (1 0)) ((3 1) (2 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 4 2 alice 2)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (3 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 51)
  (parent 50)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k52">Item <a href="#t48">52</a>, Parent: <a href="#k51">51</a>, Child: <a href="#k53">53</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g><title>(ch-msg pcr current-value)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-1 current-value aik-0)</title>
   <circle style='fill: red;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-1) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus 52</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (current-value mesg) (pcr-id pcr-id-0 pcr-id-1 text) (n v data)
    (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0)) ((3 1) (2 2))
    ((4 3) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (1 0) (enc v k))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-1 current-value aik-0))
      (load pcr current-value) (send v)))
  (label 52)
  (parent 51)
  (unrealized (0 0) (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k53">Item <a href="#t48">53</a>, Parent: <a href="#k52">52</a>, Child: <a href="#k54">54</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: red;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus 53</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0)) ((3 1) (2 2))
    ((4 3) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 5 3 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-1 current-value aik-0) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v)))
  (label 53)
  (parent 52)
  (unrealized (0 0) (4 2))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k54">Item <a href="#t48">54</a>, Parent: <a href="#k53">53</a>, Child: <a href="#k55">55</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 490.998 374.718 442.236 484.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus 54</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0)) ((3 1) (2 2))
    ((4 3) (1 0)) ((5 2) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (4 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
  (label 54)
  (parent 53)
  (unrealized (0 0) (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k55">Item <a href="#t48">55</a>, Parent: <a href="#k54">54</a>, Child: <a href="#k56">56</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n))</title>
   <circle style='fill: red;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus 55</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash &quot;0&quot; n)) (5 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 55)
  (parent 54)
  (unrealized (0 0) (6 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k56">Item <a href="#t48">56</a>, Parent: <a href="#k55">55</a>, Child: <a href="#k57">57</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus 56</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-2 pcr-id-0) (tpm-2 tpm)) n
    (6 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n)))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 56)
  (parent 55)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k57">Item <a href="#t48">57</a>, Parent: <a href="#k56">56</a>, Child: <a href="#k58">58</a>.</p>

<div>
 <svg
  class='diagram' width='779.640pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 779.640 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: red;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='389.820' y='39.960'
   style='text-anchor: middle;'>envelope-plus 57</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (4 0)) ((2 3) (7 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1))
    ((7 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 57)
  (parent 56)
  (unrealized (7 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k58">Item <a href="#t48">58</a>, Parent: <a href="#k57">57</a>, Children: <a href="#k59">59</a> <a href="#k60">60</a> <a href="#k61">61</a>, Seen Children: <a href="#k59">59</a> <a href="#k60">60</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='114.960' x2='839.640' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 264.960 Q 791.324 337.464 743.007 409.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='839.640' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='114.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope-plus 58</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (4 0)) ((2 3) (7 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1))
    ((7 2) (0 0)) ((8 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (7 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr-0 (hash &quot;0&quot; n))
      (stor pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
  (label 58)
  (parent 57)
  (seen 59 60)
  (unrealized (8 1))
  (comment &quot;5 in cohort - 3 not yet seen&quot;))</pre>

<p id="k59">Item <a href="#t48">59</a>, Parent: <a href="#k58">58</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='264.960' x2='839.640' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 414.960 Q 792.660 414.960 745.680 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 539.760 339.960 Q 686.700 302.460 833.640 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope-plus 59 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (4 0)) ((2 3) (7 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((5 2) (8 1))
    ((6 2) (5 1)) ((7 2) (0 0)) ((8 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule ordered-extends)
  (operation channel-test (displaced 9 6 tpm-extend-enc 3)
    (ch-msg pcr-0 (hash &quot;0&quot; n)) (8 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
  (label 59)
  (parent 58)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (tpm tpm))))
  (origs (k (3 1)) (n (2 0)) (v (2 3))))</pre>

<p id="k60">Item <a href="#t48">60</a>, Parent: <a href="#k58">58</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='264.960' x2='539.760' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 339.960 Q 692.700 302.460 545.760 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 839.640 339.960 Q 792.060 375.660 744.479 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 736.680 227.460 833.640 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 414.960 Q 492.180 450.660 444.599 486.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope-plus 60 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (4 0)) ((2 3) (7 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (8 1))
    ((7 2) (0 0)) ((8 2) (5 1)) ((8 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule ordered-extends)
  (operation channel-test (displaced 9 6 tpm-extend-enc 3)
    (ch-msg pcr-0 (hash &quot;0&quot; n)) (8 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
  (label 60)
  (parent 58)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (tpm tpm))))
  (origs (k (3 1)) (n (2 0)) (v (2 3))))</pre>

<p id="k61">Item <a href="#t48">61</a>, Parent: <a href="#k58">58</a>, Child: <a href="#k62">62</a>.</p>

<div>
 <svg
  class='diagram' width='979.560pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 979.560 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='939.600' y1='114.960' x2='939.600' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 939.600 264.960 Q 892.620 264.960 845.640 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='939.600' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='939.600' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-4 (cat &quot;extend&quot; pcr-id-3 n))</title>
   <circle style='fill: red;' cx='939.600' cy='114.960' r='6.000'/></g>
  <path
   d='M 839.640 339.960 Q 792.060 375.660 744.479 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 114.960 Q 586.740 77.460 933.600 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-3) (tpm tpm-4) (pcr pcr-0))</title>
   <text
    x='939.600' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='489.780' y='39.960'
   style='text-anchor: middle;'>envelope-plus 61</text></svg></div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 pcr-id-3 text) (n v data)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-3) (tpm tpm-4) (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 0) (9 0)) ((2 1) (3 0)) ((2 3) (4 0))
    ((2 3) (7 0)) ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2))
    ((6 2) (5 1)) ((7 2) (0 0)) ((8 2) (7 1)) ((9 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr-0 (hash &quot;0&quot; n)) (8 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr-0 (hash &quot;0&quot; n))
      (stor pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm-4 (cat &quot;extend&quot; pcr-id-3 n)) (load pcr-0 &quot;0&quot;)
      (stor pcr-0 (hash &quot;0&quot; n))))
  (label 61)
  (parent 58)
  (unrealized (9 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k62">Item <a href="#t48">62</a>, Parent: <a href="#k61">61</a>.</p>

<div>
 <svg
  class='diagram' width='979.560pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 979.560 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='939.600' y1='114.960' x2='939.600' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 939.600 264.960 Q 892.620 264.960 845.640 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='939.600' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='939.600' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='939.600' cy='114.960' r='6.000'/></g>
  <path
   d='M 839.640 339.960 Q 792.060 375.660 744.479 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 114.960 Q 586.740 77.460 933.600 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr-0))</title>
   <text
    x='939.600' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='489.780' y='39.960'
   style='text-anchor: middle;'>envelope-plus 62 (realized)</text></svg>
 </div>

<pre>(defskeleton envelope-plus
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 0) (9 0)) ((2 1) (3 0)) ((2 3) (4 0))
    ((2 3) (7 0)) ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2))
    ((6 2) (5 1)) ((7 2) (0 0)) ((8 2) (7 1)) ((9 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-3 pcr-id-0) (tpm-4 tpm)) n
    (9 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n)))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr-0 (hash &quot;0&quot; n))
      (stor pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr-0 &quot;0&quot;)
      (stor pcr-0 (hash &quot;0&quot; n))))
  (label 62)
  (parent 61)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (tpm tpm))))
  (origs (k (3 1)) (n (2 0)) (v (2 3))))</pre>

<p id="t63">Tree <a href="#top">63</a>.</p>

<div>
 <svg
  class='diagram' width='479.280pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.280 79.920' font-size='12.000'>
  <text
   x='439.320' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k71&quot;, &quot;_self&quot;)'>71</text>
  <line
   x1='389.400' y1='39.960' x2='439.320' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k70&quot;, &quot;_self&quot;)'>70</text>
  <line
   x1='339.480' y1='39.960' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k69&quot;, &quot;_self&quot;)'>69</text>
  <line
   x1='289.560' y1='39.960' x2='339.480' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k68&quot;, &quot;_self&quot;)'>68</text>
  <line
   x1='239.640' y1='39.960' x2='289.560' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k67&quot;, &quot;_self&quot;)'>67</text>
  <line
   x1='189.720' y1='39.960' x2='239.640' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k66&quot;, &quot;_self&quot;)'>66</text>
  <line
   x1='139.800' y1='39.960' x2='189.720' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k65&quot;, &quot;_self&quot;)'>65</text>
  <line
   x1='89.880' y1='39.960' x2='139.800' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k64&quot;, &quot;_self&quot;)'>64</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k63&quot;, &quot;_self&quot;)'>63</text>
  </svg></div>

<pre>(defprotocol envelope-plus-2 basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan))
    (trace (recv tpm &quot;power on&quot;) (load pcr current-value)
      (stor pcr &quot;0&quot;)))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id text) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;extend&quot; pcr-id value))
      (load pcr current-value) (stor pcr (hash current-value value))
      (send &quot;ext ok&quot;)))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr current-value)
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr current-value) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id text) (k aik akey) (tpm chan))
    (trace (send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule pcr-id-identifies-pcr
    (forall ((y z strd) (pcr-id text) (pcr pcr-0 locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 3) (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; y pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; z pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr-0))
        (= pcr pcr-0)))))</pre>

<p id="k63">Item <a href="#t63">63</a>, Child: <a href="#k64">64</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 63</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 63)
  (unrealized (0 0) (1 2))
  (preskeleton)
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k64">Item <a href="#t63">64</a>, Parent: <a href="#k63">63</a>, Child: <a href="#k65">65</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 64</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (precedes ((1 3) (0 0)))
  (non-orig aik)
  (uniq-orig v n)
  (conf tpm)
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 64)
  (parent 63)
  (unrealized (1 2))
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k65">Item <a href="#t63">65</a>, Parent: <a href="#k64">64</a>, Child: <a href="#k66">66</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 192.300 225.660 144.719 261.359'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 65</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id text) (v n data) (k aik akey) (tpm tpm-0 chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 2))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0 (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 65)
  (parent 64)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k66">Item <a href="#t63">66</a>, Parent: <a href="#k65">65</a>, Child: <a href="#k67">67</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 66</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id text) (v n data) (k aik akey) (tpm chan))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (precedes ((1 1) (2 0)) ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 2)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 66)
  (parent 65)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k67">Item <a href="#t63">67</a>, Parent: <a href="#k66">66</a>, Child: <a href="#k68">68</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g><title>(ch-msg pcr current-value)</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 current-value aik-0)</title>
   <circle style='fill: red;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-0) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 67</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (current-value mesg) (pcr-id pcr-id-0 text) (v n data)
    (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-0) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 3) (0 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig v n k)
  (conf tpm)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (0 0) (enc v k))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 current-value aik-0))
      (load pcr current-value) (send v)))
  (label 67)
  (parent 66)
  (unrealized (3 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k68">Item <a href="#t63">68</a>, Parent: <a href="#k67">67</a>, Child: <a href="#k69">69</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: red;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 68</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id text) (v n data) (k aik akey) (tpm tpm-0 chan)
    (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 3) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 4 2 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 current-value aik-0) (3 1))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v)))
  (label 68)
  (parent 67)
  (unrealized (3 2))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k69">Item <a href="#t63">69</a>, Parent: <a href="#k68">68</a>, Child: <a href="#k70">70</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 264.960 Q 391.038 374.718 342.276 484.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 69</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (v n data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 3) (0 0))
    ((4 2) (3 2)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (3 2))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
  (label 69)
  (parent 68)
  (unrealized (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k70">Item <a href="#t63">70</a>, Parent: <a href="#k69">69</a>, Child: <a href="#k71">71</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-1 n))</title>
   <circle style='fill: red;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 391.484 412.464 343.167 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-1) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 70</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (v n data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-1) (tpm tpm-2) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 3) (0 0)) ((4 2) (3 2)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash &quot;0&quot; n)) (4 1))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm-2 (cat &quot;extend&quot; pcr-id-1 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 70)
  (parent 69)
  (unrealized (5 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k71">Item <a href="#t63">71</a>, Parent: <a href="#k70">70</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='564.960' x2='39.960' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle style='fill: blue;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 391.484 412.464 343.167 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 564.960 Q 192.900 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id) (tpm tpm) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 71 (realized)</text>
  </svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (v n data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-0) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id) (tpm tpm) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 3) (0 0)) ((4 2) (3 2)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig v n k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-1 pcr-id) (tpm-2 tpm)) n
    (5 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id n)))
  (traces ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-0 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 71)
  (parent 70)
  (unrealized)
  (shape)
  (maps ((0 1) ((v v) (n n) (pcr-id pcr-id) (k k) (aik aik) (tpm tpm))))
  (origs (k (2 1)) (n (1 0)) (v (1 3))))</pre>

<p id="t72">Tree <a href="#top">72</a>.</p>

<div>
 <svg
  class='diagram' width='429.360pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 429.360 79.920' font-size='12.000'>
  <text
   x='389.400' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k79&quot;, &quot;_self&quot;)'>79</text>
  <line
   x1='339.480' y1='39.960' x2='389.400' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k78&quot;, &quot;_self&quot;)'>78</text>
  <line
   x1='289.560' y1='39.960' x2='339.480' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k77&quot;, &quot;_self&quot;)'>77</text>
  <line
   x1='239.640' y1='39.960' x2='289.560' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k76&quot;, &quot;_self&quot;)'>76</text>
  <line
   x1='189.720' y1='39.960' x2='239.640' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k75&quot;, &quot;_self&quot;)'>75</text>
  <line
   x1='139.800' y1='39.960' x2='189.720' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k74&quot;, &quot;_self&quot;)'>74</text>
  <line
   x1='89.880' y1='39.960' x2='139.800' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k73&quot;, &quot;_self&quot;)'>73</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k72&quot;, &quot;_self&quot;)'>72</text>
  </svg></div>

<pre>(defprotocol envelope-plus-2 basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan))
    (trace (recv tpm &quot;power on&quot;) (load pcr current-value)
      (stor pcr &quot;0&quot;)))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id text) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;extend&quot; pcr-id value))
      (load pcr current-value) (stor pcr (hash current-value value))
      (send &quot;ext ok&quot;)))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr current-value)
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr current-value) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id text) (k aik akey) (tpm chan))
    (trace (send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule pcr-id-identifies-pcr
    (forall ((y z strd) (pcr-id text) (pcr pcr-0 locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 3) (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; y pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; z pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr-0))
        (= pcr pcr-0)))))</pre>

<p id="k72">Item <a href="#t72">72</a>, Child: <a href="#k73">73</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 72</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 72)
  (unrealized (0 0) (1 2))
  (preskeleton)
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k73">Item <a href="#t72">73</a>, Parent: <a href="#k72">72</a>, Child: <a href="#k74">74</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 73</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (precedes ((1 3) (0 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 73)
  (parent 72)
  (unrealized (0 0) (1 2))
  (origs (v (1 3)) (n (1 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k74">Item <a href="#t72">74</a>, Parent: <a href="#k73">73</a>, Child: <a href="#k75">75</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 189.960 Q 192.300 225.660 144.719 261.359'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 74</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (1 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 74)
  (parent 73)
  (unrealized (0 0) (2 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k75">Item <a href="#t72">75</a>, Parent: <a href="#k74">74</a>, Child: <a href="#k76">76</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 75</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((1 1) (2 0)) ((1 3) (0 0)) ((2 1) (1 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 3 1 alice 2)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (2 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 75)
  (parent 74)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k76">Item <a href="#t72">76</a>, Parent: <a href="#k75">75</a>, Child: <a href="#k77">77</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: red;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 76</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 76)
  (parent 75)
  (unrealized (3 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k77">Item <a href="#t72">77</a>, Parent: <a href="#k76">76</a>, Child: <a href="#k78">78</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='114.960' x2='439.800' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 264.960 Q 391.484 337.464 343.167 409.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='439.800' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='114.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 77</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (precedes ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2)) ((3 2) (0 0))
    ((4 2) (3 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (3 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
  (label 77)
  (parent 76)
  (unrealized (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k78">Item <a href="#t72">78</a>, Parent: <a href="#k77">77</a>, Child: <a href="#k79">79</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n))</title>
   <circle style='fill: red;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 392.220 375.660 344.639 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 78</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 2) (0 0)) ((4 2) (3 1)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash &quot;0&quot; n)) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 78)
  (parent 77)
  (unrealized (5 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k79">Item <a href="#t72">79</a>, Parent: <a href="#k78">78</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='189.960' x2='439.800' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='339.960' x2='339.840' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='189.960' x2='239.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 492.780 264.960 445.800 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 339.960 Q 392.220 375.660 344.639 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='439.800' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='189.960' r='6.000'/></g>
  <path
   d='M 339.840 489.960 Q 192.900 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='339.840' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <path
   d='M 239.880 264.960 Q 192.900 264.960 145.920 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 236.880 302.460 333.840 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 186.900 189.960 233.880 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 336.840 77.460 533.760 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='339.840' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 79 (realized)</text>
  </svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (precedes ((1 0) (5 0)) ((1 1) (2 0)) ((1 3) (3 0)) ((2 1) (1 2))
    ((3 2) (0 0)) ((4 2) (3 1)) ((5 2) (4 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-2 pcr-id-0) (tpm-2 tpm)) n
    (5 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n)))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 79)
  (parent 78)
  (unrealized)
  (shape)
  (maps
    ((0 1)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (tpm tpm))))
  (origs (n (1 0)) (k (2 1)) (v (1 3))))</pre>

<p id="t80">Tree <a href="#top">80</a>.</p>

<div>
 <svg
  class='diagram' width='678.960pt' height='229.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 678.960 229.920' font-size='12.000'>
  <text
   x='639.000' y='176.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k93&quot;, &quot;_self&quot;)'>93</text>
  <line
   x1='589.080' y1='152.460' x2='639.000' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='639.000' y='101.040'
   style='font-style: italic; text-anchor: middle; fill: green;'
   onclick='window.open(&quot;#k93&quot;, &quot;_self&quot;)'>93</text>
  <line
   x1='589.080' y1='152.460' x2='639.000' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='138.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k92&quot;, &quot;_self&quot;)'>92</text>
  <line
   x1='539.160' y1='114.960' x2='589.080' y2='152.460'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='589.080' y='26.040' style='text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k91&quot;, &quot;_self&quot;)'>91</text>
  <line
   x1='539.160' y1='114.960' x2='589.080' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='539.160' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k90&quot;, &quot;_self&quot;)'>90</text>
  <line
   x1='489.240' y1='114.960' x2='539.160' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='489.240' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k89&quot;, &quot;_self&quot;)'>89</text>
  <line
   x1='439.320' y1='114.960' x2='489.240' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='439.320' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k88&quot;, &quot;_self&quot;)'>88</text>
  <line
   x1='389.400' y1='114.960' x2='439.320' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='389.400' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k87&quot;, &quot;_self&quot;)'>87</text>
  <line
   x1='339.480' y1='114.960' x2='389.400' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='339.480' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k86&quot;, &quot;_self&quot;)'>86</text>
  <line
   x1='289.560' y1='114.960' x2='339.480' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='289.560' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k85&quot;, &quot;_self&quot;)'>85</text>
  <line
   x1='239.640' y1='114.960' x2='289.560' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='239.640' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k84&quot;, &quot;_self&quot;)'>84</text>
  <line
   x1='189.720' y1='114.960' x2='239.640' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='189.720' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k83&quot;, &quot;_self&quot;)'>83</text>
  <line
   x1='139.800' y1='114.960' x2='189.720' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='139.800' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k82&quot;, &quot;_self&quot;)'>82</text>
  <line
   x1='89.880' y1='114.960' x2='139.800' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k81&quot;, &quot;_self&quot;)'>81</text>
  <line
   x1='39.960' y1='114.960' x2='89.880' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='101.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k80&quot;, &quot;_self&quot;)'>80</text>
  </svg></div>

<pre>(defprotocol envelope-plus-2 basic
  (defrole tpm-power-on
    (vars (current-value mesg) (pcr locn) (tpm chan))
    (trace (recv tpm &quot;power on&quot;) (load pcr current-value)
      (stor pcr &quot;0&quot;)))
  (defrole tpm-extend-enc
    (vars (value current-value mesg) (pcr-id text) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;extend&quot; pcr-id value))
      (load pcr current-value) (stor pcr (hash current-value value))
      (send &quot;ext ok&quot;)))
  (defrole tpm-quote
    (vars (nonce current-value mesg) (pcr-id text) (aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;quote&quot; pcr-id nonce))
      (load pcr current-value)
      (send (enc &quot;quote&quot; pcr-id current-value nonce aik))))
  (defrole tpm-create-key
    (vars (k aik akey) (pcr-id text) (pcrval mesg) (tpm chan))
    (trace (recv tpm (cat &quot;create-req&quot; pcr-id pcrval))
      (send (enc &quot;created&quot; k pcr-id pcrval aik)))
    (non-orig (invk k))
    (uniq-orig k)
    (auth tpm))
  (defrole tpm-decrypt
    (vars (m current-value mesg) (pcr-id text) (k aik akey) (pcr locn)
      (tpm chan))
    (trace (recv tpm (cat &quot;decrypt&quot; (enc m k)))
      (recv (enc &quot;created&quot; k pcr-id current-value aik))
      (load pcr current-value) (send m))
    (non-orig aik))
  (defrole alice
    (vars (n v data) (pcr-id text) (k aik akey) (tpm chan))
    (trace (send tpm (cat &quot;extend&quot; pcr-id n))
      (send tpm (cat &quot;create-req&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    (non-orig aik)
    (uniq-orig n v)
    (conf tpm)
    (neq (k aik)))
  (defrule genStV-if-hashed-tpm-power-on
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-power-on&quot; z 2)
          (p &quot;tpm-power-on&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-extend-enc
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-extend-enc&quot; z 2)
          (p &quot;tpm-extend-enc&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-decrypt
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-decrypt&quot; z 3)
          (p &quot;tpm-decrypt&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule genStV-if-hashed-tpm-quote
    (forall ((z strd) (v1 v2 mesg))
      (implies
        (and (p &quot;tpm-quote&quot; z 2)
          (p &quot;tpm-quote&quot; &quot;current-value&quot; z (hash v1 v2)))
        (gen-st (hash v1 v2)))))
  (defrule pcr-id-identifies-pcr
    (forall ((y z strd) (pcr-id text) (pcr pcr-0 locn))
      (implies
        (and (p &quot;tpm-extend-enc&quot; y 3) (p &quot;tpm-extend-enc&quot; z 3)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; y pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr-id&quot; z pcr-id)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; y pcr)
          (p &quot;tpm-extend-enc&quot; &quot;pcr&quot; z pcr-0))
        (= pcr pcr-0)))))</pre>

<p id="k80">Item <a href="#t80">80</a>, Child: <a href="#k81">81</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='379.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 379.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 80</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 80)
  (unrealized (0 0) (1 0) (2 2))
  (preskeleton)
  (origs (v (2 3)) (n (2 0)))
  (comment &quot;Not a skeleton&quot;))</pre>

<p id="k81">Item <a href="#t80">81</a>, Parent: <a href="#k80">80</a>, Child: <a href="#k82">82</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='339.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: red;' cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 81</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (precedes ((2 3) (0 0)) ((2 3) (1 0)))
  (non-orig aik)
  (uniq-orig n v)
  (conf tpm)
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k))))
  (label 81)
  (parent 80)
  (unrealized (0 0) (2 2))
  (origs (v (2 3)) (n (2 0)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k82">Item <a href="#t80">82</a>, Parent: <a href="#k81">81</a>, Child: <a href="#k83">83</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='339.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 189.960 Q 292.260 225.660 244.679 261.359'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-0 (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: red;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 82</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0))
  (precedes ((2 3) (0 0)) ((2 3) (1 0)) ((3 1) (2 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm-0)
  (operation encryption-test (added-strand tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik) (2 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm-0
       (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 82)
  (parent 81)
  (unrealized (0 0) (1 0) (3 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k83">Item <a href="#t80">83</a>, Parent: <a href="#k82">82</a>, Child: <a href="#k84">84</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 454.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='339.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 192.900 339.960 145.920 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: red;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 83</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm chan))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (1 0)) ((3 1) (2 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 4 2 alice 2)
    (ch-msg tpm-0
      (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;))) (3 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))))
  (label 83)
  (parent 82)
  (unrealized (0 0) (1 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k84">Item <a href="#t80">84</a>, Parent: <a href="#k83">83</a>, Child: <a href="#k85">85</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g><title>(ch-msg pcr current-value)</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-1 current-value aik-0)</title>
   <circle style='fill: red;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value current-value) (pcr-id pcr-id-1) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 84</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (current-value mesg) (pcr-id pcr-id-0 pcr-id-1 text) (n v data)
    (k aik aik-0 akey) (tpm tpm-0 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v) (current-value current-value)
    (pcr-id pcr-id-1) (k k) (aik aik-0) (tpm tpm-0) (pcr pcr))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0)) ((3 1) (2 2))
    ((4 3) (1 0)))
  (non-orig aik aik-0 (invk k))
  (uniq-orig n v k)
  (conf tpm)
  (auth tpm)
  (operation nonce-test (added-strand tpm-decrypt 4) v (1 0) (enc v k))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-1 current-value aik-0))
      (load pcr current-value) (send v)))
  (label 84)
  (parent 83)
  (unrealized (0 0) (4 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k85">Item <a href="#t80">85</a>, Parent: <a href="#k84">84</a>, Child: <a href="#k86">86</a>.</p>

<div>
 <svg
  class='diagram' width='479.760pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 479.760 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: red;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='239.880' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 85</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 text) (n v data) (k aik akey) (tpm tpm-0 chan)
    (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0)) ((3 1) (2 2))
    ((4 3) (1 0)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-decrypt)
  (operation encryption-test (displaced 5 3 tpm-create-key 2)
    (enc &quot;created&quot; k pcr-id-1 current-value aik-0) (4 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v)))
  (label 85)
  (parent 84)
  (unrealized (0 0) (4 2))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k86">Item <a href="#t80">86</a>, Parent: <a href="#k85">85</a>, Child: <a href="#k87">87</a>.</p>

<div>
 <svg
  class='diagram' width='579.720pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 579.720 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='539.760' y1='114.960' x2='539.760' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 539.760 264.960 Q 490.998 374.718 442.236 484.477'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='539.760' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='114.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='289.860' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 86</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (precedes ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0)) ((3 1) (2 2))
    ((4 3) (1 0)) ((5 2) (4 2)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-extend-enc)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (4 2))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))))
  (label 86)
  (parent 85)
  (unrealized (0 0) (5 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k87">Item <a href="#t80">87</a>, Parent: <a href="#k86">86</a>, Child: <a href="#k88">88</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-2 (cat &quot;extend&quot; pcr-id-2 n))</title>
   <circle style='fill: red;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 87</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-2) (tpm tpm-2) (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr (hash &quot;0&quot; n)) (5 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm-2 (cat &quot;extend&quot; pcr-id-2 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 87)
  (parent 86)
  (unrealized (0 0) (6 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k88">Item <a href="#t80">88</a>, Parent: <a href="#k87">87</a>, Child: <a href="#k89">89</a>.</p>

<div>
 <svg
  class='diagram' width='679.680pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 679.680 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='339.960' x2='39.960' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 142.920 302.460 45.960 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='339.840' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 88</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (0 0)) ((2 3) (4 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
  (conf tpm)
  (auth tpm)
  (operation nonce-test (contracted (pcr-id-2 pcr-id-0) (tpm-2 tpm)) n
    (6 0) (ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n)))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 88)
  (parent 87)
  (unrealized (0 0))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k89">Item <a href="#t80">89</a>, Parent: <a href="#k88">88</a>, Child: <a href="#k90">90</a>.</p>

<div>
 <svg
  class='diagram' width='779.640pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 779.640 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: red;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='389.820' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 89</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (4 0)) ((2 3) (7 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1))
    ((7 2) (0 0)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule genStV-if-hashed-tpm-quote)
  (operation encryption-test (added-strand tpm-quote 3)
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)
    (0 0))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))))
  (label 89)
  (parent 88)
  (unrealized (7 1))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k90">Item <a href="#t80">90</a>, Parent: <a href="#k89">89</a>, Children: <a href="#k91">91</a> <a href="#k92">92</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='114.960' x2='839.640' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 264.960 Q 791.324 337.464 743.007 409.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: red;' cx='839.640' cy='189.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='114.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 90</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (4 0)) ((2 3) (7 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1))
    ((7 2) (0 0)) ((8 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (7 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr-0 (hash &quot;0&quot; n))
      (stor pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
  (label 90)
  (parent 89)
  (unrealized (8 1))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k91">Item <a href="#t80">91</a>, Parent: <a href="#k90">90</a>.</p>

<div>
 <svg
  class='diagram' width='879.600pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 879.600 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 839.640 339.960 Q 792.060 375.660 744.479 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 639.720 264.960 Q 736.680 227.460 833.640 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='439.800' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 91 (realized)</text>
  </svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 1) (3 0)) ((2 3) (4 0)) ((2 3) (7 0))
    ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2)) ((6 2) (5 1))
    ((6 2) (8 1)) ((7 2) (0 0)) ((8 2) (7 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (displaced 9 6 tpm-extend-enc 3)
    (ch-msg pcr-0 (hash &quot;0&quot; n)) (8 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))))
  (label 91)
  (parent 90)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (tpm tpm))))
  (origs (k (3 1)) (n (2 0)) (v (2 3))))</pre>

<p id="k92">Item <a href="#t80">92</a>, Parent: <a href="#k90">90</a>, Child: <a href="#k93">93</a>, Seen Child: <a href="#k93">93</a>.</p>

<div>
 <svg
  class='diagram' width='979.560pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 979.560 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='939.600' y1='114.960' x2='939.600' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 939.600 264.960 Q 892.620 264.960 845.640 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='939.600' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='939.600' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-4 (cat &quot;extend&quot; pcr-id-3 n))</title>
   <circle style='fill: red;' cx='939.600' cy='114.960' r='6.000'/></g>
  <path
   d='M 839.640 339.960 Q 792.060 375.660 744.479 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr-0 (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 114.960 Q 586.740 77.460 933.600 114.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-3) (tpm tpm-4) (pcr pcr-0))</title>
   <text
    x='939.600' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr-0))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr-0))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='489.780' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 92</text></svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 pcr-id-3 text) (n v data)
    (k aik akey) (tpm tpm-0 tpm-1 tpm-2 tpm-3 tpm-4 chan)
    (pcr pcr-0 locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr-0))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-3) (tpm tpm-4) (pcr pcr-0))
  (precedes ((2 0) (6 0)) ((2 0) (9 0)) ((2 1) (3 0)) ((2 3) (4 0))
    ((2 3) (7 0)) ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2))
    ((6 2) (5 1)) ((7 2) (0 0)) ((8 2) (7 1)) ((9 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (operation channel-test (added-strand tpm-extend-enc 3)
    (ch-msg pcr-0 (hash &quot;0&quot; n)) (8 1))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr-0 (hash &quot;0&quot; n))
      (stor pcr-0 (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm-4 (cat &quot;extend&quot; pcr-id-3 n)) (load pcr-0 &quot;0&quot;)
      (stor pcr-0 (hash &quot;0&quot; n))))
  (label 92)
  (parent 90)
  (seen 93)
  (unrealized (9 0))
  (comment &quot;2 in cohort - 1 not yet seen&quot;))</pre>

<p id="k93">Item <a href="#t80">93</a>, Parent: <a href="#k92">92</a>.</p>

<div>
 <svg
  class='diagram' width='979.560pt' height='679.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 979.560 679.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='939.600' y1='114.960' x2='939.600' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='839.640' y1='189.960' x2='839.640' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='739.680' y1='339.960' x2='739.680' y2='489.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='639.720' y1='114.960' x2='639.720' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='539.760' y1='189.960' x2='539.760' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='439.800' y1='339.960' x2='439.800' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='339.840' y1='189.960' x2='339.840' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='564.960' x2='139.920' y2='639.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 939.600 264.960 Q 892.620 264.960 845.640 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='939.600' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='939.600' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='939.600' cy='114.960' r='6.000'/></g>
  <path
   d='M 839.640 339.960 Q 792.060 375.660 744.479 411.359'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='839.640' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='839.640' cy='189.960' r='6.000'/></g>
  <path
   d='M 739.680 489.960 Q 392.820 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='739.680' cy='489.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))</title>
   <circle style='fill: blue;' cx='739.680' cy='414.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))</title>
   <circle style='fill: blue;' cx='739.680' cy='339.960' r='6.000'/></g>
  <path
   d='M 639.720 264.960 Q 592.740 264.960 545.760 264.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='639.720' cy='264.960' r='6.000'/></g>
  <g><title>(ch-msg pcr &quot;0&quot;)</title>
   <circle style='fill: blue;' cx='639.720' cy='189.960' r='6.000'/></g>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle style='fill: blue;' cx='639.720' cy='114.960' r='6.000'/></g>
  <path
   d='M 539.760 339.960 Q 491.444 412.464 443.127 484.967'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='339.960' r='6.000'/></g>
  <g><title>(ch-msg pcr (hash &quot;0&quot; n))</title>
   <circle style='fill: blue;' cx='539.760' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='539.760' cy='189.960' r='6.000'/></g>
  <path
   d='M 439.800 564.960 Q 292.860 527.460 145.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>v</title><circle cx='439.800' cy='564.960' r='6.000'/></g>
  <g>
   <title>(ch-msg pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;))</title>
   <circle style='fill: blue;' cx='439.800' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='439.800' cy='414.960' r='6.000'/></g>
  <g><title>(ch-msg tpm-0 (cat &quot;decrypt&quot; (enc v k)))</title>
   <circle style='fill: blue;' cx='439.800' cy='339.960' r='6.000'/></g>
  <path
   d='M 339.840 264.960 Q 292.860 264.960 245.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle cx='339.840' cy='264.960' r='6.000'/></g>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle style='fill: blue;' cx='339.840' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 339.960 Q 336.840 302.460 433.800 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 339.960 Q 486.780 302.460 733.680 339.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc v k)</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 286.860 189.960 333.840 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(ch-msg tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <path
   d='M 239.880 114.960 Q 436.800 77.460 633.720 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <path
   d='M 239.880 114.960 Q 586.740 77.460 933.600 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <g><title>v</title><circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>v</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik)</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='939.600' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;refuse&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3) (pcr pcr))</title>
   <text
    x='839.640' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((nonce (enc v k)) (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id) (aik aik) (tpm tpm-2) (pcr pcr))</title>
   <text
    x='739.680' y='77.460' style='text-anchor: middle;'>tpm-quote</text>
   </g>
  <g>
   <title>((value n) (current-value &quot;0&quot;) (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))</title>
   <text
    x='639.720' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((value &quot;obtain&quot;) (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1) (pcr pcr))</title>
   <text
    x='539.760' y='77.460'
    style='text-anchor: middle;'>tpm-extend-enc</text></g>
  <g>
   <title>((m v) (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm-0) (pcr pcr))</title>
   <text
    x='439.800' y='77.460'
    style='text-anchor: middle;'>tpm-decrypt</text></g>
  <g>
   <title>((pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>tpm-create-key</text></g>
  <g>
   <title>((pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik) (tpm tpm))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>alice</text></g>
  <text
   x='489.780' y='39.960'
   style='text-anchor: middle;'>envelope-plus-2 93 (realized)</text>
  </svg></div>

<pre>(defskeleton envelope-plus-2
  (vars (pcr-id pcr-id-0 pcr-id-1 pcr-id-2 text) (n v data) (k aik akey)
    (tpm tpm-0 tpm-1 tpm-2 tpm-3 chan) (pcr locn))
  (deflistener
    (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
  (deflistener v)
  (defstrand alice 4 (pcr-id pcr-id-0) (n n) (v v) (k k) (aik aik)
    (tpm tpm))
  (defstrand tpm-create-key 2 (pcrval (hash (hash &quot;0&quot; n) &quot;obtain&quot;))
    (pcr-id pcr-id-0) (k k) (aik aik) (tpm tpm))
  (defstrand tpm-decrypt 4 (m v)
    (current-value (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (pcr-id pcr-id-0) (k k)
    (aik aik) (tpm tpm-0) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;obtain&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-1) (tpm tpm-1)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (defstrand tpm-quote 3 (nonce (enc v k))
    (current-value (hash (hash &quot;0&quot; n) &quot;refuse&quot;)) (pcr-id pcr-id)
    (aik aik) (tpm tpm-2) (pcr pcr))
  (defstrand tpm-extend-enc 3 (value &quot;refuse&quot;)
    (current-value (hash &quot;0&quot; n)) (pcr-id pcr-id-2) (tpm tpm-3)
    (pcr pcr))
  (defstrand tpm-extend-enc 3 (value n) (current-value &quot;0&quot;)
    (pcr-id pcr-id-0) (tpm tpm) (pcr pcr))
  (precedes ((2 0) (6 0)) ((2 0) (9 0)) ((2 1) (3 0)) ((2 3) (4 0))
    ((2 3) (7 0)) ((3 1) (2 2)) ((4 3) (1 0)) ((5 2) (4 2))
    ((6 2) (5 1)) ((7 2) (0 0)) ((8 2) (7 1)) ((9 2) (8 1)))
  (non-orig aik (invk k))
  (uniq-orig n v k)
  (genStV (hash &quot;0&quot; n) (hash (hash &quot;0&quot; n) &quot;obtain&quot;)
    (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
  (conf tpm)
  (auth tpm)
  (rule pcr-id-identifies-pcr)
  (operation nonce-test
    (contracted (pcr-0 pcr) (pcr-id-3 pcr-id-0) (tpm-4 tpm)) n (9 0)
    (ch-msg tpm (cat &quot;extend&quot; pcr-id-0 n)))
  (traces
    ((recv
       (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k) aik))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik))) ((recv v) (send v))
    ((send tpm (cat &quot;extend&quot; pcr-id-0 n))
      (send tpm
        (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (send (enc v k)))
    ((recv tpm (cat &quot;create-req&quot; pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
      (send
        (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik)))
    ((recv tpm-0 (cat &quot;decrypt&quot; (enc v k)))
      (recv (enc &quot;created&quot; k pcr-id-0 (hash (hash &quot;0&quot; n) &quot;obtain&quot;) aik))
      (load pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)) (send v))
    ((recv tpm-1 (cat &quot;extend&quot; pcr-id-1 &quot;obtain&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;obtain&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n)))
    ((recv tpm-2 (cat &quot;quote&quot; pcr-id (enc v k)))
      (load pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;))
      (send
        (enc &quot;quote&quot; pcr-id (hash (hash &quot;0&quot; n) &quot;refuse&quot;) (enc v k)
          aik)))
    ((recv tpm-3 (cat &quot;extend&quot; pcr-id-2 &quot;refuse&quot;))
      (load pcr (hash &quot;0&quot; n)) (stor pcr (hash (hash &quot;0&quot; n) &quot;refuse&quot;)))
    ((recv tpm (cat &quot;extend&quot; pcr-id-0 n)) (load pcr &quot;0&quot;)
      (stor pcr (hash &quot;0&quot; n))))
  (label 93)
  (parent 92)
  (unrealized)
  (shape)
  (maps
    ((0 1 2)
      ((n n) (v v) (k k) (aik aik) (pcr-id pcr-id) (pcr-id-0 pcr-id-0)
        (tpm tpm))))
  (origs (k (3 1)) (n (2 0)) (v (2 3))))</pre>

</body>
</html>
